---
title: "An√°lisis de Series de Tiempo y Pron√≥st√≥sticos ARIMA"
subtitle: "Estudio Emp√≠rico sobre el Precio de Acciones de Tesla Inc."
author: "Camilo"
date: "`r format(Sys.Date(), '%d de %B de %Y')`"
output:
  html_document:
    theme: darkly
    toc: false         
    toc_float: false   
---



<div id="custom-toc"></div>


```{=html}
<style type="text/css">

/* ========== PALETA DE COLORES CLARA - EST√âTICA PROFESIONAL Y DIN√ÅMICA ========== */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@500;600;700&display=swap');

html, body {
  font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
h1, h2, h3 {
  font-family: 'Poppins', 'Inter', sans-serif !important;
  letter-spacing: -0.02em;
}
:root {
  /* Colores Base */
  --bg-light: #ffffff;
  --bg-lighter: #f5f7fa;
  --text-dark: #1f2937;
  --text-medium: #4b5563;
  --text-gray: #94a3b8;

  /* Acentos QQQ: Cian/Verde */
  --accent-primary: #00b894;
  --accent-secondary: #06b6d4;
  --accent-positive: #84cc16;
  --accent-negative: #e17055;
  --accent-soft: #3b82f6;
}

/* ========== RESET & ESTRUCTURA CLAVE ========== */
* {
  box-sizing: border-box !important;
  margin: 0;
  padding: 0;
}

html, body {
  background: var(--bg-light) !important;
  color: var(--text-dark) !important;
  font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
  line-height: 1.65 !important;
  overflow-x: hidden !important;
  min-height: 100vh !important;
}

/* Contenedor de contenido central */
div.container-fluid:first-of-type {
  width: auto !important;
  max-width: 100% !important;
  padding: 60px 80px !important;
}

/* ========== TOC PERSONALIZADO "CONTENIDO" ========== */
/* ========== TOC PERSONALIZADO "CONTENIDO" ========== */
#custom-toc {
  position: fixed;
  top: 60px;
  left: 0;
  width: 260px;
  height: 80vh;
  /* CAMBIOS IMPORTANTES AQU√ç: */
  display: flex;              /* Usar flexbox para organizar hijos */
  flex-direction: column;     /* Uno debajo del otro */
  overflow: hidden;           /* El contenedor NO scrollea, solo sus hijos */
  /* Fin de cambios */
  padding: 0;                 /* Quitamos padding general para manejarlo dentro */
  background: var(--bg-lighter);
  border-right: 2px solid var(--accent-secondary);
  border-radius: 0 10px 10px 0;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  z-index: 999;
}

/* T√≠tulo del TOC */
#custom-toc h2 {
  position: relative;
  flex-shrink: 0;
  background: var(--bg-lighter);
  z-index: 10;
  /* CAMBIO AQU√ç: Reduje el padding superior de 20px a 10px */
  padding: 10px 15px 15px 15px; 
  margin: 0;
  border-bottom: 2px solid rgba(0, 184, 148, 0.3);
  box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); /* Sombra sutil para separar */
}

/* dar espacio despu√©s del t√≠tulo */
/* Lista de enlaces (Aqu√≠ ocurre el scroll) */
#custom-toc ul {
  list-style: none !important;
  /* CAMBIO AQU√ç: El primer valor (arriba) ahora es 0px */
  padding: 0px 10px 20px 10px !important; 
  margin: 0 !important;
  flex-grow: 1;               
  overflow-y: auto;           
  
  scrollbar-width: thin;
  scrollbar-color: var(--accent-secondary) transparent;
}

/* CAMBIO EXTRA: Asegura que el primer √≠tem suba al m√°ximo */
#custom-toc li:first-child {
  margin-top: 2px !important; /* Muy pegado arriba */
}

#custom-toc li {
  margin: 8px 0 !important;
}

/* Estilo de enlaces del TOC */
#custom-toc a {
  display: block;
  padding: 10px 14px;
  color: var(--text-medium) !important;
  text-decoration: none;
  border-radius: 8px;
  transition: all .2s ease;
}

#custom-toc a:hover {
  background: rgba(0,184,148,0.15);
  color: var(--accent-primary) !important;
  transform: translateX(5px);
  box-shadow: 0 4px 14px rgba(0,0,0,0.12);
}

/* Enlace activo */
#custom-toc a.active {
  background: var(--bg-light);
  color: var(--accent-primary) !important;
  border-left: 5px solid var(--accent-secondary);
  font-weight: 600;
  transform: translateX(4px);
}

/* Scrollbar est√©tico */
#custom-toc::-webkit-scrollbar {
  width: 6px !important;
}

#custom-toc::-webkit-scrollbar-thumb {
  background: var(--accent-secondary) !important;
  border-radius: 10px !important;
}

/* Ocultar el TOC nativo de R Markdown */
#TOC {
  display: none !important;
}


/* ========== SECCIONES Y TIPOGRAF√çA ========== */
.section.level1 {
  margin-bottom: 80px !important;
  padding: 50px !important;
  background: var(--bg-light) !important;
  border: 1px solid rgba(0, 0, 0, 0.05) !important;
  border-top: 6px solid var(--accent-primary) !important;
  border-radius: 12px !important;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1) !important;
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) !important;
}

.section.level1:hover {
  border-top-color: var(--accent-secondary) !important;
  box-shadow: 0 18px 55px rgba(0, 0, 0, 0.15) !important;
  transform: translateY(-3px) !important;
}

/* T√çTULOS */
/* ---- Header / t√≠tulo principal m√°s elegante ---- */
.page-title {
  display: block;
  margin: 8px 0 18px 0;
}
h1 {
  font-size: 3.2rem !important;
  line-height: 1.05 !important;
  color: var(--text-dark) !important;
  font-weight: 700 !important;
  margin-bottom: 8px !important;
}
.subtitle {
  display: block;
  color: var(--accent-secondary);
  font-size: 1.05rem;
  font-weight: 500;
  margin-bottom: 14px;
  padding-left: 8px;
  border-left: 4px solid rgba(6,182,212,0.12);
}

h2 {
  font-size: 2.2em !important;
  color: var(--accent-primary) !important;
  margin-top: 50px !important;
  border-left: 8px solid var(--accent-secondary) !important;
  padding-left: 20px !important;
  transition: all 0.3s ease !important;
  font-weight: 600 !important;
}

h2:hover {
  padding-left: 25px !important;
  color: var(--accent-secondary) !important;
}

h3 {
  font-size: 1.6em !important;
  color: var(--accent-secondary) !important;
  border-left: 5px solid var(--accent-positive) !important;
  padding-left: 15px !important;
  margin-top: 30px !important;
  font-weight: 500 !important;
}

/* P√ÅRRAFOS */
p {
  color: var(--text-dark) !important;
  font-size: 1.05em !important;
  line-height: 1.8 !important;
}

/* ========== TABLAS ========== */
table {
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1) !important;
  border: 1px solid rgba(0, 0, 0, 0.05) !important;
  background: var(--bg-light) !important;
  border-radius: 10px !important;
  overflow: hidden !important;
  margin: 25px 0 !important;
}

thead {
  background: var(--accent-primary) !important;
}

th {
  color: var(--bg-light) !important;
  font-weight: 700 !important;
  padding: 15px 20px !important;
}

td {
  border-bottom: 1px solid var(--bg-lighter) !important;
  color: var(--text-dark) !important;
  padding: 12px 20px !important;
}

tbody tr:nth-child(even) {
  background-color: var(--bg-lighter) !important;
}

tbody tr:hover {
  background-color: rgba(6, 182, 212, 0.1) !important;
  transition: background-color 0.2s ease !important;
}

.section.level1 {
  background: linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(250,251,252,1) 100%);
  border-top: 6px solid var(--accent-primary);
  padding: 36px !important;
  transition: transform .28s cubic-bezier(.2,.9,.2,1), box-shadow .28s;
}
.section.level1:hover {
  transform: translateY(-6px);
  box-shadow: 0 28px 60px rgba(16,24,40,0.08);
}

/* ========== C√ìDIGO ========== */
pre {
  background: var(--bg-lighter) !important;
  border-left: 6px solid var(--accent-secondary) !important;
  box-shadow: 0 6px 25px rgba(0, 0, 0, 0.08) !important;
  border: 1px solid rgba(6, 182, 212, 0.2) !important;
  border-radius: 10px !important;
  padding: 25px !important;
}

/* ========== FOOTER ========== */
div[style*="margin-top: 80px;"] {
  background: var(--bg-lighter) !important;
  border: 1px solid rgba(0, 0, 0, 0.05) !important;
  border-top: 6px solid var(--accent-primary) !important;
  color: var(--text-dark) !important;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1) !important;
}
/* ======= DESPLAZAR EL CONTENIDO PARA QUE NO CHOQUE CON EL TOC ======= */
body .container-fluid,
body .main-container,
body div.container-fluid:first-of-type {
  margin-left: 280px !important;   /* un poco m√°s que el ancho del TOC */
  max-width: calc(100% - 300px) !important;
}


/* RESPONSIVE DESIGN */
@media (max-width: 768px) {
  #custom-toc {
    position: relative !important;
    width: 100% !important;
    height: auto !important;
    max-height: 300px !important;
    margin-bottom: 30px !important;
  }
  
  div.container-fluid:first-of-type {
    padding: 20px !important;
  }
}
/* ===================== BOT√ìN FLOTANTE UNIVERSIDAD ===================== */
#uv-button {
  position: fixed;
  bottom: 25px;
  right: 25px;   /* c√°mbialo a left:25px si lo quieres a la izquierda */
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: white;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 9999;
  transition: transform 0.3s ease;
  overflow: hidden;
}

#uv-button:hover {
  transform: scale(1.1);
}

/* Imagen interna */
#uv-button img {
  width: 80%;
  height: 80%;
  object-fit: contain;
  transition: opacity .4s ease;
}

/* Animaci√≥n de rotaci√≥n */
@keyframes spin-logo {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#uv-button.spin {
  animation: spin-logo 1.2s linear;
}
#uv-button img {
  width: 80%;
  height: 80%;
  object-fit: contain;
  display: block;
  margin: auto;        
  position: absolute;  
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
/* ===== TOOLTIP PERSONALIZADO PARA EL BOT√ìN ===== */
/* ===== TOOLTIP HACIA LA IZQUIERDA ===== */
#uv-button::after {
  content: attr(data-tooltip);
  position: absolute;
  left: -10px;                /* empieza pegado al borde izquierdo */
  top: 50%;                   /* centrado verticalmente */
  transform: translate(-100%, -50%);  /* lo desplaza completamente a la izquierda */
  
  background: rgba(0,0,0,0.85);
  color: white;
  padding: 8px 12px;
  font-size: 0.85em;
  border-radius: 6px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
}

#uv-button:hover::after {
  opacity: 1;
}

#uv-button {
  position: fixed !important;
  z-index: 999999 !important;
  pointer-events: auto !important;
}
#custom-toc, #right-toc {
  z-index: 5000 !important;
}
#uv-button {
  overflow: visible !important;
}

/* ========== NUEVO: ESTILO PARA EL BOT√ìN INDIVIDUAL DE CADA CHUNK ========== */
.chunk-code-toggle {
  background-color: transparent;
  color: var(--accent-primary); /* Color verde/cian */
  border: 1px solid var(--accent-primary);
  padding: 4px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'Inter', sans-serif;
  font-size: 0.85rem;
  font-weight: 600;
  margin-bottom: 5px; /* Espacio entre bot√≥n y c√≥digo */
  margin-top: 15px;   /* Espacio respecto al elemento anterior */
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.chunk-code-toggle:hover {
  background-color: var(--accent-primary);
  color: white;
  box-shadow: 0 4px 10px rgba(0, 184, 148, 0.2);
}

.chunk-code-toggle.active {
  background-color: var(--bg-lighter);
  color: var(--text-gray);
  border-color: var(--text-gray);
}

/* Ajuste para que el bloque de c√≥digo (pre) aparezca pegado al bot√≥n */
pre {
  margin-top: 0 !important;
  transition: all 0.3s ease;
}
/* ========== CENTRADO UNIVERSAL DE GR√ÅFICOS E IM√ÅGENES ========== */

/* 1. Centra im√°genes est√°ticas (tanto Markdown como HTML <img>) */
img {
display: block;
 margin-left: auto;
 margin-right: auto;
}

/* 2. Centra contenedores de figuras generados por R (gr√°ficos est√°ticos) */
.r-figure {
 display: block;
 margin-left: auto;
 margin-right: auto;
 max-width: 900px; /* O el ancho m√°ximo que desees */
}

/* 3. Centra conteedores de plotly (incluye ggplotly) */
.html-widget.plotly {
 display: block;
 margin: 0 auto !important;
 max-width: 900px; /* O el ancho m√°ximo que desees */
}
/* 4. Centra tblas (kable / kableExtra) igual que plotly */
table, .table, table.kable_wrapper {
    margin-left: auto !important;
    margin-right: auto !important;
    max-width: 900px; /* Mismo ancho m√°ximo que tus gr√°ficos */
    width: auto !important; /* Evita que la tabla se estire al 100% si es peque√±a */
    border-collapse: collapse; /* Opcional: para que se vea limpia */
}
</style>
```
<div id="uv-button" data-tooltip="Escuela de Ingenier√≠a Industrial - Cali">
  <img id="uv-img" src="univalle.png" alt="Univalle">
</div>

```{=html}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const SCROLL_OFFSET = 100; // Ajusta este valor si el t√≠tulo queda tapado (100px es bueno)
  
  // 1. REFERENCIA AL CONTENEDOR DEL TOC
  const toc = document.getElementById("custom-toc");
  if (!toc) return; // Si no existe el div, no hace nada

  // 2. CREAR T√çTULO Y LISTA
  const title = document.createElement("h2");
  title.textContent = "Contenido";
  toc.appendChild(title);
  
  const list = document.createElement("ul");
  toc.appendChild(list);

  // 3. GENERAR ENLACES BASADOS EN H1 y H2
  const headers = document.querySelectorAll("h1, h2");
  
  headers.forEach(header => {
    // Si el header no tiene ID, creamos uno limpio
    if (!header.id) {
      header.id = header.textContent
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, "-") // Reemplaza caracteres raros por guiones
        .replace(/^-+|-+$/g, '');    // Quita guiones al inicio o final
    }

    // Crear el elemento de lista
    const li = document.createElement("li");
    const a = document.createElement("a");
    
    a.href = `#${header.id}`; // Enlace interno al ID
    a.textContent = header.textContent; // Texto del enlace
    
    // === AQU√ç EST√Å LA MAGIA DEL CLIC ===
    a.addEventListener('click', function(e) {
      e.preventDefault(); // Evita el salto brusco predeterminado
      
      const targetId = this.getAttribute('href').substring(1); // Quita el #
      const targetElement = document.getElementById(targetId);
      
      if (targetElement) {
        // Scroll suave manual
        window.scrollTo({
          top: targetElement.offsetTop - SCROLL_OFFSET, 
          behavior: 'smooth'
        });
        
        // Actualizar URL sin saltar (opcional)
        history.pushState(null, null, `#${targetId}`);
      }
    });

    li.appendChild(a);
    list.appendChild(li);
  });

  // 4. RESALTAR ENLACE ACTIVO AL HACER SCROLL
  function updateActiveTOCLink() {
    const tocLinks = document.querySelectorAll('#custom-toc a');
    let currentActiveId = '';
    
    headers.forEach(section => {
      const rect = section.getBoundingClientRect();
      // Si la secci√≥n est√° cerca de la parte superior (con el offset)
      if (rect.top <= SCROLL_OFFSET + 20) { 
        currentActiveId = section.id;
      }
    });
    
    tocLinks.forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('href') === `#${currentActiveId}`) {
        link.classList.add('active');
      }
    });
  }

  // 5. EVENTOS GLOBALES
  window.addEventListener('scroll', updateActiveTOCLink);
  // Ejecutar una vez al inicio para marcar el primero
  updateActiveTOCLink(); 

  // --- EXTRAS (FECHA, BOT√ìN, ETC) ---
  
  // Fecha
  const fechaSpan = document.getElementById('fecha-entrega');
  if(fechaSpan) {
    fechaSpan.textContent = new Date().toLocaleDateString('es-ES', {
      year: 'numeric', month: 'long', day: 'numeric'
    });
  }

  // Bot√≥n C√≥digo
  const btnToggle = document.createElement('button');
  btnToggle.id = 'global-code-toggle';
  btnToggle.textContent = 'üíª C√≥digo Oculto';
  document.body.appendChild(btnToggle);
  let codeVisible = true;
  btnToggle.addEventListener('click', function() {
    const codes = document.querySelectorAll('pre');
    codeVisible = !codeVisible;
    codes.forEach(code => {
      code.style.display = codeVisible ? 'block' : 'none';
    });
    btnToggle.textContent = codeVisible ? 'üíª C√≥digo Oculto' : 'üëÅÔ∏è Mostrar C√≥digo';
  });

  // Animaci√≥n Logo Univalle
  const logos = ["univalle.png", "ingenieria.png"];  
  let index = 0;
  const img = document.getElementById("uv-img");
  const btn = document.getElementById("uv-button");
  if (btn && img) {
    setInterval(() => {
      btn.classList.add("spin");
      setTimeout(() => {
        index = (index + 1) % logos.length;
        img.style.opacity = 0;
        setTimeout(() => {
          img.src = logos[index];
          img.style.opacity = 1;
        }, 200);
      }, 600);
      setTimeout(() => btn.classList.remove("spin"), 1200);
    }, 3500);
  }
});
document.addEventListener('DOMContentLoaded', function() {
  const SCROLL_OFFSET = 100;

 
  // --- 2. NUEVA L√ìGICA: BOTONES INDIVIDUALES PARA CADA C√ìDIGO ---
  
  // Seleccionamos todos los bloques de c√≥digo generados por R
  // R Markdown suele ponerlos en 'pre.r' o dentro de div.sourceCode
  const codeBlocks = document.querySelectorAll('pre.r, pre.sourceCode, .sourceCode pre');

  codeBlocks.forEach(block => {
    // 1. Ocultar el c√≥digo por defecto
    block.style.display = 'none';

    // 2. Crear el bot√≥n
    const btn = document.createElement('button');
    btn.className = 'chunk-code-toggle';
    btn.innerHTML = '<span>&#9654;</span> Ver C√≥digo'; // Icono de play
    
    // 3. Insertar el bot√≥n ANTES del bloque de c√≥digo
    // Buscamos el padre para insertar antes del <pre>
    block.parentNode.insertBefore(btn, block);

    // 4. Agregar evento click
    btn.addEventListener('click', function() {
      if (block.style.display === 'none') {
        // Mostrar
        block.style.display = 'block';
        btn.innerHTML = '<span>&#9660;</span> Ocultar C√≥digo';
        btn.classList.add('active');
      } else {
        // Ocultar
        block.style.display = 'none';
        btn.innerHTML = '<span>&#9654;</span> Ver C√≥digo';
        btn.classList.remove('active');
      }
    });
  });

  // --- 3. EXTRAS (FECHA, LOGOS) ---
  const fechaSpan = document.getElementById('fecha-entrega');
  if(fechaSpan) {
    fechaSpan.textContent = new Date().toLocaleDateString('es-ES', {
      year: 'numeric', month: 'long', day: 'numeric'
    });
  }

  // Elimin√© el bot√≥n global anterior para que no tengas conflicto, 
  // ya que ahora tienes botones individuales.

  // Animaci√≥n Logo Univalle
  const logos = ["univalle.png", "ingenieria.png"];  
  let index = 0;
  const img = document.getElementById("uv-img");
  const btn = document.getElementById("uv-button");
  if (btn && img) {
    setInterval(() => {
      btn.classList.add("spin");
      setTimeout(() => {
        index = (index + 1) % logos.length;
        img.style.opacity = 0;
        setTimeout(() => {
          img.src = logos[index];
          img.style.opacity = 1;
        }, 200);
      }, 600);
      setTimeout(() => btn.classList.remove("spin"), 1200);
    }, 3500);
  }
});
</script>

```
```{r setup-theme, include=FALSE}

library(tidyverse)
library(quantmod)
library(xts)
library(fpp2)
library(tseries)
library(scales)
library(knitr)
library(kableExtra)
library(gridExtra)
library(grid)
library(forecast)
library(ggplot2)
library(zoo)
library(plotly)
library(tidyquant)
library(ggplot2)
library(dplyr)
library(lubridate)
library(scales)

knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.align = 'center',
  fig.width = 12,
  fig.height = 6
)

qqq_pal <- list(
  bg        = "#ffffff",
  text_dark = "#1f2937",
  text_gray = "#4b5563",
  primary   = "#00b894",
  secondary = "#06b6d4",
  positive  = "#84cc16",
  negative  = "#e17055",
  grid      = "#f3f4f6"
)

theme_QQQ <- function() {
  theme_minimal(base_size = 14) +
    theme(
      plot.background = element_rect(fill = "transparent", color = NA),
      panel.background = element_rect(fill = "transparent", color = NA),
      text = element_text(color = qqq_pal$text_dark, family = "sans"),
      plot.title = element_text(face = "bold", size = 16, color = qqq_pal$text_dark, margin = margin(b = 10)),
      plot.subtitle = element_text(size = 12, color = qqq_pal$secondary, margin = margin(b = 10)),
      plot.caption = element_text(size = 9, color = qqq_pal$text_gray, margin = margin(t = 10)),
      axis.title = element_text(face = "bold", size = 11, color = qqq_pal$text_gray),
      axis.text = element_text(size = 10, color = qqq_pal$text_gray),
      axis.line.x = element_line(color = qqq_pal$secondary, size = 0.5),
      panel.grid.major = element_line(color = qqq_pal$grid, linetype = "dashed"),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      legend.background = element_rect(fill = "transparent", color = NA),
      legend.key = element_rect(fill = "transparent", color = NA)
    )
}

theme_set(theme_QQQ())
update_geom_defaults("line", list(color = qqq_pal$primary, size = 1.1))
update_geom_defaults("point", list(color = qqq_pal$secondary, size = 2))
update_geom_defaults("col", list(fill = qqq_pal$primary, color = NA))

tesla_pal <- list(
  bg        = "#ffffff",    # Tu --bg-li
  text_main = "#1f2937",    # Tu --text-dark
  text_gray = "#4b5563",    # Tu --text-medium
  primary   = "#00b894",    # Tu --accent-primary (Verde/Cian principal)
  secondary = "#06b6d4",    # Tu --accent-secondary (Cian claro)
  positive  = "#84cc16",    # Tu --accent-positive
  negative  = "#e17055",    # Tu --accent-negative
  grid      = "#f3f4f6"     # Un gris muy sutil para las rejillas
)

theme_tesla <- function() {
  theme_minimal(base_size = 14) +
    theme(
      plot.background = element_rect(fill = "transparent", color = NA),
      panel.background = element_rect(fill = "transparent", color = NA),
      text = element_text(color = tesla_pal$text_main, family = "sans"),
      plot.title = element_text(face = "bold", size = 16, color = tesla_pal$text_main, margin = margin(b = 10)),
      plot.subtitle = element_text(size = 12, color = tesla_pal$secondary, margin = margin(b = 10)),
      plot.caption = element_text(size = 9, color = tesla_pal$text_gray, margin = margin(t = 10)),
      axis.title = element_text(face = "bold", size = 11, color = tesla_pal$text_gray),
      axis.text = element_text(size = 10, color = tesla_pal$text_gray),
      axis.line.x = element_line(color = tesla_pal$secondary, size = 0.5), 
      panel.grid.major = element_line(color = tesla_pal$grid, linetype = "dashed"),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      legend.background = element_rect(fill = "transparent", color = NA),
      legend.key = element_rect(fill = "transparent", color = NA)
    )
}


```

---

# 1. Introducci√≥n

La capacidad de anticipar el comportamiento futuro de los precios en los mercados financieros constituye uno de los elementos centrales para la toma de decisiones de inversi√≥n estrat√©gicas y la gesti√≥n eficiente de portafolios. En el contexto de los mercados burs√°tiles globales, donde la incertidumbre es inherente y los patrones de precios reflejan complejas din√°micas de oferta y demanda, el desarrollo de modelos predictivos robustos cobra particular relevancia para inversionistas, analistas financieros y gestores de cartera.

El Invesco $QQQ Trust$ (QQQ) es uno de los fondos cotizados en bolsa (ETF) m√°s negociados a nivel mundial, con activos bajo gesti√≥n superiores a los 400 mil millones de d√≥lares. Este instrumento replica el √≠ndice $Nasdaq-100$, compuesto por las 100 empresas no financieras de mayor capitalizaci√≥n burs√°til listadas en el mercado Nasdaq, con una fuerte concentraci√≥n en el sector tecnol√≥gico que incluye l√≠deres como $Apple$, $Microsoft$, $NVIDIA$, $Amazon$ y $Alphabet$. Entre 2009 y 2019, el $QQQ$ se benefici√≥ significativamente de las econom√≠as de escala en software, el auge de los smartphones y el desarrollo de ecosistemas tecnol√≥gicos integrados. Esta composici√≥n convierte al $QQQ$ en un referente para analizar el comportamiento del sector tecnol√≥gico estadounidense y, por extensi√≥n, las tendencias de innovaci√≥n que impulsan la econom√≠a global.

La importancia de modelar series de precios como la del QQQ radica en m√∫ltiples factores. En primer lugar, los pron√≥sticos financieros juegan un papel fundamental en la formaci√≥n de expectativas de mercado e influyen directamente en las decisiones de inversi√≥n, la asignaci√≥n de activos y la evaluaci√≥n de riesgos. En segundo lugar, el an√°lisis cuantitativo de series temporales permite identificar patrones y comportamientos que proporcionan informaci√≥n valiosa para dise√±ar estrategias de inversi√≥n m√°s fundamentadas. La predicci√≥n espec√≠fica del $QQQ$ es particularmente importante porque replica el √≠ndice $Nasdaq-100$, concentrado en empresas tecnol√≥gicas l√≠deres en desarrollo de inteligencia artificial, computaci√≥n en la nube y ecosistemas digitales innovadores. Dado que el sector tecnol√≥gico representa uno de los mercados emergentes y con mayor potencial de crecimiento en la econom√≠a global, predecir el comportamiento del $QQQ$ permite anticipar tendencias en innovaci√≥n, evaluar correctamente la valuaci√≥n de activos tecnol√≥gicos y gestionar la exposici√≥n al riesgo en un sector de alta volatilidad que impulsa transformaciones estructurales en la econom√≠a mundial.

En este contexto, los modelos $ARIMA$ (AutoRegressive Integrated Moving Average) se han consolidado como uno de los enfoques m√°s utilizados para el pron√≥stico de series de tiempo, junto con los modelos de suavizado exponencial. Mientras que los modelos de suavizado exponencial se basan en una descripci√≥n de la tendencia y la estacionalidad en los datos, los modelos $ARIMA$ tienen como objetivo describir las autocorrelaciones presentes en la serie. Estos modelos integran tres componentes fundamentales: el componente autorregresivo (AR), que pronostica la variable de inter√©s utilizando una combinaci√≥n lineal de sus valores pasados; el componente de integraci√≥n (I), que transforma series no estacionarias en estacionarias mediante la aplicaci√≥n de diferencias sucesivas; y el componente de media m√≥vil (MA), que utiliza errores de pron√≥stico pasados en un modelo similar a la regresi√≥n.

Un aspecto fundamental previo al ajuste de modelos $ARIMA$ es la verificaci√≥n de la estacionariedad de la serie temporal. Una serie estacionaria es aquella cuyas propiedades no dependen del momento en que se observa; es decir, presenta media aproximadamente horizontal, varianza constante y no muestra patrones predecibles a largo plazo. Las series temporales con tendencias o estacionalidad no son estacionarias. Para identificar series no estacionarias, se emplean tanto herramientas gr√°ficas (la funci√≥n de autocorrelaci√≥n ACF de datos no estacionarios decrece lentamente) como pruebas estad√≠sticas formales, entre las que destaca el Test Aumentado de Dickey-Fuller, cuya hip√≥tesis nula establece que los datos son no estacionarios.

El presente estudio emplea datos hist√≥ricos del ETF $QQQ$ obtenidos de Yahoo Finance, abarcando el per√≠odo comprendido entre el 7 de octubre de 2022 y el 2 de diciembre de 2025, con un total de 791 observaciones diarias de precios de cierre. Durante este per√≠odo, el precio del $QQQ$ fluctu√≥ entre un m√≠nimo de \$260.10 y un m√°ximo de \$635.77, con un precio promedio de \$435.84 y una desviaci√≥n est√°ndar de \$97.95. El rendimiento acumulado del per√≠odo alcanz√≥ un notable 131.14%, reflejando la fuerte recuperaci√≥n del sector tecnol√≥gico tras el mercado bajista de 2022 y el impulso generado por desarrollos en inteligencia artificial. La volatilidad anualizada de la serie se ubic√≥ en aproximadamente 21.12%, caracter√≠stica de instrumentos con alta exposici√≥n al sector tecnol√≥gico.

El an√°lisis incluye la verificaci√≥n de supuestos estad√≠sticos fundamentales: evaluaci√≥n de estacionariedad mediante la prueba de $Dickey-Fuller$ Aumentada y an√°lisis gr√°fico de las funciones de autocorrelaci√≥n (ACF) y autocorrelaci√≥n parcial (PACF), la selecci√≥n del modelo √≥ptimo utilizando criterios de informaci√≥n (AICc), y la validaci√≥n diagn√≥stica de residuos para confirmar que se comporten como ruido blanco. Se comparan m√∫ltiples especificaciones $ARIMA$, incluyendo el modelo seleccionado autom√°ticamente mediante la funci√≥n `auto.arima` y configuraciones alternativas sugeridas por el an√°lisis de los gr√°ficos $ACF$ y $PACF$, reconociendo que aunque la automatizaci√≥n es √∫til, "cualquier cosa automatizada puede ser un poco peligrosa, y vale la pena entender algo sobre el comportamiento de los modelos".

---

# 2. Metodolog√≠a

La metodolog√≠a adoptada sigue el procedimiento est√°ndar de modelamiento de series temporales propuesto en la literatura Box-Jenkins: se particiona el conjunto de datos en un conjunto de entrenamiento destinado a la estimaci√≥n de par√°metros y validaci√≥n de modelos candidatos, y un conjunto de prueba para evaluar la capacidad predictiva fuera de muestra. Este dise√±o respeta la naturaleza secuencial de datos financieros, evitando la fuga de informaci√≥n que comprometer√≠a la validez de los pron√≥sticos.

---

## 2.1 Base de Datos

La base de datos utilizada proviene de Yahoo Finance, plataforma reconocida globalmente para obtenci√≥n de datos financieros hist√≥ricos de alta calidad y frecuencia diaria. Se extrajo informaci√≥n del ETF Invesco QQQ Trust (s√≠mbolo: QQQ), el cual replica el √≠ndice Nasdaq-100 compuesto por las 100 empresas no financieras de mayor capitalizaci√≥n burs√°til listadas en el mercado Nasdaq, con fuerte concentraci√≥n en sector tecnol√≥gico (Apple, Microsoft, NVIDIA, Amazon, Alphabet, Tesla, Meta).

La extracci√≥n se realiz√≥ mediante la funci√≥n `getSymbols()` del paquete `quantmod` de R, automatizando la descarga directa desde fuente oficial. El per√≠odo de estudio abarca desde 7 de octubre de 2022 hasta 2 de diciembre de 2025, capturando 791 observaciones diarias de precios de cierre. Este per√≠odo es particularmente informativo: incluye recuperaci√≥n post-crisis 2022, impulso del rally de inteligencia artificial (2023-2025), cambios en pol√≠tica monetaria de la Reserva Federal, y volatilidad estructural del sector tecnol√≥gico.

```{r cargar-datos, echo=TRUE}

serie_QQQ <- getSymbols("QQQ", src="yahoo", auto.assign=FALSE, from="2015-01-01") 
Precio <- serie_QQQ$`QQQ.Close`

```

---

## 2.2 Variable de An√°lisis

El dataset se centra en una √∫nica variable cuantitativa de inter√©s: **precio de cierre diario del ETF QQQ**. Esta variable representa el √∫ltimo precio de negociaci√≥n durante cada sesi√≥n burs√°til y es la medida est√°ndar en an√°lisis t√©cnico y modelizaci√≥n de series financieras.

La elecci√≥n del precio de cierre se fundamenta en que: (i) refleja el consenso del mercado al finalizar cada sesi√≥n, incorporando informaci√≥n completa del d√≠a; (ii) es el referente para c√°lculo de rendimientos y valoraci√≥n de portafolios; (iii) es utilizado en la mayor√≠a de indicadores t√©cnicos y modelos predictivos; (iv) su disponibilidad es consistente sin interrupciones en d√≠as h√°biles.

---

## 2.3 Partici√≥n Temporal de Datos

En an√°lisis de series temporales, la partici√≥n de datos debe respetar el orden cronol√≥gico, diferenci√°ndose fundamentalmente de validaci√≥n cruzada aleatoria. La estrategia implementada divide la serie en dos subconjuntos contiguos:

- **Conjunto de Entrenamiento:** Comprende la mayor√≠a de observaciones hist√≥ricas (aproximadamente 95% de datos), utilizado para identificar par√°metros √≥ptimos del modelo ARIMA, estimar coeficientes y evaluar criterios de informaci√≥n.

- **Conjunto de Prueba:** Representa per√≠odo posterior no utilizado durante ajuste (aproximadamente 5% de datos), destinado a evaluar capacidad predictiva en escenario realista de pron√≥stico.

Esta metodolog√≠a es esencial porque: (i) evita "fuga de informaci√≥n" (data leakage) donde datos futuros influir√≠an en predicci√≥n del pasado; (ii) mantiene estructura cronol√≥gica respetando dependencias temporales inherentes a series financieras; (iii) simula condiciones reales donde pron√≥sticos se generan sin conocimiento de valores posteriores; (iv) proporciona m√©tricas objetivas de desempe√±o ex-post que validan capacidad predictiva genuina.

---

## 2.4 Marco Conceptual: Modelos ARIMA(p,d,q)

Los modelos ARIMA (AutoRegressive Integrated Moving Average), desarrollados por Box y Jenkins en 1970, constituyen metodolog√≠a sistem√°tica y robusta para an√°lisis y pron√≥stico de series temporales. Se fundamentan en la idea de que el valor actual de una serie puede explicarse mediante: (i) sus valores hist√≥ricos (componente autorregresivo), (ii) transformaciones que alcancen estacionariedad (componente integrador), o (iii) errores de pron√≥stico pasados (componente de media m√≥vil).

A diferencia de modelos de regresi√≥n que requieren variables explicativas externas, los modelos ARIMA son **univariados**, extrayendo toda informaci√≥n predictiva de la propia historia de la serie. Esta caracter√≠stica los hace especialmente valiosos en contextos financieros donde no se dispone de predictores externos confiables, o donde el objetivo es capturar din√°micas intr√≠nsecas de evoluci√≥n temporal.

### 2.4.1 Componente Autorregresivo AR(p)

El modelo AR(p) pronostica la variable utilizando combinaci√≥n lineal de sus valores pasados:

$$y_t = c + \phi_1 y_{t-1} + \phi_2 y_{t-2} + \cdots + \phi_p y_{t-p} + \varepsilon_t$$

donde:
- $y_t$ es el valor de la serie en tiempo $t$
- $c$ es constante (intercepto o drift)
- $\phi_1, \phi_2, \ldots, \phi_p$ son coeficientes autorregresivos que miden influencia de cada rezago
- $\varepsilon_t$ es t√©rmino de error (ruido blanco) con $E[\varepsilon_t]=0$ y varianza $\sigma^2$ constante

El coeficiente $\phi_1$ en AR(1) indica **persistencia de la serie**: valores cercanos a 1 implican alta persistencia (shocks tienen efectos duraderos), mientras que valores cercanos a 0 indican reversi√≥n r√°pida a media. Para que modelo sea estacionario, los coeficientes deben satisfacer restricciones espec√≠ficas (ra√≠ces del polinomio caracter√≠stico fuera del c√≠rculo unitario).

La interpretaci√≥n econ√≥mica es que si una serie ha estado elevada en per√≠odo anterior, tiende a permanecer elevada actualmente, capturando inercia o persistencia en comportamiento de variable.

### 2.4.2 Componente de Media M√≥vil MA(q)

El modelo MA(q) utiliza errores de pron√≥stico pasados en lugar de valores hist√≥ricos de variable:

$$y_t = c + \varepsilon_t + \theta_1 \varepsilon_{t-1} + \theta_2 \varepsilon_{t-2} + \cdots + \theta_q \varepsilon_{t-q}$$

donde $\theta_1, \ldots, \theta_q$ son coeficientes de media m√≥vil.

La interpretaci√≥n econ√≥mica es que shocks o sorpresas en serie tienen efectos **transitorios** que se disipan gradualmente. Esto captura comportamientos donde precios regresan a nivel promedio tras perturbaci√≥n, en lugar de permanecer desplazados permanentemente. En contextos financieros, MA modela la reversi√≥n a media que caracteriza a mercados relativamente eficientes en corto plazo.

### 2.4.3 Componente de Integraci√≥n I(d)

Muchas series econ√≥micas y financieras **no son estacionarias** en forma original, presentando tendencias, medias cambiantes, o varianzas no constantes. Una serie estacionaria tiene propiedades estad√≠sticas (media, varianza, autocovarianzas) invariantes en tiempo; una serie no-estacionaria exhibe comportamientos dependientes del momento observado.

El componente de integraci√≥n aborda esto mediante **diferenciaci√≥n**, transformaci√≥n que calcula cambios entre observaciones consecutivas:

$$y'_t = y_t - y_{t-1} = \Delta y_t$$

Esta operaci√≥n (primera diferencia) elimina tendencias lineales y estabiliza media. Si una diferencia es insuficiente para estacionariedad, se aplica segunda diferencia:

$$y''_t = y'_t - y'_{t-1} = \Delta^2 y_t$$

El par√°metro $d$ indica n√∫mero de diferencias necesarias para que serie se vuelva estacionaria. Una serie que requiere $d$ diferencias se denomina "integrada de orden $d$", denotada I(d). En pr√°ctica, rara vez se requieren m√°s de dos diferencias; para series financieras como precios de activos, t√≠picamente $d=1$ es suficiente.

### 2.4.4 Formulaci√≥n Compacta con Operador de Rezago

Combinando los tres componentes, el modelo ARIMA(p,d,q) se expresa compactamente usando operador de rezago $B$ (donde $B y_t = y_{t-1}$):

$$\Phi(B)(1-B)^d y_t = c + \Theta(B) \varepsilon_t$$

donde:
- $\Phi(B) = 1 - \phi_1 B - \phi_2 B^2 - \cdots - \phi_p B^p$ es polinomio autorregresivo
- $(1-B)^d$ es operador de diferenciaci√≥n aplicado $d$ veces
- $\Theta(B) = 1 + \theta_1 B + \theta_2 B^2 + \cdots + \theta_q B^q$ es polinomio de media m√≥vil

Esta representaci√≥n facilita an√°lisis te√≥rico y derivaci√≥n de propiedades estad√≠sticas. Su elegancia radica en capturar din√°micas complejas mediante combinaci√≥n sistem√°tica de componentes que act√∫an en niveles distintos: AR modela persistencia, MA modela efectos de shocks transitorios, I transforma serie hacia propiedades deseadas.

### 2.4.5 Supuestos Fundamentales del Modelo

Para que inferencias y pron√≥sticos derivados de ARIMA sean v√°lidos y confiables, deben cumplirse supuestos sobre naturaleza de serie y sus residuos:

1. **Estacionariedad:** Serie temporal debe presentar estacionariedad en media y varianza, i.e., propiedades estad√≠sticas permanecen aproximadamente constantes en tiempo. Esto asegura que relaciones identificadas entre observaciones son estables y predecibles, en lugar de resultado de tendencias determin√≠sticas no modeladas.

2. **Ruido Blanco en Residuos:** Los residuos del modelo ajustado deben comportarse como secuencia aleatoria e independiente sin patrones sistem√°ticos. Si residuos contienen estructura, sugiere que modelo no ha capturado completamente din√°mica temporal, requiriendo respecificaci√≥n.

3. **Homocedasticidad:** Se asume que errores tienen varianza constante a trav√©s del tiempo. Violaciones (heteroscedasticidad o volatilidad que cambia en tiempo) comprometen precisi√≥n de intervalos de confianza.

4. **Normalidad de Residuos:** Aunque no es estrictamente necesaria para estimaci√≥n del modelo, la normalidad es deseable para construcci√≥n precisa de intervalos de confianza y validez de pruebas de hip√≥tesis sobre par√°metros.

---

## 2.5 Herramientas Estad√≠sticas para Identificaci√≥n y Validaci√≥n

### 2.5.1 Prueba Aumentada de Dickey-Fuller (ADF)

La estacionariedad es requisito previo fundamental antes de modelizaci√≥n ARIMA. Una serie no-estacionaria producir√≠a inferencias enga√±osas y pron√≥sticos poco confiables.

La **Prueba Aumentada de Dickey-Fuller (ADF)** es contraste estad√≠stico est√°ndar para evaluaci√≥n formal. Contrasta:
- $H_0$: Serie tiene ra√≠z unitaria (no-estacionaria)
- $H_1$: Serie es estacionaria

El resultado de esta prueba determina el orden de integraci√≥n $d$: si serie original rechaza $H_0$ (p-valor < 0.05), se procede a diferenciar y repetir hasta lograr estacionariedad. El estad√≠stico ADF compara contra valores cr√≠ticos tabulados; si estad√≠stico de prueba es m√°s negativo que valor cr√≠tico (mayor en magnitud), se rechaza $H_0$.

### 2.5.2 Funciones de Autocorrelaci√≥n: ACF y PACF

Las funciones de autocorrelaci√≥n proporcionan **diagn√≥stico visual** fundamental para entender patrones de dependencia temporal y sugerir especificaciones ARIMA iniciales.

**Funci√≥n de Autocorrelaci√≥n (ACF):** Cuantifica correlaci√≥n lineal entre observaciones separadas por rezagos 1, 2, ..., k. Su comportamiento es diagn√≥stico:
- En series estacionarias: ACF decae gradualmente hacia cero
- En series no-estacionarias: ACF persiste en valores altos durante muchos rezagos

Para identificaci√≥n de modelo, ACF es especialmente √∫til para distinguir procesos MA(q): un corte abrupto despu√©s de rezago $q$ (i.e., autocorrelaciones significativas hasta lag $q$ luego caen a cero dentro de bandas) sugiere componente MA(q).

**Funci√≥n de Autocorrelaci√≥n Parcial (PACF):** Elimina influencia de rezagos intermedios, aislando efecto directo de cada rezago sobre presente. Es especialmente informativa para identificar procesos AR(p): un corte abrupto despu√©s de rezago $p$ sugiere componente AR(p).

El an√°lisis combinado de ACF y PACF proporciona indicios valiosos sobre especificaci√≥n inicial del modelo, aunque debe complementarse con criterios estad√≠sticos formales.

### 2.5.3 B√∫squeda Autom√°tica: Funci√≥n auto.arima()

En pr√°ctica moderna, la funci√≥n `auto.arima()` automatiza gran parte del proceso de identificaci√≥n mediante algoritmos de b√∫squeda sistem√°tica. Realiza b√∫squeda sobre rango especificado de valores para $p$, $d$ y $q$, evaluando cada combinaci√≥n mediante criterios de informaci√≥n como AICc.

Sin embargo, es importante reconocer limitaciones: un modelo automatizado puede omitir especificaciones que, aunque menos √≥ptimas seg√∫n criterios puramente estad√≠sticos, podr√≠an ser preferibles bajo consideraciones te√≥ricas o interpretativas. Por ello, resulta valioso complementar b√∫squeda autom√°tica con an√°lisis visual de ACF/PACF, permitiendo que teor√≠a econ√≥mica y conocimiento del dominio del problema informen especificaci√≥n final.

### 2.5.4 Criterios de Selecci√≥n del Modelo: AICc

Cuando m√∫ltiples especificaciones ARIMA son candidatas, es necesario criterio objetivo para elegir entre ellas. Los **criterios de informaci√≥n** cumplen este rol al balancear calidad del ajuste con complejidad del modelo.

El **AICc (Criterio de Informaci√≥n de Akaike Corregido)** es criterio m√°s utilizado en pr√°ctica para selecci√≥n de modelos ARIMA. Eval√∫a verosimilitud del modelo (qu√© tan bien se ajusta a datos) y aplica penalizaci√≥n por agregar par√°metros adicionales, reduciendo tendencia al sobreajuste. Su f√≥rmula es:

$$\text{AICc} = \text{AIC} + \frac{2(p+q+k+1)(p+q+k+2)}{T-p-q-k-2}$$

donde:
- $T$ es n√∫mero de observaciones
- $p$ y $q$ son √≥rdenes del modelo ARIMA
- $k$ es n√∫mero de par√°metros adicionales (como constante)

El t√©rmino adicional respecto al AIC cl√°sico corrige sesgo que ocurre en muestras peque√±as. **Especificaciones con menor AICc son preferibles**, indicando mejor balance entre ajuste y parsimonia.

**Aspecto cr√≠tico:** Criterios de informaci√≥n NO son aplicables para seleccionar orden de diferenciaci√≥n $d$, pues diferenciaci√≥n altera escala de datos sobre cual se computa verosimilitud, haciendo valores de AICc no comparables entre modelos con diferente $d$. Por ello, par√°metro $d$ se determina primero mediante pruebas de estacionariedad (ADF), y AICc se utiliza posteriormente para optimizar √≥rdenes $p$ y $q$.

### 2.5.5 Diagn√≥stico de Residuos: Prueba de Ljung-Box

Despu√©s de ajustar modelo ARIMA espec√≠fico, es necesario verificar que modelo haya capturado adecuadamente estructura temporal.

La **Prueba de Ljung-Box** es contraste estad√≠stico que eval√∫a si existe autocorrelaci√≥n significativa en residuos. Contrasta:
- $H_0$: Residuos son ruido blanco independiente (sin autocorrelaci√≥n)
- $H_1$: Residuos contienen autocorrelaci√≥n significativa

Si residuos conservan autocorrelaci√≥n, es se√±al de que modelo especificado no ha extra√≠do completamente informaci√≥n temporal disponible, requiriendo respecificaci√≥n con √≥rdenes m√°s altos. Un p-valor elevado (> 0.05) indica que residuos se comportan consistentemente con ruido blanco, suministrando confianza en que modelo ha cumplido su prop√≥sito de modelar adecuadamente din√°mica temporal de serie.

---

## 2.6 Procedimiento Metodol√≥gico: Metodolog√≠a Box-Jenkins

La metodolog√≠a Box-Jenkins propone proceso iterativo sistem√°tico para modelizaci√≥n ARIMA. El procedimiento implementado en este an√°lisis sigue estos pasos secuenciales:

### Paso 1: Determinaci√≥n del Orden de Integraci√≥n (d)

Se eval√∫a estacionariedad de serie mediante pruebas formales (ADF) y an√°lisis visual de ACF. Se identifica n√∫mero de diferencias necesarias para que serie se vuelva estacionaria:
- Si serie original es estacionaria: $d=0$
- Si primera diferencia es estacionaria: $d=1$
- Si segunda diferencia es estacionaria: $d=2$

El par√°metro $d$ es determinado independientemente de $p$ y $q$, antes de cualquier comparaci√≥n de criterios de informaci√≥n.

### Paso 2: An√°lisis Exploratorio de ACF y PACF

Se examinan gr√°ficos de autocorrelaci√≥n para serie potencialmente diferenciada, obteniendo sugerencias preliminares sobre √≥rdenes $p$ y $q$:
- Si ACF corta abruptamente en lag $q$: sugiere MA(q)
- Si PACF corta abruptamente en lag $p$: sugiere AR(p)
- Si ambos decaen gradualmente: sugiere proceso mixto ARMA(p,q)

### Paso 3: Identificaci√≥n de Modelos Candidatos

Se identifican especificaciones ARIMA plausibles basadas en:
- An√°lisis visual de ACF/PACF
- B√∫squeda autom√°tica mediante `auto.arima()`
- Consideraciones de parsimonia (preferir modelos simples)
- Teor√≠a econ√≥mica/financiera sobre comportamiento de variable

Se ajustan m√∫ltiples modelos candidatos con diferentes combinaciones de $(p,d,q)$.

### Paso 4: Estimaci√≥n Comparativa y Selecci√≥n

Se comparan especificaciones mediante:
- Criterios de informaci√≥n (AICc, AIC, BIC)
- M√©tricas de precisi√≥n en datos de entrenamiento (RMSE, MAE, MAPE)
- Principio de parsimonia: preferir modelos m√°s simples si diferencias en ajuste son marginales

Se selecciona modelo que balanc√©a mejor ajuste con complejidad.

### Paso 5: Validaci√≥n Diagn√≥stica de Residuos

Se examinan residuos del modelo seleccionado mediante:
- An√°lisis gr√°fico temporal de residuos (verificar media cero, varianza constante)
- Gr√°fico de ACF de residuos (verificar ausencia de autocorrelaci√≥n)
- Q-Q plot (verificar aproximaci√≥n a normalidad)
- Prueba de Ljung-Box (verificar formalmente que residuos son ruido blanco)

Si residuos no se comportan como ruido blanco, se regresa a Paso 3 para respecificaci√≥n.

### Paso 6: Generaci√≥n de Pron√≥sticos

Una vez validado modelo, se procede a:
- Pron√≥sticos puntuales sobre conjunto de prueba
- Intervalos de confianza (t√≠picamente 95%) que cuantifican incertidumbre
- Evaluaci√≥n ex-post comparando predicciones contra valores reales observados

---

## 2.7 M√©tricas de Evaluaci√≥n del Desempe√±o Predictivo

Para evaluar objetivamente precisi√≥n de pron√≥sticos generados por modelo ARIMA en conjunto de prueba, se emplean m√©tricas cuantitativas est√°ndar:

**RMSE (Root Mean Squared Error):**

$$\text{RMSE} = \sqrt{\frac{1}{n} \sum_{t=1}^{n} (\hat{y}_t - y_t)^2}$$

Amplifica penalizaciones sobre errores grandes, siendo sensible a presencia de valores at√≠picos en errores de pron√≥stico. √ötil para identificar si modelo comete errores sistem√°ticamente grandes en alg√∫n per√≠odo.

**MAE (Mean Absolute Error):**

$$\text{MAE} = \frac{1}{n} \sum_{t=1}^{n} |\hat{y}_t - y_t|$$

Proporciona medida de error promedio menos sensible a outliers que RMSE, ofreciendo perspectiva m√°s robusta de desempe√±o general. Tiene interpretaci√≥n directa: en promedio, predicciones desviaci√≥n esta cantidad del valor real.

**MAPE (Mean Absolute Percentage Error):**

$$\text{MAPE} = \frac{100}{n} \sum_{t=1}^{n} \left| \frac{y_t - \hat{y}_t}{y_t} \right|$$

Expresa error como porcentaje relativo del valor observado, permitiendo comparabilidad del desempe√±o independientemente de magnitud absoluta de valores predichos. Especialmente √∫til en contextos financieros donde escala de precios var√≠a.

**Cobertura de Intervalos de Confianza:**

Se eval√∫a proporci√≥n de valores reales que caen dentro de intervalos de confianza predichos (t√≠picamente 95%). Una calibraci√≥n correcta sugiere que incertidumbre fue estimada apropiadamente; demasiadas observaciones fuera del intervalo sugiere que modelo subestim√≥ volatilidad.

---


# 3. An√°lisis descriptivo

En esta secci√≥n se presenta un an√°lisis descriptivo exhaustivo de la serie hist√≥rica del ETF QQQ (Invesco QQQ Trust) ‚Äîutilizado aqu√≠ como proxy del desempe√±o conjunto de las empresas del Nasdaq-100‚Äî recuperada program√°ticamente desde Yahoo Finance. La serie cubre desde el 1 de mayo de 1999 hasta 2025 y trabaja en frecuencia diaria; la variable base es el precio de cierre ajustado, a partir del cual se calculan rendimientos, logar√≠tmicos diarios, mensuales y anuales, as√≠ como medidas de riesgo y desempe√±o.
El prop√≥sito central de este bloque es ofrecer una visi√≥n integrada y reproducible de (i) la evoluci√≥n temporal acumulada del precio del QQQ, (ii) la estructura actual del instrumento ‚Äîpor sectores y principales holdings‚Äî y (iii) un conjunto de estad√≠sticas descriptivas y m√©tricas financieras que cuantifiquen nivel, dispersi√≥n, asimetr√≠a, colas y riesgos extremos. 
Las visualizaciones incluyen gr√°ficos interactivos para facilitar la exploraci√≥n temporal, un gr√°fico de asignaci√≥n sectorial, un diagrama de empaquetamiento circular para las mayores participaciones, histogramas y densidades de retornos, boxplots por a√±o, heatmap estacional mensual y comparaciones normalizadas frente a otros ETFs de mercado . Adem√°s, se presenta un resumen anual con volatilidad y drawdown por a√±o para identificar episodios de estr√©s y recuperaci√≥n, as√≠ como una cronolog√≠a de hitos tecnol√≥gicos relevantes que permite contextualizar inflexiones recientes en la din√°mica del QQQ.
La interpretaci√≥n de los resultados prioriza tres ejes: nivel y tendencia de largo plazo, din√°mica de riesgo (volatilidad y drawdowns) y concentraci√≥n (sectorial y por holdings), con el objetivo de brindar una base s√≥lida para cualquier an√°lisis inferencial o de modelado posterior.

## 3.1.1 serie QQQ historica 

```{r serie, echo=TRUE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
library(xts)
library(tidyquant)
library(tidyverse)
library(plotly)
library(viridis)
library(reshape2)
library(zoo)
library(PerformanceAnalytics)
library(quantmod)
library(knitr)
library(moments)
library(packcircles)
library(tidyr)
library(lubridate)
serie <- getSymbols('QQQ', src='yahoo', auto.assign=FALSE, from="1999-05-01")
precios <- serie$QQQ.Close
datos_qqq <- data.frame(
  Fecha = index(precios),
  Precio = as.numeric(precios)
)
datos_qqq <- datos_qqq %>%
  mutate(Corte = as.yearqtr(Fecha)) 
lista_frames <- lapply(unique(datos_qqq$Corte), function(c) {
  dt <- datos_qqq[datos_qqq$Corte <= c, ]
  dt$Frame <- as.character(c) 
  return(dt)
})

datos_animados <- dplyr::bind_rows(lista_frames)
p <- ggplot(datos_animados, aes(x = Fecha, y = Precio)) +
  
  geom_area(aes(frame = Frame), fill = tesla_pal$primary, alpha = 0.1, position = "identity") +
  
  geom_line(aes(frame = Frame), color = tesla_pal$primary, size = 0.8) +
  
  labs(
    title = "Evoluci√≥n Din√°mica del QQQ",
    subtitle = "Crecimiento hist√≥rico acumulado",
    x = "", 
    y = "Precio (USD)"
  ) +
  scale_y_continuous(labels = scales::dollar_format()) +
  theme_tesla() +
  theme(plot.title = element_text(size = 14))

plotly::ggplotly(p, tooltip = c("x", "y")) %>%
  plotly::layout(
    paper_bgcolor = 'rgba(0,0,0,0)',
    plot_bgcolor = 'rgba(0,0,0,0)',
    font = list(family = "Inter, sans-serif", color = tesla_pal$text_gray),
    hovermode = "x unified"
  ) %>%
  plotly::animation_opts(
    frame = 100,       
    transition = 0,    
    redraw = FALSE     
  ) %>%
  plotly::animation_slider(
    currentvalue = list(prefix = "Periodo: ") 
  ) %>%
  plotly::config(displayModeBar = FALSE)
```


La evoluci√≥n hist√≥rica del QQQ muestra una tendencia alcista secular con crecimiento claramente exponencial: el precio ha pasado de niveles inferiores a los 100 USD en el a√±o 2000 a superar los 600 USD en 2025, revelando una din√°mica de crecimiento compuesto que justifica el uso de rendimientos logar√≠tmicos para evitar distorsiones visuales y estad√≠sticas en series con fuerte convexidad (Tsay, 2010). A lo largo de esta trayectoria se observan episodios de estr√©s que estructuran la narrativa de riesgo: el colapso de la Burbuja Dot-Com (2000‚Äì2002), cuyo drawdown tard√≥ m√°s de una d√©cada en recuperarse, constituye un ejemplo protot√≠pico de riesgo de cola y rupturas prolongadas de tendencia (Malkiel, 2003); la Crisis Financiera de 2008 introduce un segundo punto de inflexi√≥n, seguido a√±os despu√©s por la correcci√≥n de 2022 asociada al ciclo de aumentos de tasas de la Reserva Federal. Estos episodios confirman que la volatilidad no es constante, sino que se concentra en periodos espec√≠ficos, tal como lo sugiere la literatura cl√°sica sobre colas pesadas y agrupamiento de volatilidad (Mandelbrot, 1963), lo que respalda el uso de densidades de retornos, m√©tricas de drawdown y boxplots anuales como parte del an√°lisis descriptivo. En el extremo derecho del gr√°fico ‚Äîel periodo 2023-2025‚Äî aparece una aceleraci√≥n sin precedentes atribuible al auge de la inteligencia artificial generativa, fen√≥meno coherente con la ‚Äúcronolog√≠a de hitos tecnol√≥gicos‚Äù mencionada en el an√°lisis y con la marcada concentraci√≥n del QQQ en mega-caps como NVIDIA, Microsoft y Apple, cuya participaci√≥n desproporcionada impulsa el √≠ndice (Invesco, 2024). En conjunto, la trayectoria refleja una combinaci√≥n de convexidad positiva de largo plazo, episodios de estr√©s profundos y una creciente concentraci√≥n tecnol√≥gica, elementos que explican simult√°neamente su alto retorno hist√≥rico y su exposici√≥n a volatilidad extrema.

## 4.1 Resumen anual retornos

```{r resumen_anual_tabla, echo=TRUE, warning=FALSE, message=FALSE}


if (!exists("precios")) {
  precios <- serie[,6]   
}
ret_diario <- dailyReturn(precios, type = "log")
ret_anual  <- yearlyReturn(precios, type = "log")
df_ann <- data.frame(Fecha = index(ret_anual), Ret = as.numeric(ret_anual))
df_ann <- df_ann %>% mutate(A√±o = year(Fecha), RetPct = Ret * 100)
vol_year <- ret_diario %>%
  data.frame(Fecha = index(ret_diario), Ret = as.numeric(ret_diario)) %>%
  mutate(A√±o = year(Fecha)) %>%
  group_by(A√±o) %>%
  summarise(
    Volatilidad = sd(Ret, na.rm = TRUE) * sqrt(252) * 100,
    RetornoTotal = sum(Ret) * 100
  )
dd_df <- data.frame(Fecha = index(ret_diario), Ret = as.numeric(ret_diario)) %>%
  mutate(A√±o = year(Fecha))

maxdd_yr <- dd_df %>% group_by(A√±o) %>%
  summarise(
    MaxDrawdown = min(cumprod(1 + Ret) / cummax(cumprod(1 + Ret)) - 1) * 100
  )
res_yr <- left_join(vol_year, maxdd_yr, by = "A√±o") %>% arrange(desc(A√±o))
kable(
  res_yr,
  format = "html",
  digits = 2,
  align = c("l", "r", "r", "r"),
  col.names = c("A√±o", "Volatilidad (%)", "Retorno Total (%)", "Max Drawdown (%)"),
  table.attr = "class='table' style='width:60%; margin:auto; font-size:18px;'"
)

```

La tabla de m√©tricas anualizadas proporciona una descomposici√≥n granular de la trayectoria del QQQ, permitiendo identificar distintos reg√≠menes de mercado que validan la hip√≥tesis de la no estacionariedad de la serie financiera. Los datos confirman que el retorno total no se distribuye uniformemente, sino que es el resultado de la alternancia entre periodos de expansi√≥n secular y shocks de volatilidad concentrada (Mandelbrot, 1963).

El inicio de la serie documenta cuantitativamente la magnitud del colapso de la Burbuja Dot-Com (2000‚Äì2002), un evento de riesgo de cola sin paralelo en la historia reciente del √≠ndice. Durante este trienio, la volatilidad se mantuvo sistem√°ticamente en niveles extremos (57.71%, 54.55% y 41.56%), acompa√±ando una destrucci√≥n de capital consecutiva con retornos del ‚Äì44.81%, ‚Äì40.56% y ‚Äì46.79% respectivamente. Este comportamiento confirma la presencia de persistencia en la varianza y corrobora que las rupturas de burbujas especulativas no son eventos instant√°neos, sino procesos de ajuste prolongado donde el drawdown profundiza su impacto por el efecto compuesto de las p√©rdidas (Shiller, 2000).

Tras un periodo de recuperaci√≥n y estabilidad relativa (2003‚Äì2007), el a√±o 2008 introduce un cambio de r√©gimen abrupto asociado a la Crisis Financiera Global. El retorno negativo del ‚Äì54.36% y el Max Drawdown del ‚Äì52.82% en un solo ejercicio subrayan la alta correlaci√≥n del sector tecnol√≥gico con el riesgo sist√©mico de mercado durante eventos de liquidez, a pesar de la naturaleza idiosincr√°tica de sus empresas subyacentes. Este episodio refuerza la observaci√≥n de que la diversificaci√≥n sectorial tiende a fallar precisamente cuando m√°s se necesita, debido al aumento generalizado de las correlaciones en momentos de p√°nico (Acharya et al., 2010).

La d√©cada posterior (2009‚Äì2019) ilustra la "Era Dorada" del crecimiento tecnol√≥gico, caracterizada por una compresi√≥n significativa de la volatilidad (con m√≠nimos de 10.34% en 2017 y 12.26% en 2013) y retornos positivos consistentes. Esta fase refleja la maduraci√≥n del Nasdaq-100 y el impacto de pol√≠ticas monetarias acomodaticias que favorecieron la expansi√≥n de m√∫ltiplos en empresas de crecimiento. Sin embargo, la ruptura de esta tendencia en 2022, con una ca√≠da del ‚Äì40.15% y un repunte de la volatilidad al 32.17%, valida emp√≠ricamente la sensibilidad del QQQ a la tasa de descuento: el ciclo de alzas de la Reserva Federal impact√≥ desproporcionadamente a los activos de larga duraci√≥n impl√≠cita, provocando una correcci√≥n de valoraciones coherente con los modelos fundamentales de precios (Bernanke & Kuttner, 2005).

Finalmente, el periodo m√°s reciente (2023‚Äì2025) evidencia una recuperaci√≥n vigorosa y r√°pida, con retornos del 43.04% en 2023 y 22.18% en 2024, impulsados por el cambio de paradigma hacia la Inteligencia Artificial Generativa. Aunque la volatilidad se ha moderado respecto a 2022 (descendiendo al rango del 17-24%), se mantiene por encima de los m√≠nimos de la d√©cada anterior, lo que sugiere que el mercado actual opera bajo una nueva estructura de riesgo, dependiente de la concentraci√≥n en mega-caps y las expectativas de productividad futura de la IA. En conjunto, la tabla demuestra que la capacidad del QQQ para generar riqueza a largo plazo (CAGR positivo) est√° intr√≠nsecamente ligada a la tolerancia del inversor para soportar periodos de volatilidad extrema y drawdowns profundos que act√∫an como el costo de entrada al crecimiento exponencial del sector.

## 3.1.2 Divisi√≥n sectorial 


```{r tortA, echo=TRUE, warning=FALSE, message=FALSE}

sectores <- data.frame(
  Sector = c("Tecnolog√≠a", "Consumo Discrecional", "Servicios de Comunicaci√≥n", 
             "Consumo B√°sico", "Industriales", "Salud", "Otros", 
             "Servicios P√∫blicos", "Materiales", "Energ√≠a"),
  Peso = c(53.60, 13.04, 12.61, 4.99, 4.58, 4.28, 3.22, 1.38, 1.25, 0.47)
)

colores_sector <- c(
  "#2b5c8a",
  "#5d5b94", 
  "#8e6fa3",
  "#c46d9e",
  "#e67586", 
  "#f38972", 
  "#f8a262",
  "#fbc058", 
  "#fce05d", 
  "#34495e"  
)
fig_pie <- plot_ly(sectores, labels = ~Sector, values = ~Peso, type = 'pie',
        textposition = 'outside',      
        textinfo = 'label+percent',    
        hoverinfo = 'label+value+percent',
        marker = list(
          colors = colores_sector, 
          line = list(color = '#ffffff', width = 1.5) 
        ),
        sort = FALSE, 
        automargin = TRUE
)

fig_pie <- fig_pie %>% layout(
  title = list(
    text = "<b>Asignaci√≥n Sectorial</b>",
    font = list(size = 22, family = "Poppins, sans-serif", color = tesla_pal$text_main),
    x = 0.05, 
    y = 0.95
  ),
  showlegend = FALSE, 
  margin = list(t = 80, b = 40, l = 80, r = 80), 
  paper_bgcolor = 'rgba(0,0,0,0)',
  plot_bgcolor = 'rgba(0,0,0,0)',
  font = list(family = "Inter, sans-serif", size = 12, color = tesla_pal$text_gray)
)

fig_pie

```

El gr√°fico de Asignaci√≥n Sectorial ratifica la identidad del QQQ no como un √≠ndice de mercado amplio, sino como un veh√≠culo de inversi√≥n tem√°tico con un sesgo factorial expl√≠cito: el sector Tecnolog√≠a ejerce una hegemon√≠a absoluta sobre la estructura del fondo, acaparando el 53.9% de los activos netos. Esta concentraci√≥n masiva desborda los l√≠mites tradicionales de la diversificaci√≥n sectorial, convirtiendo al ETF en un instrumento altamente sensible a los ciclos de innovaci√≥n y a las revisiones de valoraci√≥n espec√≠ficas de la industria tecnol√≥gica.

Esta preponderancia se ve magnificada por la correlaci√≥n estrat√©gica de los sectores secundarios: Consumo Discrecional (13.1%) y Servicios de Comunicaci√≥n (12.7%) ocupan el segundo y tercer lugar respectivamente. Desde una perspectiva fundamental, esta distribuci√≥n es enga√±osa, pues gran parte de los componentes de estos sectores (como Amazon en consumo o Alphabet/Meta en comunicaci√≥n) operan bajo din√°micas digitales similares a las tecnol√≥gicas puras. En consecuencia, cerca del 80% del portafolio se encuentra expuesto al factor Growth (Crecimiento), lo que implica una alta sensibilidad a la liquidez del mercado y al apetito por riesgo, distanci√°ndose de la estructura m√°s balanceada que ofrecen √≠ndices generalistas como el S&P 500 (MSCI, 2023).

Por el contrario, la participaci√≥n marginal de sectores defensivos y antic√≠clicos ‚Äîcomo Consumo B√°sico (5.02%), Salud (4.3%), Industriales (4.61%) y las asignaciones residuales en Servicios P√∫blicos (1.39%) y Energ√≠a (0.473%)‚Äî sugiere que el QQQ carece de los "amortiguadores" tradicionales contra la volatilidad macroecon√≥mica. Esta asimetr√≠a estructural dota al portafolio de una elevada duraci√≥n de acciones impl√≠cita, haci√©ndolo mec√°nicamente vulnerable a las variaciones en la tasa de descuento (tasas de inter√©s), una caracter√≠stica que explica la severidad de las correcciones observadas en 2022 cuando el costo del capital se increment√≥ (Bernstein, 1997).

## 3.3 Mayores Holdings 

```{r top10, echo=TRUE, warning=FALSE, message=FALSE}

top10 <- data.frame(
  ticker = c("NVDA","AAPL","MSFT","AVGO","AMZN","GOOGL","GOOG","TSLA","META","NFLX"),
  empresa = c("NVIDIA","Apple Inc.","Microsoft","Broadcom Inc.","Amazon.com, Inc.",
              "Alphabet Class A","Alphabet Class C","Tesla, Inc.","Meta Plataformas, Inc.","Netflix, Inc."),
  peso = c(9.33, 8.78, 7.69, 6.59, 5.21, 3.97, 3.71, 3.31, 2.93, 2.36),
  sector = c("Tecnolog√≠a","Tecnolog√≠a","Tecnolog√≠a","Tecnolog√≠a",
             "Consumo","Comunicaci√≥n","Comunicaci√≥n",
             "Consumo","Comunicaci√≥n","Consumo"),
  stringsAsFactors = FALSE
)

otros_val <- round(100 - sum(top10$peso), 2)
holdings <- bind_rows(top10,
                      data.frame(ticker="OTROS", empresa="Resto del QQQ",
                                 peso = otros_val, sector="Varios", stringsAsFactors = FALSE)) %>%
  arrange(desc(peso))

packing <- circleProgressiveLayout(holdings$peso, sizetype='area')
holdings_pack <- cbind(holdings, packing)
holdings_pack$id <- seq_len(nrow(holdings_pack))
holdings_pack <- holdings_pack %>% rename(center_x = x, center_y = y)

dat.gg <- circleLayoutVertices(packing, npoints = 100)
dat.gg <- merge(dat.gg, holdings_pack, by = "id")

holdings_pack <- holdings_pack %>%
  mutate(
    peso_label = gsub("\\.", ",", formatC(peso, digits = 2, format = "f")),
    hover_text = paste0(
      empresa, "\n",
      "Ticker: ", ticker, "\n",
      "Peso: ", peso_label, "%\n",
      "Sector: ", sector
    ),
    label_text = ifelse(peso >= 2.3, paste0(ticker, "\n", peso_label, "%"), "")
  )

fill_map <- c(
  "Tecnolog√≠a"   = tesla_pal$primary,
  "Consumo"      = tesla_pal$secondary,
  "Comunicaci√≥n" = "#3b82f6",
  "Varios"       = tesla_pal$text_gray
)

p_bubble <- ggplot() +
  geom_polygon(
    data = dat.gg,
    aes(x = x, y = y, group = id, fill = sector,
        text = holdings_pack$hover_text[match(id, holdings_pack$id)]),
    color = "white", size = 0.5, alpha = 0.95
  ) +
  geom_text(
    data = holdings_pack,
    aes(x = center_x, y = center_y, label = label_text, text = hover_text),
    size = 3.8, color = "white", fontface = "bold", lineheight = 0.9
  ) +
  scale_fill_manual(values = fill_map) +
  theme_void() +
  coord_equal() +
  labs(title = "Composici√≥n del Portafolio QQQ",
       subtitle = "Top holdings seg√∫n la imagen") +
  theme(
    plot.title = element_text(face = "bold", size = 16, color = tesla_pal$text_main, hjust = 0.5),
    plot.subtitle = element_text(size = 12, color = tesla_pal$text_gray, hjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    plot.margin = margin(10,10,10,10)
  )

ggplotly(p_bubble, tooltip = "text") %>%
  config(displayModeBar = FALSE) %>%
  layout(
    font = list(family = "Inter", color = tesla_pal$text_main),
    plot_bgcolor  = "rgba(0,0,0,0)",
    paper_bgcolor = "rgba(0,0,0,0)",
    legend = list(orientation = "h", yanchor = "bottom", y = -0.12, xanchor = "center", x = 0.5),
    hoverlabel = list(
      bgcolor = "rgba(255,255,255,0.97)",
      bordercolor = "rgba(0,0,0,0.08)",
      font = list(family = "Inter", color = tesla_pal$text_main, size = 11)
    )
  )
```

El diagrama de empaquetamiento circular revela la estructura interna del QQQ, evidenciando una alta concentraci√≥n jer√°rquica en un n√∫mero reducido de activos de mega-capitalizaci√≥n. Visualmente, el gr√°fico confirma que el rendimiento del √≠ndice no es el resultado de una contribuci√≥n homog√©nea, sino que depende desproporcionadamente de un cl√∫ster de empresas dominantes: las diez mayores posiciones (encabezadas por NVDA, AAPL, MSFT y AVGO) representan, en conjunto, m√°s del 50% del peso total del portafolio, relegando al segmento de "Otros" (el resto de los componentes del Nasdaq-100) a una participaci√≥n minoritaria del 46.12%. Esta arquitectura de cartera contradice el principio cl√°sico de diversificaci√≥n ingenua, exponiendo al inversor a un significativo riesgo idiosincr√°tico derivado del desempe√±o individual de estos gigantes tecnol√≥gicos (Markowitz, 1952).

La distribuci√≥n sectorial refuerza el sesgo hacia la innovaci√≥n: las burbujas predominantes en color verde (Tecnolog√≠a), azul (Comunicaci√≥n) y cian (Consumo Discrecional) ilustran que el QQQ es, en esencia, una apuesta factorial hacia el crecimiento y la econom√≠a digital, con una exposici√≥n m√≠nima a sectores defensivos tradicionales. Resulta particularmente notable que NVIDIA (9.33%) haya superado a Apple (8.78%) y Microsoft (7.69%) como el componente de mayor ponderaci√≥n, un cambio estructural que valida emp√≠ricamente la hip√≥tesis planteada en el an√°lisis de precios sobre el impacto disruptivo de la Inteligencia Artificial Generativa en la valoraci√≥n de activos recientes (Fama & French, 2015).

Desde una perspectiva de gesti√≥n de riesgos, esta configuraci√≥n explica la alta beta y la convexidad observada en la serie hist√≥rica: la correlaci√≥n positiva entre estos pocos activos l√≠deres amplifica tanto los rendimientos exponenciales en mercados alcistas como la severidad de los drawdowns en periodos de correcci√≥n, confirmando que la din√°mica del QQQ est√° intr√≠nsecamente ligada a la salud financiera y las expectativas de crecimiento de este selecto grupo de empresas (Sharpe, 1964).


## 3.4 An√°lisis Estad√≠stico precios

```{r tabla, echo=TRUE, warning=FALSE, message=FALSE}

serie_vec <- as.numeric(serie[,6])
serie_vec <- serie_vec[!is.na(serie_vec)]
if (max(serie_vec) > 1000) {
  warning("‚ö†Ô∏è La serie est√° por fuera del rango t√≠pico del QQQ (0‚Äì1000 USD)")
}

valores_calculados <- c(
  length(serie_vec),
  mean(serie_vec),
  median(serie_vec),
  min(serie_vec),
  max(serie_vec),
  max(serie_vec) - min(serie_vec),
  var(serie_vec),
  sd(serie_vec),
  skewness(serie_vec),
  kurtosis(serie_vec)
)

desc <- data.frame(
  M√©trica = c(
    "Observaciones Totales",
    "Media",
    "Mediana",
    "M√≠nimo",
    "M√°ximo",
    "Rango",
    "Varianza",
    "Desviaci√≥n Est√°ndar",
    "Asimetr√≠a (Skewness)",
    "Curtosis"
  ),
  Valor = format(
    round(valores_calculados, 4),
    scientific = FALSE,
    big.mark = ","
  )
)

kable(
  desc,
  format = "html",
  align = c('l', 'r'),
  table.attr = "class='table' style='width:60%; margin:auto; font-size:18px;'"
)

```

El an√°lisis de los momentos estad√≠sticos de la serie de precios confirma la naturaleza no estacionaria y la fuerte tendencia secular del QQQ. A diferencia de los rendimientos (que oscilan en torno a cero), las estad√≠sticas de nivel de precios revelan la magnitud de la apreciaci√≥n del capital a largo plazo y la asimetr√≠a temporal de la generaci√≥n de valor.

La discrepancia sustancial entre la Media ($134.57) y la Mediana ($66.88) es el hallazgo estructural m√°s revelador. Que el promedio sea m√°s del doble que la mediana indica una Asimetr√≠a Positiva (Skewness de 1.54) muy marcada. Financieramente, esto se interpreta como el reflejo num√©rico de la "d√©cada perdida": el ETF pas√≥ la mayor parte de su historia (representada por la mediana) cotizando en niveles bajos (inferiores a $70 USD) durante el largo proceso de recuperaci√≥n post-Burbuja Dot-Com. Sin embargo, la aceleraci√≥n exponencial de la √∫ltima d√©cada ha arrastrado el promedio hacia arriba, confirmando que la mayor parte de la apreciaci√≥n del valor se ha concentrado en el tramo final de la muestra (Tsay, 2010).

El Rango de operaci√≥n, que abarca desde un m√≠nimo de $16.96 (el suelo tras el colapso del 2002) hasta un m√°ximo hist√≥rico de $635.77 (el pico impulsado por la IA en 2025), cuantifica la convexidad del activo: una multiplicaci√≥n del capital por m√°s de 37 veces desde el valle hasta la cima. Esta dispersi√≥n masiva se captura en una Desviaci√≥n Est√°ndar de 141.17, una cifra que, en el contexto de niveles de precios, no debe leerse solo como riesgo, sino como una medida de la magnitud de la tendencia alcista (Trend Magnitude).

Finalmente, la Curtosis de 4.42 (superior a 3, indicando una distribuci√≥n leptoc√∫rtica) en la serie de precios sugiere que el QQQ tiende a operar en los extremos de su rango m√°s de lo que predecir√≠a una distribuci√≥n normal. En t√©rminos de mercado, esto valida la existencia de "colas gruesas" en la valoraci√≥n: el √≠ndice pasa periodos prolongados deprimido (como en 2002-2012) o periodos de euforia extendida (2020-2025), sin revertir r√°pidamente a la media hist√≥rica, comportamiento t√≠pico de los activos impulsados por la innovaci√≥n tecnol√≥gica y los ciclos de adopci√≥n (Malkiel, 2003).

## 3.5 Rendimientos Diarios

```{r tablarendimientos, echo=TRUE, warning=FALSE, message=FALSE}

precios <- serie$QQQ.Close
ret_diario  <- dailyReturn(precios, type = "log")
ret_mensual <- monthlyReturn(precios, type = "log")
ret_anual   <- yearlyReturn(precios, type = "log")
vol_anual <- sd(ret_diario) * sqrt(252)
resumen <- data.frame(
  Concepto = "Volatilidad Anualizada (Riesgo)",
  Valor = scales::percent(vol_anual, accuracy = 0.01)
)
kable(resumen, 
      format = "html", 
      table.attr = "class='table' style='width:50%; margin:auto;'")

```
El c√°lculo program√°tico de la volatilidad, derivado de la desviaci√≥n est√°ndar de los retornos logar√≠tmicos diarios proyectada a un horizonte de negociaci√≥n anual (sd(ret_diario) * sqrt(252)), arroja una cifra consolidada de 26.97%. Este valor no constituye meramente una medida de dispersi√≥n estad√≠stica, sino la cuantificaci√≥n escalar de la arquitectura de riesgo descrita en los apartados anteriores. Una volatilidad anualizada cercana al 27% sit√∫a al QQQ significativamente por encima del promedio hist√≥rico de √≠ndices de mercado amplio (cuyo rango est√°ndar suele oscilar entre 15% y 20%), validando num√©ricamente la tesis de la concentraci√≥n jer√°rquica del portafolio. Como se discuti√≥ en el an√°lisis de la distribuci√≥n de rendimientos, la estructura leptoc√∫rtica y las colas pesadas no son anomal√≠as, sino componentes intr√≠nsecos de este valor: el 26.97% representa el costo del riesgo idiosincr√°tico asumido al mantener una cartera donde m√°s del 50% del peso recae en un cl√∫ster reducido de mega-caps tecnol√≥gicas (Markowitz, 1952).

Al contrastar este dato con el an√°lisis de la serie hist√≥rica, se evidencia que esta m√©trica funciona como un promedio ponderado de dos reg√≠menes de mercado opuestos: los periodos de calma relativa y crecimiento org√°nico (como la d√©cada de 2010-2019) y los episodios de estallido de volatilidad identificados en la cronolog√≠a (la Burbuja Dot-Com, la Crisis Financiera de 2008 y la correcci√≥n de tasas de 2022). Estos eventos de estr√©s act√∫an como "shocks" que inflan la desviaci√≥n est√°ndar hist√≥rica, confirmando la presencia de agrupamiento de volatilidad (volatility clustering) caracter√≠stico de las series financieras no estacionarias (Mandelbrot, 1963).

En consecuencia, el nivel de 26.97% confirma la naturaleza del QQQ como un activo de alta beta y alta convexidad: ofrece la capacidad de captura de crecimiento exponencial observada en la tendencia de precios a largo plazo, pero exige al inversor tolerar una variabilidad sustancial impulsada por la sensibilidad del sector tecnol√≥gico a la tasa de descuento y a las revisiones de expectativas de crecimiento futuro (Sharpe, 1964; Black, 1976).

## 3.6 Retornos Diarios

```{r tablaretrnosentos, echo=TRUE, warning=FALSE, message=FALSE}
ret_df <- data.frame(Retorno = as.numeric(ret_diario))

ggplot(ret_df, aes(x = Retorno)) +
  geom_histogram(aes(y = ..density..), bins = 60, fill = tesla_pal$primary, alpha = 0.4) +
  geom_density(color = tesla_pal$secondary, size = 1.2) +
  labs(title = "Distribuci√≥n de los Rendimientos Diarios del QQQ",
       x = "Retorno Diario (log)", y = "Densidad") +
  theme_tesla()

```

La distribuci√≥n de los rendimientos diarios del QQQ revela una estructura estad√≠stica coherente con la arquitectura altamente concentrada del portafolio descrita en los apartados anteriores. Como muestra el gr√°fico, la curva de densidad presenta un pico pronunciado alrededor de cero y colas m√°s gruesas de lo que predecir√≠a una distribuci√≥n normal, rasgo t√≠pico de activos dominados por empresas de gran capitalizaci√≥n fuertemente correlacionadas entre s√≠.

Este patr√≥n leptoc√∫rtico ‚Äîevidenciado visualmente por la altura central desproporcionada y la presencia de observaciones extremas (tanto positivas como negativas) en los m√°rgenes‚Äî es consistente con el comportamiento de un √≠ndice no diversificado de manera homog√©nea, sino fuertemente dependiente de unos pocos motores de crecimiento. En efecto, la concentraci√≥n estructural en NVDA, AAPL, MSFT y AVGO expuesta en el diagrama de empaquetamiento circular se manifiesta directamente en la forma de la distribuci√≥n:

cuando estas compa√±√≠as se sincronizan al alza, generan acumulaci√≥n de rendimientos peque√±os y frecuentes, que estrechan la parte central de la distribuci√≥n;

pero cuando experimentan shocks idiosincr√°ticos o correcciones de m√∫ltiplos, producen movimientos abruptos de mayor magnitud, responsables de las colas pesadas observadas.

Desde una perspectiva de riesgo, esta distribuci√≥n asim√©trica confirma una alta kurtosis y la presencia de eventos de gran impacto con mayor probabilidad que la predicha por modelos cl√°sicos de media-varianza (Markowitz, 1952). Ello es coherente con el sesgo factorial descrito previamente: un ETF con exposici√≥n cercana al 80% al factor Growth y m√≠nima participaci√≥n en sectores defensivos exhibir√° de forma natural una mayor propensi√≥n a "jumps" y episodios de volatilidad concentrada.

La ligera inclinaci√≥n de la distribuci√≥n hacia rendimientos negativos ‚Äîvisible en la cola izquierda m√°s extendida‚Äî es una expresi√≥n emp√≠rica de la sensibilidad del QQQ a cambios en la tasa de descuento, propiedad tambi√©n discutida en el an√°lisis sectorial. Durante ciclos de endurecimiento monetario, los activos de larga duraci√≥n impl√≠cita (como la tecnolog√≠a de mega-capitalizaci√≥n) tienden a exhibir ca√≠das m√°s pronunciadas, lo cual explica tanto la asimetr√≠a negativa como la convexidad detectada en la serie hist√≥rica (Sharpe, 1964).

En conjunto, la forma de la distribuci√≥n no solo plasma el comportamiento estad√≠stico de los rendimientos, sino que funciona como una evidencia visual directa de la propia identidad del QQQ:
un veh√≠culo altamente concentrado, dominado por factores de crecimiento, sensible a liquidez y a ciclos tecnol√≥gicos, y estructuralmente propenso a movimientos extremos m√°s frecuentes que los esperados bajo supuestos gaussianos.



```{r boxpllot, echo=TRUE, warning=FALSE, message=FALSE}

ret_anual_df <- data.frame(
  Fecha = index(ret_diario),
  Ret = as.numeric(ret_diario),
  A√±o = format(index(ret_diario), "%Y")
)

ggplot(ret_anual_df, aes(x = A√±o, y = Ret, group = A√±o)) +
  geom_boxplot(fill = tesla_pal$primary, alpha = 0.7) +
  labs(title = "Distribuci√≥n de los Retornos Diarios por A√±o (QQQ)",
       x = "A√±o", y = "Retorno Diario") +
  theme_tesla() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))

```

El gr√°fico de cajas por a√±o muestra de manera clara c√≥mo ha evolucionado la variabilidad de los retornos diarios del ETF QQQ desde 1999 hasta 2025. En los primeros a√±os, especialmente entre 1999 y 2002, se observan cajas mucho m√°s anchas y una mayor presencia de valores at√≠picos, tanto positivos como negativos. Esta dispersi√≥n refleja el contexto de la burbuja punto-com y su colapso, donde el sector tecnol√≥gico experiment√≥ altos niveles de incertidumbre y movimientos extremos. Los retornos muestran una volatilidad significativamente mayor que en el resto del periodo, evidenciada por whiskers largos y una nube densa de puntos alejados de la mediana.

A partir de 2003 y durante buena parte de la d√©cada siguiente, la distribuci√≥n anual de los retornos se vuelve m√°s estrecha. Entre 2004 y 2007, las cajas se estabilizan y los valores at√≠picos disminuyen, se√±alando un periodo de menor volatilidad en el sector tecnol√≥gico y un comportamiento m√°s predecible de la serie. No obstante, en 2008 aparece nuevamente una fuerte expansi√≥n de la dispersi√≥n: los outliers negativos son notablemente profundos y los positivos m√°s altos, lo que coincide perfectamente con la crisis financiera global. Es un a√±o donde el riesgo sistem√°tico se intensifica y el mercado reacciona con variaciones abruptas.

Durante los a√±os siguientes, especialmente entre 2009 y 2019, los retornos del QQQ muestran nuevamente un patr√≥n de estabilidad relativa. La mayor√≠a de las cajas son bajas, con medianas cercanas a cero y un rango intercuart√≠lico peque√±o, lo que sugiere un periodo prolongado de crecimiento econ√≥mico con correcciones moderadas. Sin embargo, la crisis del COVID-19 en 2020 trae un nuevo salto en la volatilidad: las cajas se expanden, aparecen retornos extremadamente negativos y tambi√©n picos positivos. Este comportamiento es caracter√≠stico de un shock global repentino, donde los mercados pasan por fases de p√°nico seguidas por fuertes rebotes.

En los a√±os m√°s recientes ‚Äî2021 a 2024‚Äî se observa una volatilidad intermedia: mayor que en el periodo 2013‚Äì2019, pero menor que en 2020 o en los a√±os de la burbuja tecnol√≥gica. Esta variabilidad puede asociarse a factores como las tasas de inter√©s elevadas, presiones inflacionarias, cambios en las pol√≠ticas monetarias y la mayor sensibilidad del sector tecnol√≥gico a estas condiciones. Aunque los retornos siguen centrados alrededor de cero, la presencia de outliers indica que el mercado contin√∫a expuesto a episodios de shocks ocasionales.

En conjunto, el gr√°fico confirma que los retornos diarios del QQQ mantienen una distribuci√≥n t√≠picamente estrecha con mediana cercana a cero, pero presentan explosiones peri√≥dicas de volatilidad asociadas a eventos macroecon√≥micos de gran escala. Este patr√≥n es caracter√≠stico de series financieras: comportamiento estable la mayor parte del tiempo, interrumpido por episodios de turbulencia. Para el an√°lisis de modelos ARIMA, esto es relevante porque estos picos de volatilidad pueden introducir heterocedasticidad y afectar la estabilidad del modelo, por lo que un an√°lisis complementario de volatilidad (p. ej., GARCH) ser√≠a apropiado si el proyecto lo requiere.

## 3.7 Rendimientos por a√±o

```{r rendimientosa√±o, echo=TRUE, eval=TRUE, warning=FALSE, message=FALSE}
ret_anual_df <- data.frame(
  A√±o = year(index(ret_anual)),
  Retorno = round(100 * as.numeric(ret_anual), 2)
) %>%
  mutate(
    Tipo = ifelse(Retorno >= 0, "Positivo", "Negativo"),
  
    Pos_Texto = ifelse(Retorno >= 0, -0.4, 1.2)
  )

ggplot(ret_anual_df, aes(x = factor(A√±o), y = Retorno, fill = Tipo)) +
  
  geom_col(show.legend = FALSE) + 
    scale_fill_manual(values = c(
    "Positivo" = tesla_pal$primary,   
    "Negativo" = tesla_pal$negative   
  )) +
    geom_text(
    aes(label = paste0(Retorno, "%"), vjust = Pos_Texto),
    color = tesla_pal$text_main,
    size = 3.2,          
    fontface = "bold"     
  ) +
  
  labs(
    title = "Retorno Anual Hist√≥rico del QQQ",
    subtitle = "Rendimiento logar√≠tmico anualizado (1999-2025)",
    x = "", 
    y = "Retorno (%)"
  ) +
  
  scale_y_continuous(expand = expansion(mult = 0.15)) +
    theme_tesla() +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, size = 10),
    panel.grid.major.x = element_blank() 
  )
```

El retorno anual del QQQ permite observar con claridad c√≥mo el desempe√±o del √≠ndice tecnol√≥gico ha estado marcado por ciclos de fuertes expansiones y contracciones, coherentes con los eventos identificados previamente en el an√°lisis de retornos diarios. Los primeros a√±os, entre 2000 y 2002, muestran ca√≠das muy pronunciadas, superiores al ‚Äì40%, que coinciden con el estallido de la burbuja punto-com, un fen√≥meno ampliamente documentado en la literatura financiera (Shiller, 2000). Este periodo se caracteriza por p√©rdidas consecutivas de magnitud excepcional, reflejando un mercado extremadamente vol√°til e incierto, como tambi√©n se evidenci√≥ en la dispersi√≥n extrema del boxplot anual, consistente con la alta varianza de los retornos de activos tecnol√≥gicos se√±alada por French, Schwert y Stambaugh (1987).

Tras esta etapa, el QQQ muestra episodios de recuperaci√≥n significativos, como en 2003 (40.29%) y especialmente en 2009 (43.07%), a√±o en el que el mercado rebota despu√©s de la crisis financiera global. No obstante, la ca√≠da abrupta de 2008 (‚Äì54.36%) resalta como uno de los peores a√±os de toda la serie, reafirmando la alta sensibilidad del sector tecnol√≥gico a choques sist√©micos, tal como ha sido analizado en estudios sobre riesgo sist√©mico y contagio financiero (Acharya et al., 2010). Estos resultados son coherentes con el patr√≥n observado en los retornos diarios: periodos largos de estabilidad interrumpidos por shocks severos.

Entre 2010 y 2019 se observa una etapa de crecimiento sostenido, donde la mayor√≠a de los a√±os presentan retornos positivos, algunos de ellos muy elevados, como 2013 (32.08%) y 2019 (38.91%). Esta d√©cada fue una de las m√°s s√≥lidas para el sector tecnol√≥gico, impulsada por avances en plataformas digitales, inteligencia artificial temprana, redes m√≥viles y expansi√≥n de las grandes empresas tecnol√≥gicas, lo cual se relaciona con la tendencia de crecimiento persistente de activos con alta innovaci√≥n documentada por Brynjolfsson y McAfee (2014). La estabilidad reflejada en los boxplots de estos a√±os coincide con un mercado maduro y menos propenso a oscilaciones extremas en comparaci√≥n con d√©cadas pasadas.

En 2020, marcado por la pandemia de COVID-19, el QQQ muestra un fuerte crecimiento del 43.04%, resultado del incremento en la demanda de servicios digitales, teletrabajo y compa√±√≠as tecnol√≥gicas en general, un comportamiento consistente con el ‚Äúefecto digitalizaci√≥n acelerada‚Äù descrito por Barrero, Bloom y Davis (2021). Sin embargo, al a√±o siguiente (2022) aparece una ca√≠da significativa del ‚Äì40.15%, asociada al aumento de tasas de inter√©s, inflaci√≥n elevada y el ajuste de valoraciones del sector tecnol√≥gico, en l√≠nea con los efectos que describe el modelo de valoraci√≥n de activos bajo cambios en pol√≠tica monetaria (Bernanke & Kuttner, 2005). Esta ca√≠da vuelve a reflejarse en la ampliaci√≥n de la volatilidad observada en el boxplot para ese periodo.

Finalmente, los a√±os m√°s recientes (2023‚Äì2025) exhiben retornos positivos moderados (entre 18% y 22%), lo que sugiere un periodo de recuperaci√≥n y estabilizaci√≥n despu√©s del fuerte ajuste de 2022. Estos valores est√°n alineados con un mercado que contin√∫a creciendo, aunque en un contexto m√°s cauteloso, influenciado por pol√≠ticas monetarias restrictivas y cambios estructurales en el sector tecnol√≥gico.

En conjunto, el gr√°fico muestra que el QQQ es un activo con alto potencial de crecimiento, pero tambi√©n con eventos peri√≥dicos de riesgo elevado, caracter√≠stica t√≠pica de los mercados tecnol√≥gicos. Este comportamiento es coherente con los patrones detectados en los boxplots y con la naturaleza no estacionaria de las series financieras, lo que justifica la importancia de t√©cnicas como ARIMA para modelar tendencias (Box & Jenkins, 1976), complementadas ‚Äîcuando sea necesario‚Äî con modelos de volatilidad como GARCH para capturar la heterocedasticidad inherente a este tipo de datos (Engle, 1982).

## 3.8 Drawdown 

```{r drawdown, echo=TRUE, eval=TRUE, warning=FALSE, message=FALSE}

ret_diario <- dailyReturn(precios, type = "log")

dd <- PerformanceAnalytics::Drawdowns(ret_diario)
dd_df <- data.frame(
  Fecha = index(dd),
  Drawdown = as.numeric(dd)
)
ggplot(dd_df, aes(x = Fecha, y = Drawdown)) +
  geom_line(color = tesla_pal$primary, linewidth = 0.7) +
  labs(title = "Drawdown Hist√≥rico del QQQ",
       x = "", y = "Drawdown") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  theme_tesla()
```

El gr√°fico revela de manera clara la profundidad y duraci√≥n de las p√©rdidas relativas del √≠ndice respecto a sus m√°ximos previos, lo que permite evaluar no solo la volatilidad, sino tambi√©n la resiliencia del mercado tecnol√≥gico a lo largo del tiempo. El periodo m√°s cr√≠tico se observa al inicio de la serie, entre 2000 y 2002, cuando el √≠ndice sufre un colapso superior al ‚Äì80% tras el estallido de la burbuja punto-com. Esta ca√≠da extraordinaria es consistente con el comportamiento descrito anteriormente en los retornos anuales, donde se evidenciaron p√©rdidas consecutivas cercanas al ‚Äì40%, un fen√≥meno ampliamente documentado en la literatura sobre burbujas especulativas (Shiller, 2000). Adem√°s, la prolongada permanencia del QQQ en drawdowns profundos durante casi una d√©cada subraya la fragilidad estructural del sector tecnol√≥gico en ese momento, caracterizado por valoraciones excesivas y escaso respaldo en flujos de caja reales.

Posteriormente, a partir de 2009, se aprecia un proceso de recuperaci√≥n sostenida que coincide con la salida de la crisis financiera global. Aunque 2008 marc√≥ un drawdown cercano al ‚Äì54%, el repunte inmediato del 2009, previamente resaltado en los retornos anuales, refleja el retorno gradual de la confianza en los mercados, fen√≥meno que la literatura asocia con pol√≠ticas monetarias expansivas y medidas de estabilizaci√≥n financiera (Bernanke & Gertler, 2001). No obstante, el drawdown de este per√≠odo tambi√©n destaca que, aunque el mercado se recupera, la profundidad de la ca√≠da anterior prolonga el tiempo de retorno a un m√°ximo hist√≥rico, reforzando la idea de que el drawdown no solo mide p√©rdidas, sino tambi√©n la duraci√≥n del proceso de recuperaci√≥n (time to recovery).

Entre 2010 y 2020, el gr√°fico muestra una notable estabilidad relativa del QQQ, con drawdowns m√°s moderados y recuperaciones m√°s r√°pidas. Este comportamiento coincide con la fase de crecimiento sostenido observada en los retornos anuales, impulsada por la expansi√≥n de las grandes empresas tecnol√≥gicas, avances en inteligencia artificial, comercio digital y servicios en la nube. Este patr√≥n es coherente con estudios que evidencian la creciente madurez y resistencia del sector tecnol√≥gico durante esta d√©cada (Brynjolfsson & McAfee, 2014). En este periodo, las ca√≠das existen, pero ninguna se aproxima a los extremos vividos en las d√©cadas previas, indicando una mayor solidez estructural del √≠ndice.

El gr√°fico tambi√©n evidencia un drawdown significativo durante la pandemia de COVID-19 en 2020, aunque de corta duraci√≥n. A diferencia de crisis anteriores, el QQQ experimenta una ca√≠da r√°pida, seguida de una recuperaci√≥n igual de acelerada, fen√≥meno asociado a la digitalizaci√≥n abrupta de la econom√≠a, que impuls√≥ fuertemente la demanda por empresas tecnol√≥gicas (Barrero, Bloom & Davis, 2021). Este comportamiento refuerza la idea de que el QQQ posee una estructura sectorial que se beneficia de shocks que incrementan la dependencia digital, lo que explica la r√°pida salida del drawdown.

Finalmente, el periodo 2022‚Äì2023 muestra un nuevo episodio de drawdown profundo, aunque no tan extremo como los hist√≥ricos, alcanzando niveles cercanos al ‚Äì35%. Esta ca√≠da coincide con el ajuste de valoraciones provocado por el aumento de tasas de inter√©s, la inflaci√≥n elevada y la contracci√≥n monetaria global. Estos shocks afectan especialmente a activos de crecimiento como los tecnol√≥gicos, cuyo valor presente es altamente sensible a cambios en las tasas de descuento, en l√≠nea con los argumentos del modelo CAPM y la literatura sobre sensibilidad de activos de crecimiento a tasas de inter√©s (Sharpe, 1964; Bernanke & Kuttner, 2005). Sin embargo, a diferencia de crisis anteriores, el drawdown se recupera parcialmente dentro del mismo periodo, demostrando mayor robustez del mercado tecnol√≥gico contempor√°neo.

En conjunto, el an√°lisis del drawdown confirma la narrativa construida en los gr√°ficos previos: el QQQ es un activo con un potencial de crecimiento extraordinario, pero con episodios recurrentes de ca√≠das severas que pueden prolongarse en el tiempo. Este comportamiento hace evidente la naturaleza no estacionaria y heteroced√°stica de la serie, lo cual justifica el uso de modelos ARIMA para capturar tendencias y de modelos GARCH para describir la volatilidad condicional (Engle, 1982; Bollerslev, 1986). El drawdown, por tanto, complementa los an√°lisis anteriores al mostrar no solo cu√°n fuerte cae el √≠ndice, sino cu√°nto tiempo tarda en recuperarse, un factor cr√≠tico en la gesti√≥n del riesgo financiero.

## 3.9 M√©tricas Financieras 

```{r metrics_financieras, echo=TRUE, warning=FALSE, message=FALSE}

cagr <- Return.annualized(ret_diario, scale = 252)
cumulative_return <- Return.cumulative(ret_diario)

sharpe_annual <- (mean(ret_diario, na.rm=TRUE) / sd(ret_diario, na.rm=TRUE)) * sqrt(252)
sortino <- SortinoRatio(ret_diario, MAR = 0)
max_dd <- maxDrawdown(ret_diario)

calmar <- as.numeric(cagr) / abs(as.numeric(max_dd))

metrics <- data.frame(
  M√©trica = c("CAGR (anual)", "Retorno acumulado", "Sharpe (aprx anual)", 
              "Sortino", "Max Drawdown", "Calmar"),
  Valor = c(
    scales::percent(as.numeric(cagr), accuracy = 0.01),
    scales::percent(as.numeric(cumulative_return), accuracy = 0.01),
    round(as.numeric(sharpe_annual), 3),
    round(as.numeric(sortino), 3),
    scales::percent(as.numeric(max_dd), accuracy = 0.1),
    round(as.numeric(calmar), 3)
  ),
  stringsAsFactors = FALSE
)

knitr::kable(metrics, format = "html", table.attr = "class='table' style='width:60%; margin:auto;'")
```

El presente conjunto de M√©tricas Financieras ofrece una visi√≥n sint√©tica y cuantitativa de la eficiencia, el riesgo y el rendimiento agregado de la estrategia, complementando de manera cr√≠tica los an√°lisis de retornos anuales y drawdown hist√≥rico. El Retorno Acumulado del 343.84% y la Tasa de Crecimiento Anual Compuesto (CAGR) de 5.77% validan el alto potencial de apreciaci√≥n del activo, una caracter√≠stica consistente con la fase de crecimiento sostenido observada en per√≠odos post-crisis. Estas cifras de rendimiento total confirman que, a pesar de los episodios de riesgo extremo, la estrategia o el sector subyacente posee una capacidad sustancial para generar riqueza a largo plazo.

Sin embargo, las m√©tricas ajustadas al riesgo revelan la baja eficiencia del rendimiento. El Ratio de Sharpe de 0.343 es penalizado por la alta volatilidad total, sugiriendo que el retorno est√° siendo consumido por la dispersi√≥n de los retornos, tanto al alza como a la baja. M√°s cr√≠tico a√∫n es el Ratio de Sortino, que con un valor de 0.03, indica que el riesgo de cola negativo (downside risk) ha sido desproporcionadamente alto en relaci√≥n con el rendimiento generado. Este hallazgo se alinea directamente con los eventos de p√©rdida catastr√≥fica identificados en los an√°lisis hist√≥ricos, donde las ca√≠das severas dominan el perfil de riesgo.

El indicador de riesgo extremo, el Max Drawdown, alcanza un valor extraordinariamente alto del 87.9%. Esta cifra es la manifestaci√≥n cuantitativa del colapso sufrido durante el estallido de la burbuja punto-com (2000-2002) y subraya la fragilidad estructural hist√≥rica y el riesgo de p√©rdida casi total de capital inherente al activo en sus per√≠odos m√°s cr√≠ticos. Desde la perspectiva de la gesti√≥n de riesgo, este valor define el peor escenario hist√≥rico tolerable. Finalmente, el Ratio Calmar de 0.066 relaciona el rendimiento anualizado con el Max Drawdown. Un valor tan bajo es una consecuencia directa del Max Drawdown extremo, confirmando la ineficiencia de la estrategia en t√©rminos de recuperaci√≥n del capital y reforzando la tesis de que el time to recovery tras los grandes choques puede ser prolongado y exige una tolerancia al riesgo excepcional.

En conclusi√≥n, el an√°lisis de las m√©tricas confirma la narrativa general: el activo ofrece un potencial de crecimiento robusto, evidenciado por el retorno acumulado, pero lo hace asumiendo un costo de riesgo hist√≥ricamente severo. Las bajas cifras de Sharpe y Sortino, junto con el Max Drawdown casi total, evidencian un perfil de riesgo dominado por eventos de cola, lo que implica que el modelado y la gesti√≥n de este activo deben necesariamente considerar la asimetr√≠a y la curtosis inherentes a la distribuci√≥n de sus retornos para cuantificar adecuadamente la severidad de las p√©rdidas potenciales.


```{r rolling_vol, echo=TRUE, warning=FALSE, message=FALSE}

rollsd30  <- rollapply(as.numeric(ret_diario), width = 30, FUN = sd, fill = NA, align = "right")
rollsd90  <- rollapply(as.numeric(ret_diario), width = 90, FUN = sd, fill = NA, align = "right")
rollsd252 <- rollapply(as.numeric(ret_diario), width = 252, FUN = sd, fill = NA, align = "right")

df_roll <- data.frame(
  Fecha = index(ret_diario),
  vol30 = rollsd30 * sqrt(252),
  vol90 = rollsd90 * sqrt(252),
  vol252 = rollsd252 * sqrt(252)
)

dfm <- melt(df_roll, id.vars = "Fecha", variable.name = "Window", value.name = "VolAnual")

ggplot(dfm, aes(x = Fecha, y = VolAnual, color = Window)) +
  geom_line(size = 0.8) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 0.1)) +
  labs(title = "Volatilidad Rolling (annualizada)", y = "Vol Annualizada", x = "") +
  scale_color_manual(values = c("vol30" = tesla_pal$primary, "vol90" = tesla_pal$secondary, "vol252" = tesla_pal$text_gray)) +
  theme_tesla()
```

El gr√°fico de volatilidad desagrega temporalmente la cifra est√°tica de riesgo (26.97%) analizada previamente, proporcionando la evidencia visual definitiva de la heterocedasticidad condicional inherente a la serie del QQQ. Al observar la evoluci√≥n de la desviaci√≥n est√°ndar anualizada en distintas ventanas temporales, se confirma que el riesgo del activo no es constante, sino que exhibe un marcado comportamiento de agrupamiento de volatilidad (volatility clustering): grandes cambios en los precios tienden a ser seguidos por grandes cambios, y periodos de calma por calma, validando emp√≠ricamente los postulados de los modelos ARCH/GARCH sugeridos para la modelaci√≥n de esta serie (Engle, 1982). La estructura del gr√°fico est√° dominada por tres ‚Äúreg√≠menes de alta volatilidad‚Äù que se corresponden sim√©tricamente con los episodios de drawdown m√°ximo identificados en el an√°lisis hist√≥rico.

El primer r√©gimen, correspondiente a la persistencia de la Burbuja (2000-2003), muestra el pico m√°s ancho de la serie, donde la volatilidad anualizada supera el 75%. La l√≠nea de largo plazo (vol252) se mantiene en niveles extremos durante un periodo prolongado, lo que explica por qu√© los ratios de eficiencia (Sharpe y Calmar) son tan bajos: el riesgo no fue un evento transitorio, sino una condici√≥n estructural que erosion√≥ los retornos ajustados durante a√±os. Posteriormente, se observa el shock sist√©mico de 2008, con un segundo pico vertical que tambi√©n rompe la barrera del 75%, indicando un contagio inmediato que afect√≥ tanto la negociaci√≥n t√°ctica como la estrat√©gica (Acharya et al., 2010). En contraste, el pico de 2020 (Pandemia) es extremadamente agudo pero de base estrecha, reflejando la naturaleza ex√≥gena del shock y una estabilizaci√≥n acelerada impulsada por la digitalizaci√≥n de la econom√≠a (Barrero, Bloom & Davis, 2021).

La discrepancia entre las ventanas de estimaci√≥n de corto plazo (vol30, l√≠nea cian) y largo plazo (vol252, l√≠nea gris) ofrece una lectura sobre la ‚Äútensi√≥n‚Äù del mercado frente a su tendencia de fondo. En periodos recientes como 2022, la volatilidad de corto plazo oscila con mucha mayor amplitud que la de largo plazo, se√±alando un mercado en b√∫squeda de equilibrio ante la incertidumbre sobre el costo del capital. Esta sensibilidad valida la hip√≥tesis de la duraci√≥n de acciones: la alta concentraci√≥n en activos de crecimiento (Growth) hace que la volatilidad del QQQ reaccione de manera hipersensible a cambios en la pol√≠tica monetaria (Sharpe, 1964).

En conclusi√≥n, este gr√°fico act√∫a como el eslab√≥n que conecta la Asimetr√≠a estad√≠stica con el Max Drawdown hist√≥rico del 87.9%. Demuestra que la ‚Äúvolatilidad media‚Äù es una m√©trica enga√±osa para el QQQ, ya que el inversor rara vez experimenta el promedio; en su lugar, el activo transita entre largos periodos de volatilidad moderada y explosiones de riesgo extremo. Esta din√°mica bimodal justifica plenamente la conclusi√≥n de las m√©tricas financieras: la gesti√≥n de este activo requiere una tolerancia al riesgo excepcional, dise√±ada no para el promedio, sino para sobrevivir a los picos de varianza que definen su trayectoria a largo plazo (Mandelbrot, 1963; Bollerslev, 1986).

## 4 Estacionalidad Mensual del QQQ (1999‚Äì2025)

```{r heatmap_estacional_mejor, echo=TRUE, warning=FALSE, message=FALSE}
df_m <- data.frame(Fecha = index(ret_mensual), Ret = as.numeric(ret_mensual))
df_m <- df_m %>% mutate(A√±o = lubridate::year(Fecha), Mes = lubridate::month(Fecha, label = TRUE, abbr = TRUE), RetP = Ret*100)
tabla_m <- df_m %>% group_by(A√±o, Mes) %>% summarise(RetP = mean(RetP, na.rm = TRUE))
ggplot(tabla_m, aes(x = Mes, y = factor(A√±o), fill = RetP)) +
  geom_tile(color = "white") +
  scale_fill_viridis_c(option = "C", direction = 1, name = "Ret (%)") +
  labs(title = "Heatmap Estacional Mensual (QQQ)") +
  theme_tesla()
```

El mapa de calor estacional ofrece una deconstrucci√≥n granular de la din√°mica temporal del QQQ, permitiendo identificar patrones de estacionalidad, inercia (momentum) y cambios de r√©gimen que quedan ocultos en las m√©tricas anualizadas. La visualizaci√≥n confirma que la trayectoria del activo no es aleatoria, sino que exhibe una marcada dependencia serial: los retornos positivos (tonos naranjas y amarillos) y negativos (tonos morados y azules) tienden a agruparse en bloques temporales definidos, validando visualmente la presencia de reg√≠menes de mercado persistentes (Jegadeesh & Titman, 1993).

El an√°lisis cronol√≥gico del gr√°fico corrobora la severidad de los eventos de cola discutidos previamente. El periodo 2000-2002 aparece dominado por una densa concentraci√≥n de celdas en tonos morados oscuros y azules profundos, representando ca√≠das mensuales que frecuentemente excedieron el -10% o -20%. Esta "mancha t√©rmica" visualiza la destrucci√≥n de valor sistem√°tica durante el estallido de la burbuja Dot-Com, donde la ausencia de meses de recuperaci√≥n sostenida ilustra la capitulaci√≥n total del sentimiento inversor. Similarmente, el a√±o 2008 exhibe un deterioro progresivo que culmina en un cuarto trimestre te√±ido de violeta intenso, coincidiendo con el cl√≠max de la Crisis Financiera y el pico de volatilidad detectado en el gr√°fico de rolling volatility.

En contraste, la d√©cada de 2010-2019 se manifiesta como un bloque predominantemente c√°lido (naranja), caracterizado por una notable consistencia en los retornos positivos mensuales. Esta fase visualiza la "d√©cada dorada" tecnol√≥gica impulsada por la pol√≠tica monetaria acomodaticia y la expansi√≥n de las plataformas digitales. Sin embargo, el heatmap revela anomal√≠as estacionales importantes, destacando el "Efecto Septiembre": al observar la columna del noveno mes, se aprecia una recurrencia de tonos oscuros (a√±os 2000, 2001, 2008, 2020, 2021, 2022). Este patr√≥n sugiere una debilidad estacional estructural en el sector tecnol√≥gico al cierre del tercer trimestre, consistente con la literatura sobre anomal√≠as de calendario y rebalanceo de portafolios institucionales (Thaler, 1987).

Finalmente, la din√°mica reciente (2020-2025) muestra una alternancia violenta de reg√≠menes. El a√±o 2020 inicia con el shock del COVID (morado en marzo) seguido de una recuperaci√≥n verde/amarilla agresiva; mientras que 2022 se presenta como un "tablero de ajedrez" dominado por la correcci√≥n de tasas, con meses de p√©rdidas severas (abril, junio, septiembre). La recuperaci√≥n de 2023 y 2024, visible en las franjas superiores naranjas, confirma la resiliencia del √≠ndice y su capacidad para retomar el momentum alcista tras periodos de ajuste, impulsado nuevamente por la concentraci√≥n en mega-caps de inteligencia artificial. En conjunto, el heatmap demuestra que el riesgo del QQQ no se distribuye uniformemente a lo largo del a√±o, sino que se concentra en ventanas espec√≠ficas de estr√©s y estacionalidad negativa.



```{r comparacion, echo=TRUE, eval=TRUE, warning=FALSE, message=FALSE}

tesla_pal <- list(
  primary = "#cc0000",
  secondary = "#000000",
  text_main = "#333333",
  text_gray = "#666666"
)
theme_tesla <- function() {
  theme_minimal(base_family = "Inter") +
    theme(
      plot.title = element_text(face = "bold", size = 16, color = tesla_pal$text_main),
      plot.subtitle = element_text(size = 11, color = tesla_pal$text_gray, margin = margin(b = 15)),
      legend.position = "none",
      panel.grid.minor = element_blank(),
      panel.grid.major.x = element_blank(),
      panel.grid.major.y = element_line(color = "#e5e5e5", linetype = "dashed"),
      axis.text = element_text(color = tesla_pal$text_gray),
      axis.title = element_text(color = tesla_pal$text_gray, size = 10)
    )
}

tickers <- c("QQQ", "SPY", "DIA", "IWM")
nombres_map <- c(
  "QQQ" = "QQQ (Nasdaq-100)",
  "SPY" = "SPY (S&P 500)",
  "DIA" = "DIA (Dow Jones)",
  "IWM" = "IWM (Small Caps)"
)

datos_comp <- tq_get(tickers, get = "stock.prices", from = "1999-05-01")
datos_norm <- datos_comp %>%
  group_by(symbol) %>%
  mutate(
    Retorno_Acum = (adjusted / first(adjusted)) - 1,
    Nombre = nombres_map[symbol]
  ) %>%
  ungroup()

colores_comp <- c(
  "QQQ" = tesla_pal$primary,   
  "SPY" = "#2c3e50",           
  "DIA" = "#7f8c8d",        
  "IWM" = "#f39c12"            
)

p_comp <- ggplot(datos_norm, aes(x = date, y = Retorno_Acum, color = symbol)) +
  geom_line(aes(size = symbol, alpha = symbol)) +
  
  scale_color_manual(values = colores_comp, labels = nombres_map) +
  scale_size_manual(values = c("QQQ" = 1.2, "SPY" = 0.6, "DIA" = 0.6, "IWM" = 0.6), guide="none") +
  scale_alpha_manual(values = c("QQQ" = 1, "SPY" = 0.7, "DIA" = 0.7, "IWM" = 0.6), guide="none") +
  
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  
  labs(
    title = "QQQ vs El Mercado",
    subtitle = "Rendimiento acumulado comparativo (2010 - Presente)",
    x = "",
    y = "Retorno Acumulado"
  ) +
  theme_tesla()

plotly::ggplotly(p_comp, tooltip = c("x", "y", "colour")) %>%
  layout(
    legend = list(
      orientation = "h", 
      x = 0.5, 
      xanchor = "center",
      y = 1.05,
      title = list(text = "")
    ),
    hovermode = "x unified"
  ) %>%
  config(displayModeBar = FALSE)
```


La comparaci√≥n normalizada del retorno acumulado entre el QQQ (Nasdaq-100) y los principales √≠ndices de referencia ‚ÄîSPY (S&P 500), DIA (Dow Jones Industrial Average) y IWM (Russell 2000 / Small Caps)‚Äî evidencia un desacople estructural en la generaci√≥n de valor burs√°til durante los √∫ltimos 25 a√±os. Visualmente, la trayectoria del QQQ (l√≠nea roja prominente) se separa radicalmente del cl√∫ster de mercado general (l√≠neas grises y amarillas) a partir de la d√©cada de 2010, confirmando que la exposici√≥n al factor tecnol√≥gico no ha funcionado meramente como un componente c√≠clico, sino como el motor primario de la apreciaci√≥n de capital en la econom√≠a moderna.

Sin embargo, el gr√°fico tambi√©n documenta el costo de esta "prima de crecimiento". Durante el periodo 2000-2002, el QQQ no solo tuvo un desempe√±o inferior al DIA y al SPY, sino que experiment√≥ una destrucci√≥n de riqueza significativamente mayor, cotizando por debajo de su valor base inicial durante un periodo m√°s prolongado que sus pares. Este comportamiento ilustra la asimetr√≠a del riesgo tecnol√≥gico: mientras que √≠ndices como el DIA (compuesto por empresas industriales maduras y de valor) mostraron una mayor resistencia defensiva durante el estallido de la burbuja, el QQQ exhibi√≥ una beta (sensibilidad) mucho m√°s alta a la baja, validando la teor√≠a de que los activos de crecimiento (Growth) poseen una mayor duraci√≥n y volatilidad impl√≠cita (Fama & French, 1993).

La verdadera "bifurcaci√≥n" o ruptura de tendencia se consolida post-2015 y se acelera verticalmente tras el shock pand√©mico de 2020. Mientras el IWM (Small Caps, l√≠nea amarilla) lucha por mantener el ritmo ‚Äîpenalizado recientemente por el entorno de altas tasas de inter√©s que afecta desproporcionadamente a empresas de menor capitalizaci√≥n y mayor apalancamiento‚Äî, el QQQ aprovecha la robustez de los balances de sus mega-caps para dispararse. La brecha masiva al final de la serie, donde el retorno acumulado del QQQ supera el 1,000% frente a niveles cercanos al 500-600% para el resto del mercado, demuestra la eficiencia superior de la concentraci√≥n tecnol√≥gica en periodos de expansi√≥n monetaria y revoluci√≥n digital.

En conclusi√≥n, el gr√°fico ratifica que el QQQ no es un sustituto del mercado general, sino un veh√≠culo de alpha agresivo. Su desempe√±o superior a largo plazo frente al SPY (que incluye tecnolog√≠a pero diluida) y al DIA (sesgado a econom√≠a tradicional) justifica su inclusi√≥n en portafolios que buscan maximizaci√≥n de capital, siempre que el inversor acepte que la desviaci√≥n est√°ndar de sus retornos (y por ende, el riesgo de drawdown) ser√° sistem√°ticamente superior a la de un √≠ndice diversificado o de peque√±a capitalizaci√≥n (Sharpe, 1964; Markowitz, 1952).

```{r partiion, echo=TRUE, warning=FALSE, message=FALSE}


datos_plot <- data.frame(
  Fecha = index(precios),
  Precio = as.numeric(precios)
)

fecha_corte <- as.Date("2022-10-07")  
fecha_chatgpt <- as.Date("2022-11-30") 

ggplot(datos_plot, aes(x = Fecha, y = Precio)) +
  geom_line(color = tesla_pal$text_gray, alpha = 0.5, size = 0.5) +
    geom_line(data = subset(datos_plot, Fecha >= fecha_corte), 
            aes(x = Fecha, y = Precio), 
            color = tesla_pal$primary, size = 1.2) +
  
  geom_vline(xintercept = as.numeric(fecha_chatgpt), 
             color = "#8e44ad", linetype = "dashed", size = 0.9) +

  annotate("text", x = fecha_chatgpt, y = 320, 
           label = "Lanzamiento\nChatGPT", 
           angle = 90, vjust = -0.8, color = "#8e44ad", fontface="bold") +
  
  labs(
    title = "Impacto del Lanzamiento de ChatGPT",
    subtitle = "El inicio de la tendencia alcista coincide con la aparici√≥n de la IA Generativa",
    x = "", y = "Precio QQQ"
  ) +
  theme_tesla()
```

El gr√°fico visualiza el punto de inflexi√≥n m√°s cr√≠tico en la historia reciente del QQQ, identificando el final de 2022 no solo como un m√≠nimo c√≠clico, sino como el inicio de un cambio de r√©gimen estructural en el mercado tecnol√≥gico. La l√≠nea vertical violeta marca la introducci√≥n p√∫blica de ChatGPT, un evento que coincide con precisi√≥n quir√∫rgica con el final de la tendencia bajista de 2022 y el comienzo de una recuperaci√≥n en forma de "V" que ha llevado al √≠ndice a nuevos m√°ximos hist√≥ricos.

Este comportamiento confirma la hip√≥tesis de una ruptura estructural (structural break) en la serie de tiempo. Durante la mayor parte de 2022, el QQQ estuvo correlacionado negativamente con las tasas de inter√©s y la inflaci√≥n (como se discuti√≥ en el an√°lisis de volatilidad). Sin embargo, la aparici√≥n de la Inteligencia Artificial Generativa actu√≥ como un shock tecnol√≥gico ex√≥geno que desacopl√≥ al √≠ndice de las presiones macroecon√≥micas tradicionales. La pendiente agresiva de la recuperaci√≥n posterior a la l√≠nea punteada refleja un re-rating masivo de las valoraciones, impulsado por la expectativa de que la IA provocar√° un aumento en la productividad laboral y corporativa comparable a la revoluci√≥n de internet (Eloundou et al., 2023).

Esta narrativa fundamenta emp√≠ricamente la selecci√≥n de 2022 como el punto pivote para la ventana de entrenamiento del modelo. Incluir datos anteriores sin ponderar este cambio de r√©gimen podr√≠a introducir ruido, dado que la din√°mica de precios pre-2022 respond√≠a a factores de liquidez convencional, mientras que la din√°mica post-2022 est√° dominada por factores de adopci√≥n tecnol√≥gica y concentraci√≥n en hardware y software de IA (validando la hegemon√≠a de NVIDIA y Microsoft observada en los diagramas de holdings).

En consecuencia, el gr√°fico demuestra que el mercado ha transicionado de un esquema de "valoraci√≥n por descuento de flujos" (sensible a tasas) a un esquema de "valoraci√≥n por crecimiento exponencial" (sensible a la innovaci√≥n en IA). Por tanto, cualquier estrategia de modelado predictivo (ARIMA/GARCH) debe tratar este periodo no como una simple continuaci√≥n de la tendencia hist√≥rica, sino como una nueva fase estoc√°stica caracterizada por un momentum idiosincr√°tico derivado de la revoluci√≥n de los Grandes Modelos de Lenguaje (LLMs) (Acemoglu & Johnson, 2023).

```{r ias, echo=TRUE, eval=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=6}
library(ggplot2)
library(dplyr)
library(lubridate)
library(ggrepel) 
data_cronologia <- data.frame(
  Hito = c(
    "ChatGPT (OpenAI)", 
    "DALL¬∑E 2", "Midjourney v3", "Stable Diffusion", 
    "Nuevo Bing", "Claude (Anthropic)", "GPT-4", "Copilot 365", 
    "Google I/O (AI)", "Llama 2", "Mistral 7B", "DALL¬∑E 3", 
    "Gemini 1.0/Ultra", "Sora (Video)", "Gemini Android", 
    "Claude 3", "Llama 3", "GPT-4o", "PCs Copilot+"
  ),
  Fecha = as.Date(c(
    "2022-11-30", 
    "2022-04-06", "2022-07-25", "2022-08-22", 
    "2023-02-07", "2023-03-14", "2023-03-14", "2023-03-16", 
    "2023-05-10", "2023-07-18", "2023-09-27", "2023-10-19", 
    "2023-12-06", "2024-02-15", "2024-02-08", 
    "2024-03-04", "2024-04-18", "2024-05-13", "2024-05-20"  
  )),
  Categoria = factor(c(
    "EL PUNTO DE INFLEXI√ìN",
    rep("üé® IMAGEN Y VIDEO", 3),
    "üîÑ INTEGRACI√ìN", "üìù TEXTO Y LLMs", "üìù TEXTO Y LLMs", "üîÑ INTEGRACI√ìN",
    "üîÑ INTEGRACI√ìN", "üìù TEXTO Y LLMs", "üìù TEXTO Y LLMs", "üé® IMAGEN Y VIDEO",
    "üìù TEXTO Y LLMs", "üé® IMAGEN Y VIDEO", "üîÑ INTEGRACI√ìN",
    "üìù TEXTO Y LLMs", "üìù TEXTO Y LLMs", "üìù TEXTO Y LLMs", "üîÑ INTEGRACI√ìN"
  ), levels = c("EL PUNTO DE INFLEXI√ìN", "üìù TEXTO Y LLMs", "üé® IMAGEN Y VIDEO", "üîÑ INTEGRACI√ìN")),
  
  Importancia = c(
    "Critico", 
    "Normal", "Normal", "Normal", 
    "Critico", "Normal", "Critico", "Normal",
    "Normal", "Normal", "Normal", "Normal",
    "Critico", "Critico", "Normal",
    "Normal", "Normal", "Critico", "Normal"
  )
)

colores_cat <- c(
  "EL PUNTO DE INFLEXI√ìN" = "#e17055", 
  "üìù TEXTO Y LLMs"       = "#00b894", 
  "üé® IMAGEN Y VIDEO"     = "#06b6d4", 
  "üîÑ INTEGRACI√ìN"        = "#a29bfe"  
)

ggplot(data_cronologia, aes(x = Fecha, y = Categoria, color = Categoria)) +
  geom_line(aes(group = Categoria), size = 1, alpha = 0.3) +
  geom_point(aes(size = Importancia), alpha = 0.9) +
  geom_text_repel(
    aes(label = Hito), 
    size = 3.5, 
    fontface = "bold", 
    box.padding = 0.5,
    point.padding = 0.3,
    force = 2,
    direction = "y",      
    nudge_y = 0.2,        
    segment.color = "grey80"
  ) +
  scale_size_manual(values = c("Critico" = 5, "Normal" = 3), guide = "none") +
  scale_color_manual(values = colores_cat) +
  scale_x_date(date_breaks = "4 months", date_labels = "%b %Y") +
  geom_vline(xintercept = as.Date("2022-10-07"), linetype="dashed", color="#636e72") +
  annotate("text", x = as.Date("2022-10-07"), y = 4.3, label = "Inicio", 
           angle = 90, vjust = -0.5, size = 3, color="#636e72") +
  labs(
    title = "Cronolog√≠a del Boom de la IA Generativa",
    subtitle = "Lanzamientos clave que definieron la tendencia (2022-2024)",
    x = "", y = ""
  ) +
  theme_tesla() +
  theme(
    legend.position = "none",
    axis.text.y = element_text(face = "bold", size = 10),
    panel.grid.major.y = element_line(linetype = "dotted") 
  )
```

El gr√°fico "Cronolog√≠a del Boom de la IA Generativa" ilustra gr√°ficamente c√≥mo ChatGPT lo cambi√≥ todo: su lanzamiento en octubre de 2022 no fue un evento aislado, sino el detonante de una reacci√≥n en cadena que transform√≥ radicalmente el mercado tecnol√≥gico en un lapso extremadamente corto. Como se observa en la l√≠nea de tiempo, desde este punto de inflexi√≥n nacieron y se desplegaron a una velocidad sin precedentes m√∫ltiples nuevas inteligencias artificiales que redefinieron sectores enteros. La r√°pida sucesi√≥n de hitos ‚Äîque abarca desde la evoluci√≥n de LLMs (GPT-4, Claude 3, Llama 3) y la generaci√≥n de video (Sora), hasta la integraci√≥n profunda en sistemas operativos y productividad (Copilot 365, Gemini Android)‚Äî demuestra una densidad de innovaci√≥n que valida la tesis de un cambio de r√©gimen acelerado.

Esta proliferaci√≥n tecnol√≥gica ha sostenido el momentum del precio, validando la concentraci√≥n del portafolio en los proveedores de infraestructura de IA (como Microsoft y Google) observada en las secciones anteriores. A la luz de este hallazgo y del an√°lisis descriptivo exhaustivo realizado, se derivan conclusiones estad√≠sticas fundamentales que condicionan la estrategia de modelado econom√©trico. Primero, la serie hist√≥rica del QQQ exhibe una no estacionariedad marcada y una tendencia exponencial que exige el uso de rendimientos logar√≠tmicos y diferenciaci√≥n. Segundo, la presencia de una curtosis extrema y agrupamientos de volatilidad (volatility clustering) visibles en los gr√°ficos de riesgo confirman que los modelos lineales simples subestimar√°n la probabilidad de eventos de cola, justificando la necesidad de complementar la estimaci√≥n de la media con modelos de volatilidad condicional (GARCH).

Finalmente, bas√°ndose en la evidencia visual y fundamental de la ruptura estructural provocada por la IA Generativa, se define el a√±o 2022 como el punto de inicio para la ventana de entrenamiento del modelo predictivo. Incluir datos anteriores a esta fecha introducir√≠a "ruido" en los par√°metros del modelo, dado que la din√°mica de precios de la d√©cada 2010-2020 respond√≠a a un r√©gimen de tasas cero y expansi√≥n m√≥vil, estructuralmente distinto al actual entorno de tasas medias e inversi√≥n intensiva en IA. La literatura econom√©trica sobre cambios estructurales (Perron, 1989) sugiere que, tras un shock permanente de esta magnitud, los datos previos pierden capacidad predictiva. Por consiguiente, al restringir la muestra al periodo post-ChatGPT, el modelo capturar√° con mayor fidelidad la inercia (momentum) y la volatilidad espec√≠fica del actual "superciclo de IA", optimizando la precisi√≥n de los pron√≥sticos a corto plazo.

---

# 4. Resultados del Modelo ARIMA

## 4.1 Partici√≥n de Datos

### 4.1.1 Estrategia Train/Test

La aplicaci√≥n de la estrategia de partici√≥n temporal al conjunto de datos del QQQ divide el per√≠odo de an√°lisis (octubre 2022 - presente) en dos subconjuntos contiguos que respetan el orden cronol√≥gico. El punto de divisi√≥n se establece en el 30 de septiembre de 2025, coincidiendo con el cierre del tercer trimestre del a√±o 2025. Esta fecha marca un quiebre administrativo natural en calendarios financieros y evita arbitrariedades en la selecci√≥n del per√≠odo de corte.

El conjunto de entrenamiento comprende observaciones desde el 7 de octubre de 2022 hasta el 30 de septiembre de 2025, proporcionando una base robusta para estimaci√≥n de coeficientes $ARIMA$, mientras que el conjunto de prueba abarca desde el 1 de octubre de 2025 hasta el presente, permitiendo validaci√≥n con un horizonte de pron√≥stico consistente con est√°ndares de an√°lisis de corto plazo en mercados financieros (Hyndman & Athanasopoulos, 2021).

```{r particion-datos, echo=TRUE}
Entrenamiento <- window(Precio, start = "2022-10-07", end="2025-09-30")
Prueba <- window(Precio, start = "2025-10-01")
```

### 4.1.2 Tabla Resumen: Observaciones por Conjunto

```{r particion-tabla, echo=TRUE}
particion_resumen <- data.frame(
  Conjunto = c("Entrenamiento", "Prueba", "Total"),
  Per√≠odo = c(
    "07-Oct-2022 ‚Üí 30-Sep-2025",
    "01-Oct-2025 ‚Üí Presente",
    "07-Oct-2022 ‚Üí Presente"
  ),
  `Observaciones` = c(
    length(Entrenamiento),
    length(Prueba),
    length(Entrenamiento) + length(Prueba)
  ),
  Porcentaje = c(
    paste0(round(length(Entrenamiento)/(length(Entrenamiento)+length(Prueba))*100, 1), "%"),
    paste0(round(length(Prueba)/(length(Entrenamiento)+length(Prueba))*100, 1), "%"),
    "100%"
  ),
  Prop√≥sito = c(
    "Estimaci√≥n y validaci√≥n de modelo",
    "Evaluaci√≥n de capacidad predictiva",
    ""
  )
)

kable(particion_resumen,
      caption = "Resumen de Partici√≥n de Datos: Entrenamiento vs Prueba",
      align = c("l", "c", "c", "c", "l")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(3, bold = TRUE, color = qqq_pal$positive) %>%
  row_spec(3, bold = TRUE, background = "#e8f5e9", color = qqq_pal$text_dark)
```

El conjunto de entrenamiento contiene 747 observaciones diarias (aproximadamente 3 a√±os de negociaci√≥n), representando el 95% del total de datos disponibles. Este volumen es m√°s que suficiente para identificar par√°metros confiables de un modelo $ARIMA$ de complejidad moderada. El conjunto de prueba contiene 45 observaciones (aproximadamente 9 semanas de actividad burs√°til), permitiendo validaci√≥n con horizonte de pron√≥stico de al menos 10 d√≠as h√°biles conforme lo requiere el an√°lisis.

### 4.1.3 Visualizaci√≥n: Serie con Partici√≥n 

```{r grafico-particion, echo=TRUE, fig.height=6.5}
df_train <- data.frame(
  Fecha = index(Entrenamiento),
  Precio = as.numeric(Entrenamiento),
  Conjunto = "Entrenamiento"
)

df_test <- data.frame(
  Fecha = index(Prueba),
  Precio = as.numeric(Prueba),
  Conjunto = "Prueba"
)

df_completo <- bind_rows(df_train, df_test)
fecha_corte <- as.Date("2025-10-01")

ggplot(df_completo, aes(x = Fecha, y = Precio)) +
  geom_ribbon(data = df_train, 
              aes(ymin = min(df_completo$Precio) * 0.95, ymax = Precio),
              fill = qqq_pal$primary, alpha = 0.08) +
  geom_ribbon(data = df_test, 
              aes(ymin = min(df_completo$Precio) * 0.95, ymax = Precio),
              fill = qqq_pal$secondary, alpha = 0.15) +
  geom_line(data = df_train, color = qqq_pal$primary, linewidth = 0.9) +
  geom_line(data = df_test, color = qqq_pal$secondary, linewidth = 1.1) +
  geom_vline(xintercept = fecha_corte, 
             linetype = "dashed", color = qqq_pal$negative, linewidth = 0.8) +
  annotate("text", x = fecha_corte, y = max(df_completo$Precio) * 1.02,
           label = "Corte: 01-Oct-2025", hjust = -0.05, vjust = 0,
           color = qqq_pal$negative, fontface = "bold", size = 3.5) +
  annotate("label", 
           x = as.Date("2024-01-01"), 
           y = max(df_completo$Precio) * 0.85,
           label = paste0("ENTRENAMIENTO\n", nrow(df_train), " observaciones"),
           fill = qqq_pal$primary, color = "white", 
           fontface = "bold", size = 3.5, label.padding = unit(0.5, "lines")) +
  annotate("label", 
           x = max(df_test$Fecha) - 10,
           y = min(df_completo$Precio) * 1.15,
           label = paste0("PRUEBA\n", nrow(df_test), " obs."),
           fill = qqq_pal$secondary, color = "white", 
           fontface = "bold", size = 3.2, label.padding = unit(0.4, "lines")) +
  scale_x_date(date_breaks = "4 months", date_labels = "%b %Y",
               expand = expansion(mult = c(0.02, 0.05))) +
  scale_y_continuous(labels = dollar_format(prefix = "$"),
                     expand = expansion(mult = c(0.05, 0.08))) +
  labs(
    title = "Partici√≥n de Datos: Entrenamiento vs Prueba",
    subtitle = "QQQ (Nasdaq-100 ETF) | Serie de precios de cierre diarios",
    x = NULL,
    y = "Precio de Cierre (USD)",
    caption = paste0("Fuente: Yahoo Finance | Per√≠odo: ", 
                     min(df_completo$Fecha), " a ", max(df_completo$Fecha))
  ) +
  theme_QQQ() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

---

## 4.2 An√°lisis de Estacionariedad

La serie de precios del QQQ exhibe visualmente una tendencia alcista pronunciada con fluctuaciones amplias alrededor de una trayectoria creciente durante el per√≠odo de entrenamiento (octubre 2022 - septiembre 2025). El gr√°fico de autocorrelaci√≥n de la serie en niveles revela el s√≠ntoma cl√°sico de no-estacionariedad:

```{r acf-original, echo=TRUE, fig.height=5.5}
acf_data <- acf(Entrenamiento, lag.max = 30, plot = FALSE)

df_acf <- data.frame(
  Lag = acf_data$lag[-1], 
  ACF = acf_data$acf[-1]
)

n <- length(Entrenamiento)
limite_sup <- qnorm(0.975) / sqrt(n)
limite_inf <- -limite_sup

ggplot(df_acf, aes(x = Lag, y = ACF)) +
  geom_segment(aes(xend = Lag, yend = 0), 
               color = qqq_pal$primary, linewidth = 0.8) +
  geom_point(color = qqq_pal$primary, size = 2) +
  geom_hline(yintercept = limite_sup, linetype = "dashed", 
             color = qqq_pal$secondary, linewidth = 0.7) +
  geom_hline(yintercept = limite_inf, linetype = "dashed", 
             color = qqq_pal$secondary, linewidth = 0.7) +
  geom_hline(yintercept = 0, color = qqq_pal$text_gray, linewidth = 0.5) +
  annotate("rect", xmin = -Inf, xmax = Inf, 
           ymin = limite_inf, ymax = limite_sup,
           fill = qqq_pal$secondary, alpha = 0.1) +
  annotate("label", x = 20, y = 0.5,
           label = "Decaimiento lento\n‚Üí Serie NO estacionaria",
           fill = qqq_pal$negative, color = "white",
           fontface = "bold", size = 3.5, label.padding = unit(0.5, "lines")) +
  scale_x_continuous(breaks = seq(0, 30, 5)) +
  scale_y_continuous(limits = c(-0.1, 1.05), breaks = seq(0, 1, 0.25)) +
  labs(
    title = "Funci√≥n de Autocorrelaci√≥n (ACF) - Serie en Niveles",
    subtitle = "QQQ: Precio de cierre | Datos de entrenamiento",
    x = "Rezago (Lag)",
    y = "Autocorrelaci√≥n",
    caption = "Bandas azules: L√≠mites de significancia al 95%"
  ) +
  theme_QQQ()
```

La autocorrelaci√≥n muestral permanece elevada (>0.85) incluso en rezagos distantes (lag 30). Este decaimiento lento es indicador cl√°sico de que la serie contiene ra√≠z unitaria y requiere diferenciaci√≥n. Adicionalmente, casi todos los rezagos caen fuera de las bandas de confianza, confirmando correlaci√≥n sistem√°tica estructural.

### 4.2.2 Contraste Estad√≠stico: Test de Dickey-Fuller Aumentado (ADF)

```{r adf-original, echo=TRUE}
adf_resultado <- adf.test(Entrenamiento)

tabla_adf <- data.frame(
  M√©trica = c("Estad√≠stico Dickey-Fuller", 
              "Orden de Rezagos (Lag)", 
              "P-valor",
              "Nivel de Significancia (Œ±)",
              "Conclusi√≥n"),
  Valor = c(round(adf_resultado$statistic, 4),
            adf_resultado$parameter,
            round(adf_resultado$p.value, 4),
            "0.05",
            ifelse(adf_resultado$p.value > 0.05, 
                   "Serie NO estacionaria", "Serie estacionaria ‚úì"))
)

kable(tabla_adf, 
      caption = "Prueba de Dickey-Fuller Aumentada (ADF) - Serie en Niveles",
      align = c("l", "c")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  row_spec(3, bold = TRUE, color = qqq_pal$negative, background = "#ffe8e0") %>% 
  row_spec(5, bold = TRUE, background = "#fef3f2", color = qqq_pal$text_dark)
```

Con p-valor de 0.1352 > 0.05, no se rechaza la hip√≥tesis nula: la serie de precios del QQQ en niveles es no-estacionaria. Esta evidencia estad√≠stica justifica la aplicaci√≥n de diferenciaci√≥n.

### 4.2.3 Aplicaci√≥n de Diferenciaci√≥n de Primer Orden

```{r diferenciacion, echo=TRUE}
dif_Entrenamiento <- diff(Entrenamiento) %>% na.omit()
```

```{r grafico-diferenciada, echo=TRUE, fig.height=6}
df_diff <- data.frame(
  Fecha = index(dif_Entrenamiento),
  Valor = as.numeric(dif_Entrenamiento)
)

ggplot(df_diff, aes(x = Fecha, y = Valor)) +
  geom_line(color = qqq_pal$secondary, linewidth = 0.6) +
  geom_hline(yintercept = 0, linetype = "dashed", 
             color = qqq_pal$primary, linewidth = 0.7) +
  annotate("label", 
           x = as.Date("2023-06-01"), 
           y = max(df_diff$Valor) * 0.85,
           label = paste0("Media ‚âà ", round(mean(df_diff$Valor), 3)),
           fill = qqq_pal$primary, color = "white",
           fontface = "bold", size = 3.5, label.padding = unit(0.4, "lines")) +
  scale_x_date(date_breaks = "4 months", date_labels = "%b %Y",
               expand = expansion(mult = c(0.02, 0.03))) +
  scale_y_continuous(labels = scales::dollar_format(prefix = "$"),
                     expand = expansion(mult = c(0.05, 0.08))) +
  labs(
    title = "Serie Diferenciada de Primer Orden (d = 1)",
    subtitle = "QQQ: Cambios diarios en precio de cierre | Datos de entrenamiento",
    x = NULL,
    y = "Cambio Diario (USD)",
    caption = paste0("Observaciones: ", nrow(df_diff), 
                     " | Per√≠odo: ", min(df_diff$Fecha), " a ", max(df_diff$Fecha))
  ) +
  theme_QQQ() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

La serie diferenciada del QQQ oscila alrededor de media aproximadamente cero (0.444), sin tendencia visual evidente. La media permanece relativamente constante a lo largo del per√≠odo, caracter√≠stica fundamental de estacionariedad.

### 4.2.4 Verificaci√≥n Post-Diferenciaci√≥n

```{r acf-diferenciada, echo=TRUE, fig.height=5.5}
acf_diff_data <- acf(dif_Entrenamiento, lag.max = 30, plot = FALSE)

df_acf_diff <- data.frame(
  Lag = acf_diff_data$lag[-1],
  ACF = acf_diff_data$acf[-1]
)

n_diff <- length(dif_Entrenamiento)
limite_sup_diff <- qnorm(0.975) / sqrt(n_diff)
limite_inf_diff <- -limite_sup_diff

ggplot(df_acf_diff, aes(x = Lag, y = ACF)) +
  geom_segment(aes(xend = Lag, yend = 0), 
               color = qqq_pal$secondary, linewidth = 0.8) +
  geom_point(color = qqq_pal$secondary, size = 2) +
  geom_hline(yintercept = limite_sup_diff, linetype = "dashed", 
             color = qqq_pal$primary, linewidth = 0.7) +
  geom_hline(yintercept = limite_inf_diff, linetype = "dashed", 
             color = qqq_pal$primary, linewidth = 0.7) +
  geom_hline(yintercept = 0, color = qqq_pal$text_gray, linewidth = 0.5) +
  annotate("rect", xmin = -Inf, xmax = Inf, 
           ymin = limite_inf_diff, ymax = limite_sup_diff,
           fill = qqq_pal$primary, alpha = 0.1) +
  annotate("label", x = 22, y = 0.12,
           label = "Autocorrelaciones dentro\nde bandas ‚Üí Estacionaria ‚úì",
           fill = qqq_pal$positive, color = "white",
           fontface = "bold", size = 3.5, label.padding = unit(0.5, "lines")) +
  scale_x_continuous(breaks = seq(0, 30, 5)) +
  scale_y_continuous(limits = c(-0.15, 0.2), breaks = seq(-0.1, 0.2, 0.05)) +
  labs(
    title = "Funci√≥n de Autocorrelaci√≥n (ACF) - Serie Diferenciada",
    subtitle = "QQQ: Cambios diarios | Verificaci√≥n de estacionariedad post-diferenciaci√≥n",
    x = "Rezago (Lag)",
    y = "Autocorrelaci√≥n",
    caption = "Bandas verdes: L√≠mites de significancia al 95%"
  ) +
  theme_QQQ()
```

La mayor√≠a de autocorrelaciones caen dentro de las bandas de confianza. Este contraste dram√°tico con el $ACF$ de la serie original en niveles valida la diferenciaci√≥n.

```{r adf-diferenciada, echo=TRUE}
adf_diff_resultado <- adf.test(dif_Entrenamiento)

tabla_adf_diff <- data.frame(
  M√©trica = c("Estad√≠stico Dickey-Fuller", 
              "Orden de Rezagos (Lag)", 
              "P-valor",
              "Conclusi√≥n"),
  Valor = c(round(adf_diff_resultado$statistic, 4),
            adf_diff_resultado$parameter,
            round(adf_diff_resultado$p.value, 4),
            ifelse(adf_diff_resultado$p.value < 0.05,
                   "Serie ES estacionaria ‚úì",
                   "Serie NO estacionaria"))
)

kable(tabla_adf_diff, 
      caption = "Prueba de Dickey-Fuller Aumentada (ADF) - Serie Diferenciada (d=1)",
      align = c("l", "c")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  row_spec(3, bold = TRUE, color = qqq_pal$positive, background = "#e8f5e9") %>%
  row_spec(4, bold = TRUE, background = "#d4edda", color = qqq_pal$text_dark)
```

El estad√≠stico ADF de -8.6831 es altamente negativo, muy inferior al valor cr√≠tico de -3.43. Con p-valor de 0.01 < 0.05, se rechaza $H_0$. La serie diferenciada del QQQ es estacionaria. Por tanto, el par√°metro de integraci√≥n es $d=1$: una √∫nica diferenciaci√≥n convierte la serie de precios en una serie estacionaria de cambios diarios.

---

## 4.3 Identificaci√≥n del Modelo

El an√°lisis visual del $ACF$ y $PACF$ de la serie diferenciada del QQQ revela patrones caracter√≠sticos de mercados financieros eficientes:

```{r acf-pacf-dual, echo=TRUE, fig.height=6}
acf_data <- acf(dif_Entrenamiento, lag.max = 28, plot = FALSE)
pacf_data <- pacf(dif_Entrenamiento, lag.max = 28, plot = FALSE)

df_acf <- data.frame(
  Lag = as.numeric(acf_data$lag[-1]),
  Valor = as.numeric(acf_data$acf[-1])
)

df_pacf <- data.frame(
  Lag = as.numeric(pacf_data$lag),
  Valor = as.numeric(pacf_data$acf)
)

n <- length(dif_Entrenamiento)
limite <- qnorm(0.975) / sqrt(n)

p_acf <- ggplot(df_acf, aes(x = Lag, y = Valor)) +
  geom_hline(yintercept = 0, color = qqq_pal$text_gray, linewidth = 0.5) +
  geom_hline(yintercept = c(-limite, limite), linetype = "dashed", 
             color = qqq_pal$secondary, linewidth = 0.6) +
  annotate("rect", xmin = -Inf, xmax = Inf, ymin = -limite, ymax = limite,
           fill = qqq_pal$secondary, alpha = 0.08) +
  geom_segment(aes(xend = Lag, yend = 0), color = qqq_pal$primary, linewidth = 0.7) +
  geom_point(color = qqq_pal$primary, size = 1.5) +
  scale_x_continuous(breaks = seq(0, 28, 5)) +
  scale_y_continuous(limits = c(-0.15, 0.12)) +
  labs(title = "ACF - Serie Diferenciada",
       subtitle = "Identificaci√≥n del orden q (MA)",
       x = "Rezago (Lag)",
       y = "ACF") +
  theme_QQQ() +
  theme(plot.title = element_text(size = 12))

p_pacf <- ggplot(df_pacf, aes(x = Lag, y = Valor)) +
  geom_hline(yintercept = 0, color = qqq_pal$text_gray, linewidth = 0.5) +
  geom_hline(yintercept = c(-limite, limite), linetype = "dashed", 
             color = qqq_pal$secondary, linewidth = 0.6) +
  annotate("rect", xmin = -Inf, xmax = Inf, ymin = -limite, ymax = limite,
           fill = qqq_pal$secondary, alpha = 0.08) +
  geom_segment(aes(xend = Lag, yend = 0), color = qqq_pal$primary, linewidth = 0.7) +
  geom_point(color = qqq_pal$primary, size = 1.5) +
  scale_x_continuous(breaks = seq(0, 28, 5)) +
  scale_y_continuous(limits = c(-0.15, 0.12)) +
  labs(title = "PACF - Serie Diferenciada",
       subtitle = "Identificaci√≥n del orden p (AR)",
       x = "Rezago (Lag)",
       y = "PACF") +
  theme_QQQ() +
  theme(plot.title = element_text(size = 12))

grid.arrange(p_acf, p_pacf, ncol = 2)
```

En el $ACF$, la mayor√≠a de autocorrelaciones caen dentro de las bandas de confianza para todos los rezagos hasta lag 28. Esta ausencia sistem√°tica es consistente con la hip√≥tesis de mercado eficiente: los precios incorporan informaci√≥n disponible p√∫blicamente, dejando en los cambios diarios estructura pr√°cticamente aleatoria sin dependencias predecibles (Fama, 1970; Malkiel, 1973).

El $PACF$ exhibe un patr√≥n complementario: nuevamente, la mayor√≠a de autocorrelaciones parciales se ubican dentro de bandas de confianza. En conjunto, el an√°lisis $ACF/PACF$ sugiere que la serie diferenciada es cercana a ruido blanco, implicando que cualquier modelo $ARIMA$ que intente capturar estructura estar√° fundamentalmente limitado en capacidad predictiva, capturando quiz√°s peque√±os componentes de ineficiencia de mercado de corto plazo (Tsay, 2010; Hamilton, 1994).

### 4.3.2 Modelos ARIMA Candidatos

```{r modelos-candidatos-tabla, echo=TRUE}
tabla_candidatos <- data.frame(
  Modelo = c("ARIMA(0,1,0)", 
             "ARIMA(1,1,1)",
             "ARIMA(2,1,1)", 
             "ARIMA(1,1,2)",
             "ARIMA(2,1,2)",
             "ARIMA(3,1,3)"),
  Tipo = c("Random Walk",
           "auto.arima()",
           "Manual",
           "Manual",
           "Manual",
           "Exploratorio"),
  Justificaci√≥n = c(
    "Benchmark: hip√≥tesis de mercado eficiente",
    "Referencia algor√≠tmica para validar selecci√≥n manual",
    "Extensi√≥n AR(2) para capturar persistencia de corto plazo",
    "Extensi√≥n MA(2) para capturar estructura de media m√≥vil",
    "Modelo sim√©trico que combina din√°micas AR y MA",
    "Evaluar si rezagos marginales aportan capacidad predictiva"
  )
)

kable(tabla_candidatos,
      caption = "Modelos ARIMA Candidatos para Evaluaci√≥n",
      align = c("l", "c", "l"),
      col.names = c("Modelo", "Tipo", "Justificaci√≥n")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(2, color = qqq_pal$secondary) %>%
  column_spec(3, width = "30em") %>%
  row_spec(2, background = "#e8f5e9", color = qqq_pal$text_dark, bold = TRUE)
```

La selecci√≥n de estos seis modelos candidatos obedece a una l√≥gica progresiva de complejidad. El $ARIMA(0,1,0)$ (random walk) representa la hip√≥tesis nula de mercado eficiente: no existe estructura explorable. El $ARIMA(1,1,1)$ fue seleccionado autom√°ticamente por `auto.arima()` y es el m√°s parsimonioso que a√±ade estructura genuina. Los dem√°s representan extensiones que exploran si estructura adicional existe en la serie del QQQ.

---

## 4.4 Estimaci√≥n y Comparaci√≥n de Modelos

### 4.4.1 Criterios de Informaci√≥n

```{r ajuste-modelos, echo=TRUE}
ModeloQA <- auto.arima(Entrenamiento)
modeloQ1 <- Arima(Entrenamiento, order = c(3,1,3))
modeloQ2 <- Arima(Entrenamiento, order = c(0,1,0))
modeloQ3 <- Arima(Entrenamiento, order = c(2,1,1))
modeloQ4 <- Arima(Entrenamiento, order = c(1,1,2))
modeloQ5 <- Arima(Entrenamiento, order = c(2,1,2))
```

```{r criterios-informacion, echo=TRUE}
comparacion_IC <- data.frame(
  Modelo = c("ARIMA(0,1,0)", 
             "ARIMA(1,1,1) + drift", 
             "ARIMA(2,1,1)", 
             "ARIMA(1,1,2)",
             "ARIMA(2,1,2)",
             "ARIMA(3,1,3)"),
  Parametros = c(length(coef(modeloQ2)) + 1,
                 length(coef(ModeloQA)) + 1,
                 length(coef(modeloQ3)) + 1,
                 length(coef(modeloQ4)) + 1,
                 length(coef(modeloQ5)) + 1,
                 length(coef(modeloQ1)) + 1),
  AIC = round(c(AIC(modeloQ2), 
                AIC(ModeloQA), 
                AIC(modeloQ3), 
                AIC(modeloQ4),
                AIC(modeloQ5),
                AIC(modeloQ1)), 2),
  AICc = round(c(modeloQ2$aicc, 
                 ModeloQA$aicc, 
                 modeloQ3$aicc, 
                 modeloQ4$aicc,
                 modeloQ5$aicc,
                 modeloQ1$aicc), 2),
  BIC = round(c(BIC(modeloQ2), 
                BIC(ModeloQA), 
                BIC(modeloQ3), 
                BIC(modeloQ4),
                BIC(modeloQ5),
                BIC(modeloQ1)), 2)
)

comparacion_IC <- comparacion_IC %>%
  arrange(AICc) %>%
  mutate(Ranking = row_number()) %>%
  select(Ranking, Modelo, Parametros, AIC, AICc, BIC)

kable(comparacion_IC,
      caption = "Comparaci√≥n de Modelos por Criterios de Informaci√≥n",
      align = c("c", "l", "c", "c", "c", "c"),
      col.names = c("Ranking", "Modelo", "# Par√°metros", "AIC", "AICc", "BIC")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(2, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(5, bold = TRUE, color = qqq_pal$positive) %>%
  row_spec(1, bold = TRUE, background = "#e8f5e9", color = qqq_pal$text_dark) %>%
  footnote(general = "Ordenado por AICc (menor es mejor). AICc es el criterio preferido para muestras finitas.",
           general_title = "Nota: ")
```

El $ARIMA(1,1,1)$ + drift del QQQ emerge como ganador indiscutible con $AICc$ = 4663.94, significativamente menor que $ARIMA(2,1,2)$ (4668.14, ranking 2). La diferencia de 4.2 puntos en $AICc$ es clara, validando $ARIMA(1,1,1)$ como notablemente superior. Seg√∫n Burnham & Anderson (2002), diferencias entre 4-7 indican soporte moderado para modelo superior. El t√©rmino "drift" representa una constante en la ecuaci√≥n de diferencias que captura la tendencia lineal impl√≠cita: durante el per√≠odo de an√°lisis (2022-2025), el $QQQ$ exhibi√≥ movimiento alcista promedio, reflejando optimismo en tecnolog√≠a pese a volatilidad (Brockwell & Davis, 2016).

La evaluaci√≥n de modelos m√°s complejos revela el problema de sobreparametrizaci√≥n: aunque $ARIMA(3,1,3)$ tiene $AIC$ m√°s bajo (4669.04), su $AICc$ es 4669.19 (ranking 6) porque la penalizaci√≥n por 7 par√°metros domina cualquier mejora marginal. El $ARIMA(0,1,0)$ (random walk puro) produce $AICc =$ 4668.39 (ranking 3), confirmando que estructura existe aunque sea peque√±a.

### 4.4.2 M√©tricas de Precisi√≥n en Entrenamiento

```{r metricas-precision, echo=TRUE}
acc_QA <- accuracy(ModeloQA)
acc_Q1 <- accuracy(modeloQ1)
acc_Q2 <- accuracy(modeloQ2)
acc_Q3 <- accuracy(modeloQ3)
acc_Q4 <- accuracy(modeloQ4)
acc_Q5 <- accuracy(modeloQ5)

comparacion_accuracy <- data.frame(
  Modelo = c("ARIMA(0,1,0)", 
             "ARIMA(1,1,1) + drift", 
             "ARIMA(2,1,1)", 
             "ARIMA(1,1,2)",
             "ARIMA(2,1,2)",
             "ARIMA(3,1,3)"),
  ME = round(c(acc_Q2["Training set", "ME"], 
               acc_QA["Training set", "ME"], 
               acc_Q3["Training set", "ME"], 
               acc_Q4["Training set", "ME"],
               acc_Q5["Training set", "ME"],
               acc_Q1["Training set", "ME"]), 4),
  RMSE = round(c(acc_Q2["Training set", "RMSE"], 
                 acc_QA["Training set", "RMSE"], 
                 acc_Q3["Training set", "RMSE"], 
                 acc_Q4["Training set", "RMSE"],
                 acc_Q5["Training set", "RMSE"],
                 acc_Q1["Training set", "RMSE"]), 4),
  MAE = round(c(acc_Q2["Training set", "MAE"], 
                acc_QA["Training set", "MAE"], 
                acc_Q3["Training set", "MAE"], 
                acc_Q4["Training set", "MAE"],
                acc_Q5["Training set", "MAE"],
                acc_Q1["Training set", "MAE"]), 4),
  MAPE = round(c(acc_Q2["Training set", "MAPE"], 
                 acc_QA["Training set", "MAPE"], 
                 acc_Q3["Training set", "MAPE"], 
                 acc_Q4["Training set", "MAPE"],
                 acc_Q5["Training set", "MAPE"],
                 acc_Q1["Training set", "MAPE"]), 4),
  MASE = round(c(acc_Q2["Training set", "MASE"], 
                 acc_QA["Training set", "MASE"], 
                 acc_Q3["Training set", "MASE"], 
                 acc_Q4["Training set", "MASE"],
                 acc_Q5["Training set", "MASE"],
                 acc_Q1["Training set", "MASE"]), 4)
)

comparacion_accuracy <- comparacion_accuracy %>%
  arrange(RMSE) %>%
  mutate(Ranking = row_number()) %>%
  select(Ranking, Modelo, ME, RMSE, MAE, MAPE, MASE)

kable(comparacion_accuracy,
      caption = "M√©tricas de Precisi√≥n sobre Datos de Entrenamiento",
      align = c("c", "l", rep("c", 5))) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(2, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(4, bold = TRUE, color = qqq_pal$positive) %>%
  row_spec(1, background = "#e8f5e9", color = qqq_pal$text_dark, bold = TRUE) %>%
  footnote(general = "ME: Error Medio | RMSE: Ra√≠z del Error Cuadr√°tico Medio | MAE: Error Absoluto Medio | MAPE: Error Porcentual (%) | MASE: Error Escalado",
           general_title = "M√©tricas: ")
```

El Error Medio (ME) de todos los modelos es cercano a cero (rango: -0.0001 a 0.4939), confirmando que son aproximadamente insesgados. El $ARIMA(1,1,1)$ + drift tiene $ME =$ -0.0001, virtualmente perfecto. El $RMSE$ del $ARIMA(3,1,3)$ lidera con 5.4759, marginalmente inferior al $ARIMA(1,1,1)$ + drift (5.4792), una diferencia de 0.0033 negligible en t√©rminos pr√°cticos (0.06% mejora) mientras requiere 75% incremento en par√°metros.

El Error Absoluto Medio (MAE) del $ARIMA(1,1,1)$ + drift es 3.8704: en promedio, predicciones desviaron ¬±3.87 puntos del valor real. El MAPE es 0.9445%, indicando error promedio menos de 1% del valor real. El MASE de todos los modelos es < 1, mejorando al random walk puro. El $ARIMA(1,1,1)$ + drift obtiene $MASE =$ 0.9943, mejorando al random walk en ~0.6%‚Äîen contexto de series financieras eficientes, una mejora significativa (Hyndman & Koehler, 2006).

---

## 4.5 Diagn√≥stico de Residuos

El proceso de diagn√≥stico valida que el modelo $ARIMA(1,1,1)$ + drift seleccionado produce residuos que se comportan como ruido blanco: secuencia aleatoria con media cero, varianza constante, y ausencia de autocorrelaci√≥n.

### 4.5.1 An√°lisis Gr√°fico de Residuos

```{r residuos-grafico, echo=TRUE}
residuos <- residuals(ModeloQA)

df_residuos <- data.frame(
  Fecha = index(residuos),
  Residuo = as.numeric(residuos)
)

p1 <- ggplot(df_residuos, aes(x = Fecha, y = Residuo)) +
  geom_line(color = qqq_pal$secondary, linewidth = 0.5) +
  geom_hline(yintercept = 0, linetype = "dashed", 
             color = qqq_pal$primary, linewidth = 0.7) +
  geom_hline(yintercept = c(-2*sd(df_residuos$Residuo), 2*sd(df_residuos$Residuo)), 
             linetype = "dotted", color = qqq_pal$negative, linewidth = 0.5) +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %Y") +
  labs(title = "Residuos del Modelo en el Tiempo",
       subtitle = "Verificaci√≥n de media cero y varianza constante",
       x = NULL,
       y = "Residuo") +
  theme_QQQ() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

p1
acf_resid <- acf(residuos, lag.max = 25, plot = FALSE)
df_acf_resid <- data.frame(
  Lag = as.numeric(acf_resid$lag[-1]),
  ACF = as.numeric(acf_resid$acf[-1])
)

n_resid <- length(residuos)
limite_resid <- qnorm(0.975) / sqrt(n_resid)

p2 <- ggplot(df_acf_resid, aes(x = Lag, y = ACF)) +
  geom_hline(yintercept = 0, color = qqq_pal$text_gray, linewidth = 0.5) +
  geom_hline(yintercept = c(-limite_resid, limite_resid), linetype = "dashed", 
             color = qqq_pal$primary, linewidth = 0.6) +
  annotate("rect", xmin = -Inf, xmax = Inf, ymin = -limite_resid, ymax = limite_resid,
           fill = qqq_pal$primary, alpha = 0.1) +
  geom_segment(aes(xend = Lag, yend = 0), color = qqq_pal$secondary, linewidth = 0.7) +
  geom_point(color = qqq_pal$secondary, size = 1.5) +
  scale_x_continuous(breaks = seq(0, 25, 5)) +
  scale_y_continuous(limits = c(-0.15, 0.15)) +
  labs(title = "ACF de Residuos",
       subtitle = "Verificaci√≥n de independencia",
       x = "Rezago (Lag)",
       y = "ACF") +
  theme_QQQ()
p2
p3 <- ggplot(df_residuos, aes(x = Residuo)) +
  geom_histogram(aes(y = after_stat(density)), 
                 bins = 35, fill = qqq_pal$primary, 
                 color = "white", alpha = 0.7) +
  geom_density(color = qqq_pal$secondary, linewidth = 1) +
  stat_function(fun = dnorm, 
                args = list(mean = mean(df_residuos$Residuo), 
                            sd = sd(df_residuos$Residuo)),
                color = qqq_pal$negative, linewidth = 1, linetype = "dashed") +
  labs(title = "Distribuci√≥n de Residuos",
       subtitle = "Verificaci√≥n de normalidad",
       x = "Residuo",
       y = "Densidad",
       caption = "L√≠nea roja punteada: distribuci√≥n normal te√≥rica") +
  theme_QQQ()
p3
```

El gr√°fico temporal de residuos exhibe oscilaci√≥n alrededor de media pr√≥xima a cero (0.0001), validando ausencia de sesgo sistem√°tico. La varianza aparece aproximadamente constante, sugiriendo homocedasticidad. El $ACF$ de residuos muestra ausencia de autocorrelaci√≥n significativa: la mayor√≠a caen dentro de bandas de confianza.

El histograma de densidad muestra forma aproximadamente sim√©trica y unimodal, consistente con distribuci√≥n normal. Se observa presencia de "fat tails" (colas pesadas): residuos extremos ocurren con probabilidad ligeramente mayor que lo predicho por normalidad exacta, caracter√≠stica t√≠pica de datos financieros reales (Tsay, 2010).

### 4.5.2 Q-Q Plot de Normalidad

```{r residuos-qq, echo=TRUE}

residuos_std <- scale(residuals(ModeloQA))
df_qq <- data.frame(residuos = residuos_std)

n <- length(residuos_std)
cuantiles_teoricos <- qnorm(ppoints(n))
cuantiles_observados <- sort(residuos_std)
df_qq_line <- data.frame(x = cuantiles_teoricos, y = cuantiles_observados)

fit <- lm(y ~ x, data = df_qq_line)
df_qq_line$fitted <- predict(fit, df_qq_line)

df_qq_puntos <- data.frame(
  x = cuantiles_teoricos,
  y = cuantiles_observados,
  label = paste0(
    "Cuantil te√≥rico: ", round(cuantiles_teoricos, 3), "<br>",
    "Residuo observado: ", round(cuantiles_observados, 3)
  )
)

p_qq <- ggplot() +
  geom_line(data = df_qq_line, aes(x = x, y = fitted), 
            color = qqq_pal$negative, linewidth = 1.1) +
  geom_point(data = df_qq_puntos, aes(x = x, y = y, text = label),
             color = qqq_pal$primary, size = 2.5, alpha = 0.75) +
  labs(
    title = "Q-Q Plot de Residuos Estandarizados",
    subtitle = "Verificaci√≥n de normalidad del modelo | L√≠nea roja = distribuci√≥n normal te√≥rica",
    x = "Cuantiles Te√≥ricos (Distribuci√≥n Normal Est√°ndar)",
    y = "Cuantiles Observados (Residuos Estandarizados)",
    caption = "‚úì Puntos alineados con la l√≠nea roja indican buenos residuos normales"
  ) +
  theme_QQQ() +
  theme(
    plot.title = element_text(size = 13, face = "bold", color = qqq_pal$primary),
    plot.subtitle = element_text(size = 11, color = qqq_pal$text_gray, margin = margin(b = 8)),
    plot.caption = element_text(size = 9, color = qqq_pal$secondary, face = "italic"),
    panel.background = element_rect(fill = "#f8f9fa", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    axis.line = element_line(color = qqq_pal$text_gray, linewidth = 0.5),
    panel.grid.major = element_line(color = "#e8eef5", linewidth = 0.3),
    panel.grid.minor = element_blank()
  )

plotly::ggplotly(p_qq, tooltip = "text") %>%
  plotly::layout(
    font = list(family = "Arial, sans-serif", size = 11, color = qqq_pal$text_dark),
    plot_bgcolor = "#f8f9fa",
    paper_bgcolor = "white",
    xaxis = list(
      showgrid = TRUE,
      gridwidth = 1,
      gridcolor = "#e8eef5",
      zeroline = FALSE,
      showline = TRUE,
      linewidth = 1,
      linecolor = qqq_pal$text_gray,
      mirror = TRUE
    ),
    yaxis = list(
      showgrid = TRUE,
      gridwidth = 1,
      gridcolor = "#e8eef5",
      zeroline = FALSE,
      showline = TRUE,
      linewidth = 1,
      linecolor = qqq_pal$text_gray,
      mirror = TRUE
    ),
    hovermode = "closest",
    margin = list(l = 60, r = 30, t = 80, b = 60)
  ) %>%
  plotly::config(
    displayModeBar = TRUE,
    displaylogo = FALSE,
    collaborate = FALSE,
    modeBarButtonsToRemove = c("lasso2d", "select2d"),
    toImageButtonOptions = list(
      format = "png",
      filename = "qq_plot_residuos",
      height = 600,
      width = 900,
      scale = 2
    )
  )
```

Se observa alineaci√≥n muy cercana de puntos con la l√≠nea te√≥rica en la regi√≥n central. En las colas (cuantiles extremos), hay desviaci√≥n sistem√°tica indicando presencia de "fat tails". Esta caracter√≠stica no invalida el modelo pero tiene implicaciones para intervalos de confianza: pueden ser ligeramente conservadores en t√©rminos de probabilidades de eventos extremos (Tsay, 2010).

### 4.5.3 Test de Independencia (Ljung-Box)

```{r residuos-tabla, echo=TRUE}
lb_test <- Box.test(residuals(ModeloQA), lag = 10, type = "Ljung-Box")

tabla_ljung <- data.frame(
  M√©trica = c("Estad√≠stico Ljung-Box", 
              "Grados de Libertad", 
              "P-valor",
              "Conclusi√≥n"),
  Valor = c(
    round(lb_test$statistic, 4),
    lb_test$parameter,
    round(lb_test$p.value, 4),
    ifelse(lb_test$p.value > 0.05, 
           "Residuos son ruido blanco ‚úì", 
           "Posible autocorrelaci√≥n residual")
  )
)

kable(tabla_ljung, 
      caption = "Test de Ljung-Box: Independencia de Residuos",
      align = c("l", "c")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  row_spec(4, bold = TRUE, 
           background = ifelse(lb_test$p.value > 0.05, "#e8f5e9", "#ffe8e0"),
           color = qqq_pal$text_dark)
```

El estad√≠stico Ljung-Box de $Q^*$ = 10.1399 con 10 grados de libertad produce p-valor = 0.4283 > 0.05. No se rechaza la hip√≥tesis nula: los residuos no exhiben autocorrelaci√≥n significativa en los primeros 10 rezagos. El $p-valor$ de 0.43 indica que si verdaderamente los residuos fuesen ruido blanco independiente, observar√≠amos una estad√≠stica de prueba tan extrema o m√°s extrema con probabilidad del 43%‚Äîresultado completamente consistente con independencia (Ljung & Box, 1978).

---

## 4.6 Pron√≥stico y Evaluaci√≥n

Una vez validado que el modelo $ARIMA(1,1,1)$ + drift produce residuos que se comportan como ruido blanco, procede la etapa de pron√≥stico: generaci√≥n de predicciones puntuales para el QQQ junto con intervalos de confianza que cuantifican incertidumbre.

```{r pronostico-generacion, echo=TRUE}
pronostico <- forecast(ModeloQA, h = 10, level = 95)

ultima_fecha <- as.Date(index(Entrenamiento)[length(Entrenamiento)])

fechas_pronostico <- c()
fecha_actual <- ultima_fecha
dias_agregados <- 0

while(dias_agregados < 10) {
  fecha_actual <- fecha_actual + 1
  if (!(weekdays(fecha_actual) %in% c("s√°bado", "domingo", "Saturday", "Sunday"))) {
    fechas_pronostico <- c(fechas_pronostico, fecha_actual)
    dias_agregados <- dias_agregados + 1
  }
}

fechas_pronostico <- as.Date(fechas_pronostico, origin = "1970-01-01")
```

### 4.6.1 Tabla de Pron√≥sticos

```{r tabla-pronosticos, echo=TRUE}
tabla_pronostico <- data.frame(
  D√≠a = 1:10,
  Fecha = as.character(fechas_pronostico),
  Pron√≥stico = round(as.numeric(pronostico$mean), 2),
  `L√≠mite Inferior` = round(as.numeric(pronostico$lower), 2),
  `L√≠mite Superior` = round(as.numeric(pronostico$upper), 2),
  `Amplitud IC` = round(as.numeric(pronostico$upper) - as.numeric(pronostico$lower), 2)
)

kable(tabla_pronostico,
      caption = "Pron√≥sticos del Modelo ARIMA(1,1,1) con Drift - Intervalo de Confianza al 95%",
      align = c("c", "c", "c", "c", "c", "c"),
      col.names = c("D√≠a", "Fecha", "Pron√≥stico (USD)", "L√≠m. Inferior", "L√≠m. Superior", "Amplitud IC")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(3, bold = TRUE, color = qqq_pal$primary, background = "#f0f9ff") %>%
  column_spec(4, color = qqq_pal$negative) %>%
  column_spec(5, color = qqq_pal$positive) %>%
  column_spec(6, color = "#666666") %>%
  footnote(general = "IC = Intervalo de Confianza. La amplitud del intervalo aumenta con el horizonte de pron√≥stico.",
           general_title = "Nota: ")
```

Los pron√≥sticos del $ARIMA(1,1,1)$ + drift para los pr√≥ximos 10 d√≠as h√°biles (01-octubre a 14-octubre 2025) se ubican en el rango 600.71 a 604.76 USD. El incremento inicial refleja el drift estimado: una tendencia alcista promedio de Œº ‚âà 0.4-0.5 d√≥lares por d√≠a. La amplitud expansiva de los intervalos de confianza es caracter√≠stica: el IC 95% en el d√≠a 1 tiene amplitud apenas 21.54, pero se expande a 66.01 en el d√≠a 10. Esta expansi√≥n refleja que bajo un $ARIMA(1,1,1)$ con $d=1$, la varianza del pron√≥stico crece aproximadamente como $œÉ¬≤¬∑h$, donde $œÉ¬≤$ es varianza de innovaciones (Hamilton, 1994).

### 4.6.2 Gr√°fico: Pron√≥stico con Intervalo de Confianza

```{r grafico-pronostico, echo=TRUE, fig.height=6.5}
n_historico <- 100
datos_hist <- tail(Entrenamiento, n_historico)

df_historico <- data.frame(
  Fecha = as.Date(index(datos_hist)),
  Precio = as.numeric(datos_hist),
  Tipo = "Hist√≥rico"
)

ultima_fecha <- as.Date(index(Entrenamiento)[length(Entrenamiento)])
fechas_forecast <- ultima_fecha + 1:10

df_pronostico <- data.frame(
  Fecha = fechas_forecast,
  Precio = as.numeric(pronostico$mean),
  Lower = as.numeric(pronostico$lower),
  Upper = as.numeric(pronostico$upper)
)

punto_conexion <- data.frame(
  Fecha = ultima_fecha,
  Precio = as.numeric(tail(datos_hist, 1)),
  Lower = as.numeric(tail(datos_hist, 1)),
  Upper = as.numeric(tail(datos_hist, 1))
)

df_pronostico_completo <- bind_rows(punto_conexion, df_pronostico)

ggplot() +
  geom_ribbon(data = df_pronostico_completo,
              aes(x = Fecha, ymin = Lower, ymax = Upper),
              fill = qqq_pal$secondary, alpha = 0.2) +
  geom_line(data = df_historico,
            aes(x = Fecha, y = Precio),
            color = qqq_pal$primary, linewidth = 0.7) +
  geom_line(data = df_pronostico_completo,
            aes(x = Fecha, y = Precio),
            color = qqq_pal$secondary, linewidth = 0.8) +
  geom_point(data = df_pronostico %>% filter(Fecha == max(Fecha)),
             aes(x = Fecha, y = Precio),
             color = qqq_pal$secondary, size = 2.5) +
  geom_point(data = punto_conexion,
             aes(x = Fecha, y = Precio),
             color = qqq_pal$primary, size = 2.5) +
  geom_vline(xintercept = ultima_fecha, 
             linetype = "dashed", color = qqq_pal$negative, linewidth = 0.5) +
  annotate("label",
           x = min(df_historico$Fecha) + 15,
           y = max(df_historico$Precio, df_pronostico$Upper) * 0.99,
           label = "Entrenamiento",
           fill = qqq_pal$primary, color = "white",
           fontface = "bold", size = 3, label.padding = unit(0.3, "lines")) +
  annotate("label",
           x = max(df_pronostico$Fecha) - 3,
           y = max(df_pronostico$Upper) * 1.01,
           label = "Pron√≥stico",
           fill = qqq_pal$secondary, color = "white",
           fontface = "bold", size = 3, label.padding = unit(0.3, "lines")) +
  scale_x_date(date_breaks = "3 weeks", date_labels = "%d %b",
               expand = expansion(mult = c(0.02, 0.08))) +
  scale_y_continuous(labels = scales::dollar_format(),
                     expand = expansion(mult = c(0.02, 0.05))) +
  labs(title = "Pron√≥stico ARIMA(1,1,1) con Drift",
       subtitle = "QQQ (Nasdaq-100 ETF) | √öltimos 100 d√≠as + 10 d√≠as de pron√≥stico | IC 95%",
       x = NULL,
       y = "Precio de Cierre (USD)",
       caption = "L√≠nea verde: Datos hist√≥ricos | L√≠nea cian: Pron√≥stico | √Årea sombreada: Intervalo de confianza 95%") +
  theme_QQQ() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### 4.6.3 Evaluaci√≥n Comparativa: Predicho vs Real

```{r predicho-vs-real, echo=TRUE, fig.height=6}
reales <- head(as.numeric(Prueba), 10)
predichos <- as.numeric(pronostico$mean)
fechas_prueba <- head(as.Date(index(Prueba)), 10)

df_evaluacion <- data.frame(
  Dia = 1:10,
  Fecha = fechas_prueba,
  Real = reales,
  Predicho = round(predichos, 2),
  Error = round(reales - predichos, 2),
  Error_Abs = round(abs(reales - predichos), 2),
  Error_Pct = round((reales - predichos) / reales * 100, 2)
)

df_largo <- df_evaluacion %>%
  select(Dia, Fecha, Real, Predicho) %>%
  pivot_longer(cols = c(Real, Predicho),
               names_to = "Tipo",
               values_to = "Precio")

ggplot(df_largo, aes(x = Dia, y = Precio, color = Tipo, shape = Tipo)) +
  geom_line(linewidth = 0.8) +
  geom_point(size = 3) +
  geom_ribbon(data = df_evaluacion,
              aes(x = Dia, y = Predicho,
                  ymin = as.numeric(pronostico$lower),
                  ymax = as.numeric(pronostico$upper)),
              fill = qqq_pal$secondary, alpha = 0.15,
              inherit.aes = FALSE) +
  scale_color_manual(values = c("Real" = qqq_pal$primary, 
                                "Predicho" = qqq_pal$secondary),
                     labels = c("Predicho" = "Pron√≥stico", "Real" = "Valor Real")) +
  scale_shape_manual(values = c("Real" = 16, "Predicho" = 17),
                     labels = c("Predicho" = "Pron√≥stico", "Real" = "Valor Real")) +
  scale_x_continuous(breaks = 1:10, labels = paste0("t+", 1:10)) +
  scale_y_continuous(labels = scales::dollar_format()) +
  labs(title = "Evaluaci√≥n del Pron√≥stico: Valores Reales vs Predichos",
       subtitle = "QQQ (Nasdaq-100 ETF) | Primeros 10 d√≠as del conjunto de prueba",
       x = "Horizonte de Pron√≥stico",
       y = "Precio de Cierre (USD)",
       color = NULL,
       shape = NULL,
       caption = "√Årea sombreada: Intervalo de confianza 95%") +
  theme_QQQ() +
  theme(legend.position = "top")
```

Los primeros 10 d√≠as observados de octubre 2025 revelan que valores reales exhiben volatilidad que oscila alrededor de la l√≠nea de pron√≥stico, sin divergencia sistem√°tica consistente. Los valores reales caen todos dentro del intervalo de confianza 95%, validando calibraci√≥n correcta de la incertidumbre.

### 4.6.4 Tabla de Errores por Observaci√≥n

```{r tabla-errores, echo=TRUE}
tabla_errores <- df_evaluacion %>%
  select(Dia, Fecha, Real, Predicho, Error, Error_Pct) %>%
  mutate(
    Fecha = as.character(Fecha),
    Real = paste0("$", round(Real, 2)),
    Predicho = paste0("$", round(Predicho, 2)),
    Error = round(Error, 2),
    Error_Pct = paste0(round(Error_Pct, 2), "%")
  )

kable(tabla_errores,
      caption = "Evaluaci√≥n del Pron√≥stico: Errores por Observaci√≥n",
      align = c("c", "c", "c", "c", "c", "c"),
      col.names = c("D√≠a", "Fecha", "Valor Real", "Pron√≥stico", "Error (USD)", "Error (%)")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(3, color = qqq_pal$primary, bold = TRUE) %>%
  column_spec(4, color = qqq_pal$secondary, bold = TRUE) %>%
  column_spec(5, bold = TRUE) %>%
  column_spec(6, bold = TRUE) %>%
  footnote(general = "Error positivo: el modelo subestim√≥ (valor real > pron√≥stico). Error negativo: el modelo sobreestim√≥.",
           general_title = "Nota: ")
```

Los errores exhiben distribuci√≥n asim√©trica pero no-sistem√°tica. Los primeros tres d√≠as exhiben errores positivos peque√±os, indicando subestimaci√≥n leve. Lo notable es la simetr√≠a aproximada de errores: errores positivos en d√≠as iniciales son balanceados aproximadamente por errores negativos posteriormente, indicando que el modelo no tiene sesgo direccional sistem√°tico.

### 4.6.5 M√©tricas Finales de Evaluaci√≥n

```{r metricas-finales, echo=TRUE}
MAE <- mean(abs(df_evaluacion$Error))
RMSE <- sqrt(mean(df_evaluacion$Error^2))
MAPE <- mean(abs(df_evaluacion$Error_Pct))
ME <- mean(df_evaluacion$Error)

dentro_IC <- sum(reales >= as.numeric(pronostico$lower) & 
                   reales <= as.numeric(pronostico$upper))
pct_dentro_IC <- dentro_IC / 10 * 100

tabla_metricas <- data.frame(
  M√©trica = c("Error Medio (ME)",
              "Error Absoluto Medio (MAE)",
              "Ra√≠z del Error Cuadr√°tico Medio (RMSE)",
              "Error Porcentual Absoluto Medio (MAPE)",
              "Observaciones dentro del IC 95%"),
  Valor = c(paste0("$", round(ME, 2)),
            paste0("$", round(MAE, 2)),
            paste0("$", round(RMSE, 2)),
            paste0(round(MAPE, 2), "%"),
            paste0(dentro_IC, " de 10 (", pct_dentro_IC, "%)")),
  Interpretaci√≥n = c(
    ifelse(abs(ME) < 1, "Sin sesgo sistem√°tico ‚úì", 
           ifelse(ME > 0, "Modelo subestima", "Modelo sobreestima")),
    "Error promedio en USD",
    "Penaliza errores grandes",
    "Error relativo al precio",
    ifelse(pct_dentro_IC >= 80, "Intervalos bien calibrados ‚úì", 
           "Intervalos pueden estar mal calibrados")
  )
)

kable(tabla_metricas,
      caption = "M√©tricas de Evaluaci√≥n del Pron√≥stico - Datos de Prueba",
      align = c("l", "c", "l")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(2, bold = TRUE) %>%
  row_spec(5, background = "#e8f5e9", color = qqq_pal$text_dark, bold = TRUE)
```

El Error Medio (ME) = 0.85 es notablemente peque√±o, validando ausencia de sesgo direccional sistem√°tico. El Error Absoluto Medio (MAE) = 5.54 cuantifica desviaci√≥n promedio de ¬±5.54 o 0.92% del precio. La Ra√≠z del Error Cuadr√°tico Medio (RMSE) = 6.68 es ligeramente superior porque penaliza desviaciones grandes. El Error Porcentual Absoluto Medio (MAPE) = 0.92% es excelente para pron√≥stico de precios de activos financieros.

La m√©trica m√°s reveladora es "Observaciones dentro del IC 95%" = 10 de 10 (100%). Esta perfecta cobertura indica que el intervalo de confianza fue exactamente bien calibrado: todos los valores reales cayeron dentro de las bandas predichas, validando calibraci√≥n correcta de la incertidumbre (Hyndman & Koehler, 2006).


---

# 4. Conclusiones

## 4.1 Hallazgos Principales

[**PLACEHOLDER:** Resumen de hallazgos principales del an√°lisis ARIMA]

## 4.2 Implicaciones Pr√°cticas

[**PLACEHOLDER:** Implicaciones de los pron√≥sticos para inversionistas y analistas de mercado]

## 4.3 Limitaciones del An√°lisis

[**PLACEHOLDER:** Limitaciones del modelo y aspectos no capturados]

## 4.4 Recomendaciones Futuras

[**PLACEHOLDER:** Sugerencias para mejoras y extensiones del an√°lisis]



```{=html}

<div style="
  margin-top: 80px;
  padding: 40px;
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.15), rgba(6, 182, 212, 0.08));
  border: 2px solid rgba(124, 58, 237, 0.4);
  border-radius: 15px;
  border-top: 3px solid rgba(132, 204, 22, 0.8);
  text-align: center;
  color: #e0e6ed;
  font-size: 0.95em;
  line-height: 1.8;
  box-shadow: 0 8px 30px rgba(124, 58, 237, 0.2);
">
  <div style="margin-bottom: 20px; background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; font-size: 1.1em;">
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  </div>
  
  <strong style="background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ASIGNATURA:</strong> Gesti√≥n de Datos<br>
  <strong style="background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">PROFESOR:</strong> Orlando Joaqui-Barandica<br>
  <strong style="background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">UNIVERSIDAD:</strong> Universidad del Valle<br>
  <strong style="background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">FACULTAD:</strong> Facultad de Ingenier√≠a<br>
  <strong style="background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">PROGRAMA:</strong> Ingenier√≠a Industrial<br>
  
  <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(124, 58, 237, 0.3);">
    <strong style="background: linear-gradient(135deg, #06b6d4, #84cc16); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ESTUDIANTE:</strong> Camilo<br>
    <strong style="background: linear-gradient(135deg, #06b6d4, #84cc16); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">FECHA ENTREGA:</strong> <span id="fecha-entrega"></span><br>
    <strong style="background: linear-gradient(135deg, #06b6d4, #84cc16); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">VERSI√ìN:</strong> 1.0<br>
  </div>
  
  <div style="margin-top: 20px; color: #94a3b8; font-size: 0.9em;">
    <em>Documento generado con R Markdown | Tema: Series de Tiempo y Pron√≥sticos ARIMA</em>
  </div>
  
  <div style="margin-top: 15px; background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700;">
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  </div>
</div>
```



