---
title: "Aplicaci√≥n de Modelos ARIMA y An√°lisis de Series de Tiempo para la Predicci√≥n de Precios de Cierre del ETF QQQ (2022-2025)"
subtitle: "Evaluaci√≥n de la volatilidad, tendencias del sector tecnol√≥gico y proyecciones estoc√°sticas de corto plazo"
author: "Portilla Aguirre Johan Camilo (2422468), Barros Rayo Alejandro (2415837), Mu√±oz Portela Diego Fernando (2415620) "
date: "`r format(Sys.Date(), '%d de %B de %Y')`"
output:
  html_document:
    pandoc_args: ["+RTS", "-K1024m", "-RTS"] 
    theme: darkly
    toc: false         
    toc_float: false 
---



<div id="custom-toc"></div>


```{=html}
<style type="text/css">

/* ========== PALETA DE COLORES CLARA - EST√âTICA PROFESIONAL Y DIN√ÅMICA ========== */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@500;600;700&display=swap');

html, body {
  font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
h1, h2, h3 {
  font-family: 'Poppins', 'Inter', sans-serif !important;
  letter-spacing: -0.02em;
}
:root {
  /* Colores Base */
  --bg-light: #ffffff;
  --bg-lighter: #f5f7fa;
  --text-dark: #1f2937;
  --text-medium: #4b5563;
  --text-gray: #94a3b8;

  /* Acentos QQQ: Cian/Verde */
  --accent-primary: #00b894;
  --accent-secondary: #06b6d4;
  --accent-positive: #84cc16;
  --accent-negative: #e17055;
  --accent-soft: #3b82f6;
}

/* ========== RESET & ESTRUCTURA CLAVE ========== */
* {
  box-sizing: border-box !important;
  margin: 0;
  padding: 0;
}

html, body {
  background: var(--bg-light) !important;
  color: var(--text-dark) !important;
  font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
  line-height: 1.65 !important;
  overflow-x: hidden !important;
  min-height: 100vh !important;
}

/* Contenedor de contenido central */
div.container-fluid:first-of-type {
  width: auto !important;
  max-width: 100% !important;
  padding: 60px 80px !important;
}

/* ========== TOC PERSONALIZADO "CONTENIDO" ========== */
/* ========== TOC PERSONALIZADO "CONTENIDO" ========== */
#custom-toc {
  position: fixed;
  top: 60px;
  left: 0;
  width: 260px;
  height: 80vh;
  /* CAMBIOS IMPORTANTES AQU√ç: */
  display: flex;              /* Usar flexbox para organizar hijos */
  flex-direction: column;     /* Uno debajo del otro */
  overflow: hidden;           /* El contenedor NO scrollea, solo sus hijos */
  /* Fin de cambios */
  padding: 0;                 /* Quitamos padding general para manejarlo dentro */
  background: var(--bg-lighter);
  border-right: 2px solid var(--accent-secondary);
  border-radius: 0 10px 10px 0;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  z-index: 999;
}

/* T√≠tulo del TOC */
#custom-toc h2 {
  position: relative;
  flex-shrink: 0;
  background: var(--bg-lighter);
  z-index: 10;
  /* CAMBIO AQU√ç: Reduje el padding superior de 20px a 10px */
  padding: 10px 15px 15px 15px; 
  margin: 0;
  border-bottom: 2px solid rgba(0, 184, 148, 0.3);
  box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); /* Sombra sutil para separar */
}

/* dar espacio despu√©s del t√≠tulo */
/* Lista de enlaces (Aqu√≠ ocurre el scroll) */
#custom-toc ul {
  list-style: none !important;
  /* CAMBIO AQU√ç: El primer valor (arriba) ahora es 0px */
  padding: 0px 10px 20px 10px !important; 
  margin: 0 !important;
  flex-grow: 1;               
  overflow-y: auto;           
  
  scrollbar-width: thin;
  scrollbar-color: var(--accent-secondary) transparent;
}

/* CAMBIO EXTRA: Asegura que el primer √≠tem suba al m√°ximo */
#custom-toc li:first-child {
  margin-top: 2px !important; /* Muy pegado arriba */
}

#custom-toc li {
  margin: 8px 0 !important;
}

/* Estilo de enlaces del TOC */
#custom-toc a {
  display: block;
  padding: 10px 14px;
  color: var(--text-medium) !important;
  text-decoration: none;
  border-radius: 8px;
  transition: all .2s ease;
}

#custom-toc a:hover {
  background: rgba(0,184,148,0.15);
  color: var(--accent-primary) !important;
  transform: translateX(5px);
  box-shadow: 0 4px 14px rgba(0,0,0,0.12);
}

/* Enlace activo */
#custom-toc a.active {
  background: var(--bg-light);
  color: var(--accent-primary) !important;
  border-left: 5px solid var(--accent-secondary);
  font-weight: 600;
  transform: translateX(4px);
}

/* Scrollbar est√©tico */
#custom-toc::-webkit-scrollbar {
  width: 6px !important;
}

#custom-toc::-webkit-scrollbar-thumb {
  background: var(--accent-secondary) !important;
  border-radius: 10px !important;
}

/* Ocultar el TOC nativo de R Markdown */
#TOC {
  display: none !important;
}


/* ========== SECCIONES Y TIPOGRAF√çA ========== */
.section.level1 {
  margin-bottom: 80px !important;
  padding: 50px !important;
  background: var(--bg-light) !important;
  border: 1px solid rgba(0, 0, 0, 0.05) !important;
  border-top: 6px solid var(--accent-primary) !important;
  border-radius: 12px !important;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1) !important;
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) !important;
}

.section.level1:hover {
  border-top-color: var(--accent-secondary) !important;
  box-shadow: 0 18px 55px rgba(0, 0, 0, 0.15) !important;
  transform: translateY(-3px) !important;
}

/* T√çTULOS */
/* ---- Header / t√≠tulo principal m√°s elegante ---- */
.page-title {
  display: block;
  margin: 8px 0 18px 0;
}
h1 {
  font-size: 3.2rem !important;
  line-height: 1.05 !important;
  color: var(--text-dark) !important;
  font-weight: 700 !important;
  margin-bottom: 8px !important;
}
.subtitle {
  display: block;
  color: var(--accent-secondary);
  font-size: 1.05rem;
  font-weight: 500;
  margin-bottom: 14px;
  padding-left: 8px;
  border-left: 4px solid rgba(6,182,212,0.12);
}

h2 {
  font-size: 2.2em !important;
  color: var(--accent-primary) !important;
  margin-top: 50px !important;
  border-left: 8px solid var(--accent-secondary) !important;
  padding-left: 20px !important;
  transition: all 0.3s ease !important;
  font-weight: 600 !important;
}

h2:hover {
  padding-left: 25px !important;
  color: var(--accent-secondary) !important;
}

h3 {
  font-size: 1.6em !important;
  color: var(--accent-secondary) !important;
  border-left: 5px solid var(--accent-positive) !important;
  padding-left: 15px !important;
  margin-top: 30px !important;
  font-weight: 500 !important;
}

/* P√ÅRRAFOS */
p {
  color: var(--text-dark) !important;
  font-size: 1.05em !important;
  line-height: 1.8 !important;
}

/* ========== TABLAS ========== */
table {
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1) !important;
  border: 1px solid rgba(0, 0, 0, 0.05) !important;
  background: var(--bg-light) !important;
  border-radius: 10px !important;
  overflow: hidden !important;
  margin: 25px 0 !important;
}

thead {
  background: var(--accent-primary) !important;
}

th {
  color: var(--bg-light) !important;
  font-weight: 700 !important;
  padding: 15px 20px !important;
}

td {
  border-bottom: 1px solid var(--bg-lighter) !important;
  color: var(--text-dark) !important;
  padding: 12px 20px !important;
}

tbody tr:nth-child(even) {
  background-color: var(--bg-lighter) !important;
}

tbody tr:hover {
  background-color: rgba(6, 182, 212, 0.1) !important;
  transition: background-color 0.2s ease !important;
}

.section.level1 {
  background: linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(250,251,252,1) 100%);
  border-top: 6px solid var(--accent-primary);
  padding: 36px !important;
  transition: transform .28s cubic-bezier(.2,.9,.2,1), box-shadow .28s;
}
.section.level1:hover {
  transform: translateY(-6px);
  box-shadow: 0 28px 60px rgba(16,24,40,0.08);
}

/* ========== C√ìDIGO ========== */
pre {
  background: var(--bg-lighter) !important;
  border-left: 6px solid var(--accent-secondary) !important;
  box-shadow: 0 6px 25px rgba(0, 0, 0, 0.08) !important;
  border: 1px solid rgba(6, 182, 212, 0.2) !important;
  border-radius: 10px !important;
  padding: 25px !important;
}

/* ========== FOOTER ========== */
div[style*="margin-top: 80px;"] {
  background: var(--bg-lighter) !important;
  border: 1px solid rgba(0, 0, 0, 0.05) !important;
  border-top: 6px solid var(--accent-primary) !important;
  color: var(--text-dark) !important;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1) !important;
}
/* ======= DESPLAZAR EL CONTENIDO PARA QUE NO CHOQUE CON EL TOC ======= */
body .container-fluid,
body .main-container,
body div.container-fluid:first-of-type {
  margin-left: 280px !important;   /* un poco m√°s que el ancho del TOC */
  max-width: calc(100% - 300px) !important;
}


/* RESPONSIVE DESIGN */
@media (max-width: 768px) {
  #custom-toc {
    position: relative !important;
    width: 100% !important;
    height: auto !important;
    max-height: 300px !important;
    margin-bottom: 30px !important;
  }
  
  div.container-fluid:first-of-type {
    padding: 20px !important;
  }
}
/* ===================== BOT√ìN FLOTANTE UNIVERSIDAD ===================== */
#uv-button {
  position: fixed;
  bottom: 25px;
  right: 25px;   /* c√°mbialo a left:25px si lo quieres a la izquierda */
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: white;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 9999;
  transition: transform 0.3s ease;
  overflow: hidden;
}

#uv-button:hover {
  transform: scale(1.1);
}

/* Imagen interna */
#uv-button img {
  width: 80%;
  height: 80%;
  object-fit: contain;
  transition: opacity .4s ease;
}

/* Animaci√≥n de rotaci√≥n */
@keyframes spin-logo {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#uv-button.spin {
  animation: spin-logo 1.2s linear;
}
#uv-button img {
  width: 80%;
  height: 80%;
  object-fit: contain;
  display: block;
  margin: auto;        
  position: absolute;  
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
/* ===== TOOLTIP PERSONALIZADO PARA EL BOT√ìN ===== */
/* ===== TOOLTIP HACIA LA IZQUIERDA ===== */
#uv-button::after {
  content: attr(data-tooltip);
  position: absolute;
  left: -10px;                /* empieza pegado al borde izquierdo */
  top: 50%;                   /* centrado verticalmente */
  transform: translate(-100%, -50%);  /* lo desplaza completamente a la izquierda */
  
  background: rgba(0,0,0,0.85);
  color: white;
  padding: 8px 12px;
  font-size: 0.85em;
  border-radius: 6px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
}

#uv-button:hover::after {
  opacity: 1;
}

#uv-button {
  position: fixed !important;
  z-index: 999999 !important;
  pointer-events: auto !important;
}
#custom-toc, #right-toc {
  z-index: 5000 !important;
}
#uv-button {
  overflow: visible !important;
}

/* ========== NUEVO: ESTILO PARA EL BOT√ìN INDIVIDUAL DE CADA CHUNK ========== */
.chunk-code-toggle {
  background-color: transparent;
  color: var(--accent-primary); /* Color verde/cian */
  border: 1px solid var(--accent-primary);
  padding: 4px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'Inter', sans-serif;
  font-size: 0.85rem;
  font-weight: 600;
  margin-bottom: 5px; /* Espacio entre bot√≥n y c√≥digo */
  margin-top: 15px;   /* Espacio respecto al elemento anterior */
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.chunk-code-toggle:hover {
  background-color: var(--accent-primary);
  color: white;
  box-shadow: 0 4px 10px rgba(0, 184, 148, 0.2);
}

.chunk-code-toggle.active {
  background-color: var(--bg-lighter);
  color: var(--text-gray);
  border-color: var(--text-gray);
}

/* Ajuste para que el bloque de c√≥digo (pre) aparezca pegado al bot√≥n */
pre {
  margin-top: 0 !important;
  transition: all 0.3s ease;
}
/* ========== CENTRADO UNIVERSAL DE GR√ÅFICOS E IM√ÅGENES ========== */

/* 1. Centra im√°genes est√°ticas (tanto Markdown como HTML <img>) */
img {
display: block;
 margin-left: auto;
 margin-right: auto;
}

/* 2. Centra contenedores de figuras generados por R (gr√°ficos est√°ticos) */
.r-figure {
 display: block;
 margin-left: auto;
 margin-right: auto;
 max-width: 900px; /* O el ancho m√°ximo que desees */
}

/* 3. Centra conteedores de plotly (incluye ggplotly) */
.html-widget.plotly {
 display: block;
 margin: 0 auto !important;
 max-width: 900px; /* O el ancho m√°ximo que desees */
}
/* 4. Centra tblas (kable / kableExtra) igual que plotly */
table, .table, table.kable_wrapper {
    margin-left: auto !important;
    margin-right: auto !important;
    max-width: 900px; /* Mismo ancho m√°ximo que tus gr√°ficos */
    width: auto !important; /* Evita que la tabla se estire al 100% si es peque√±a */
    border-collapse: collapse; /* Opcional: para que se vea limpia */
}
</style>
```
<div id="uv-button" data-tooltip="Escuela de Ingenier√≠a Industrial - Cali">
  <img id="uv-img" src="univalle.png" alt="Univalle">
</div>

```{=html}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const SCROLL_OFFSET = 100; // Ajusta este valor si el t√≠tulo queda tapado (100px es bueno)
  
  // 1. REFERENCIA AL CONTENEDOR DEL TOC
  const toc = document.getElementById("custom-toc");
  if (!toc) return; // Si no existe el div, no hace nada

  // 2. CREAR T√çTULO Y LISTA
  const title = document.createElement("h2");
  title.textContent = "Contenido";
  toc.appendChild(title);
  
  const list = document.createElement("ul");
  toc.appendChild(list);

  // 3. GENERAR ENLACES BASADOS EN H1 y H2
  const headers = document.querySelectorAll("h2");
  
  headers.forEach(header => {
    // Si el header no tiene ID, creamos uno limpio
    if (!header.id) {
      header.id = header.textContent
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, "-") // Reemplaza caracteres raros por guiones
        .replace(/^-+|-+$/g, '');    // Quita guiones al inicio o final
    }

    // Crear el elemento de lista
    const li = document.createElement("li");
    const a = document.createElement("a");
    
    a.href = `#${header.id}`; // Enlace interno al ID
    a.textContent = header.textContent; // Texto del enlace
    
    // === AQU√ç EST√Å LA MAGIA DEL CLIC ===
    a.addEventListener('click', function(e) {
      e.preventDefault(); // Evita el salto brusco predeterminado
      
      const targetId = this.getAttribute('href').substring(1); // Quita el #
      const targetElement = document.getElementById(targetId);
      
      if (targetElement) {
        // Scroll suave manual
        window.scrollTo({
          top: targetElement.offsetTop - SCROLL_OFFSET, 
          behavior: 'smooth'
        });
        
        // Actualizar URL sin saltar (opcional)
        history.pushState(null, null, `#${targetId}`);
      }
    });

    li.appendChild(a);
    list.appendChild(li);
  });

  // 4. RESALTAR ENLACE ACTIVO AL HACER SCROLL
  function updateActiveTOCLink() {
    const tocLinks = document.querySelectorAll('#custom-toc a');
    let currentActiveId = '';
    
    headers.forEach(section => {
      const rect = section.getBoundingClientRect();
      // Si la secci√≥n est√° cerca de la parte superior (con el offset)
      if (rect.top <= SCROLL_OFFSET + 20) { 
        currentActiveId = section.id;
      }
    });
    
    tocLinks.forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('href') === `#${currentActiveId}`) {
        link.classList.add('active');
      }
    });
  }

  // 5. EVENTOS GLOBALES
  window.addEventListener('scroll', updateActiveTOCLink);
  // Ejecutar una vez al inicio para marcar el primero
  updateActiveTOCLink(); 

  // --- EXTRAS (FECHA, BOT√ìN, ETC) ---
  
  // Fecha
  const fechaSpan = document.getElementById('fecha-entrega');
  if(fechaSpan) {
    fechaSpan.textContent = new Date().toLocaleDateString('es-ES', {
      year: 'numeric', month: 'long', day: 'numeric'
    });
  }

  // Bot√≥n C√≥digo
  const btnToggle = document.createElement('button');
  btnToggle.id = 'global-code-toggle';
  btnToggle.textContent = 'üíª C√≥digo Oculto';
  document.body.appendChild(btnToggle);
  let codeVisible = true;
  btnToggle.addEventListener('click', function() {
    const codes = document.querySelectorAll('pre');
    codeVisible = !codeVisible;
    codes.forEach(code => {
      code.style.display = codeVisible ? 'block' : 'none';
    });
    btnToggle.textContent = codeVisible ? 'üíª C√≥digo Oculto' : 'üëÅÔ∏è Mostrar C√≥digo';
  });

  // Animaci√≥n Logo Univalle
  const logos = ["univalle.png", "ingenieria.png"];  
  let index = 0;
  const img = document.getElementById("uv-img");
  const btn = document.getElementById("uv-button");
  if (btn && img) {
    setInterval(() => {
      btn.classList.add("spin");
      setTimeout(() => {
        index = (index + 1) % logos.length;
        img.style.opacity = 0;
        setTimeout(() => {
          img.src = logos[index];
          img.style.opacity = 1;
        }, 200);
      }, 600);
      setTimeout(() => btn.classList.remove("spin"), 1200);
    }, 3500);
  }
});
document.addEventListener('DOMContentLoaded', function() {
  const SCROLL_OFFSET = 100;

 
  // --- 2. NUEVA L√ìGICA: BOTONES INDIVIDUALES PARA CADA C√ìDIGO ---
  
  // Seleccionamos todos los bloques de c√≥digo generados por R
  // R Markdown suele ponerlos en 'pre.r' o dentro de div.sourceCode
  const codeBlocks = document.querySelectorAll('pre.r, pre.sourceCode, .sourceCode pre');

  codeBlocks.forEach(block => {
    // 1. Ocultar el c√≥digo por defecto
    block.style.display = 'none';

    // 2. Crear el bot√≥n
    const btn = document.createElement('button');
    btn.className = 'chunk-code-toggle';
    btn.innerHTML = '<span>&#9654;</span> Ver C√≥digo'; // Icono de play
    
    // 3. Insertar el bot√≥n ANTES del bloque de c√≥digo
    // Buscamos el padre para insertar antes del <pre>
    block.parentNode.insertBefore(btn, block);

    // 4. Agregar evento click
    btn.addEventListener('click', function() {
      if (block.style.display === 'none') {
        // Mostrar
        block.style.display = 'block';
        btn.innerHTML = '<span>&#9660;</span> Ocultar C√≥digo';
        btn.classList.add('active');
      } else {
        // Ocultar
        block.style.display = 'none';
        btn.innerHTML = '<span>&#9654;</span> Ver C√≥digo';
        btn.classList.remove('active');
      }
    });
  });

  // --- 3. EXTRAS (FECHA, LOGOS) ---
  const fechaSpan = document.getElementById('fecha-entrega');
  if(fechaSpan) {
    fechaSpan.textContent = new Date().toLocaleDateString('es-ES', {
      year: 'numeric', month: 'long', day: 'numeric'
    });
  }

  // Elimin√© el bot√≥n global anterior para que no tengas conflicto, 
  // ya que ahora tienes botones individuales.

  // Animaci√≥n Logo Univalle
  const logos = ["univalle.png", "ingenieria.png"];  
  let index = 0;
  const img = document.getElementById("uv-img");
  const btn = document.getElementById("uv-button");
  if (btn && img) {
    setInterval(() => {
      btn.classList.add("spin");
      setTimeout(() => {
        index = (index + 1) % logos.length;
        img.style.opacity = 0;
        setTimeout(() => {
          img.src = logos[index];
          img.style.opacity = 1;
        }, 200);
      }, 600);
      setTimeout(() => btn.classList.remove("spin"), 1200);
    }, 3500);
  }
});
</script>

```
```{r setup-theme, include=FALSE}

library(tidyverse)
library(quantmod)
library(xts)
library(fpp2)
library(tseries)
library(scales)
library(knitr)
library(kableExtra)
library(gridExtra)
library(grid)
library(forecast)
library(ggplot2)
library(zoo)
library(plotly)
library(tidyquant)
library(ggplot2)
library(dplyr)
library(lubridate)
library(scales)

knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.align = 'center',
  fig.width = 12,
  fig.height = 6
)

qqq_pal <- list(
  bg        = "#ffffff",
  text_dark = "#1f2937",
  text_gray = "#4b5563",
  primary   = "#00b894",
  secondary = "#06b6d4",
  positive  = "#84cc16",
  negative  = "#e17055",
  grid      = "#f3f4f6"
)

theme_QQQ <- function() {
  theme_minimal(base_size = 14) +
    theme(
      plot.background = element_rect(fill = "transparent", color = NA),
      panel.background = element_rect(fill = "transparent", color = NA),
      text = element_text(color = qqq_pal$text_dark, family = "sans"),
      plot.title = element_text(face = "bold", size = 16, color = qqq_pal$text_dark, margin = margin(b = 10)),
      plot.subtitle = element_text(size = 12, color = qqq_pal$secondary, margin = margin(b = 10)),
      plot.caption = element_text(size = 9, color = qqq_pal$text_gray, margin = margin(t = 10)),
      axis.title = element_text(face = "bold", size = 11, color = qqq_pal$text_gray),
      axis.text = element_text(size = 10, color = qqq_pal$text_gray),
      axis.line.x = element_line(color = qqq_pal$secondary, size = 0.5),
      panel.grid.major = element_line(color = qqq_pal$grid, linetype = "dashed"),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      legend.background = element_rect(fill = "transparent", color = NA),
      legend.key = element_rect(fill = "transparent", color = NA)
    )
}

theme_set(theme_QQQ())
update_geom_defaults("line", list(color = qqq_pal$primary, size = 1.1))
update_geom_defaults("point", list(color = qqq_pal$secondary, size = 2))
update_geom_defaults("col", list(fill = qqq_pal$primary, color = NA))

tesla_pal <- list(
  bg        = "#ffffff",    
  text_main = "#1f2937",    
  text_gray = "#4b5563",    
  primary   = "#00b894",    
  secondary = "#06b6d4",    
  positive  = "#84cc16",   
  negative  = "#e17055",    
  grid      = "#f3f4f6"     
)

theme_tesla <- function() {
  theme_minimal(base_size = 14) +
    theme(
      plot.background = element_rect(fill = "transparent", color = NA),
      panel.background = element_rect(fill = "transparent", color = NA),
      text = element_text(color = tesla_pal$text_main, family = "sans"),
      plot.title = element_text(face = "bold", size = 16, color = tesla_pal$text_main, margin = margin(b = 10)),
      plot.subtitle = element_text(size = 12, color = tesla_pal$secondary, margin = margin(b = 10)),
      plot.caption = element_text(size = 9, color = tesla_pal$text_gray, margin = margin(t = 10)),
      axis.title = element_text(face = "bold", size = 11, color = tesla_pal$text_gray),
      axis.text = element_text(size = 10, color = tesla_pal$text_gray),
      axis.line.x = element_line(color = tesla_pal$secondary, size = 0.5), 
      panel.grid.major = element_line(color = tesla_pal$grid, linetype = "dashed"),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      legend.background = element_rect(fill = "transparent", color = NA),
      legend.key = element_rect(fill = "transparent", color = NA)
    )
}


```

---

# 1. Introducci√≥n

La capacidad de anticipar el comportamiento futuro de los precios en los mercados financieros constituye uno de los elementos centrales para la toma de decisiones de inversi√≥n estrat√©gicas y la gesti√≥n eficiente de portafolios. En el contexto de los mercados burs√°tiles globales, donde la incertidumbre es inherente y los patrones de precios reflejan complejas din√°micas de oferta y demanda, el desarrollo de modelos predictivos robustos cobra particular relevancia para inversionistas, analistas financieros y gestores de cartera.

El Invesco $QQQ Trust$ (QQQ) es uno de los fondos cotizados en bolsa (ETF) m√°s negociados a nivel mundial, con activos bajo gesti√≥n superiores a los 400 mil millones de d√≥lares. Este instrumento replica el √≠ndice $Nasdaq-100$, compuesto por las 100 empresas no financieras de mayor capitalizaci√≥n burs√°til listadas en el mercado Nasdaq, con una fuerte concentraci√≥n en el sector tecnol√≥gico que incluye l√≠deres como $Apple$, $Microsoft$, $NVIDIA$, $Amazon$ y $Alphabet$. Entre 2009 y 2019, el $QQQ$ se benefici√≥ significativamente de las econom√≠as de escala en software, el auge de los smartphones y el desarrollo de ecosistemas tecnol√≥gicos integrados. Esta composici√≥n convierte al $QQQ$ en un referente para analizar el comportamiento del sector tecnol√≥gico estadounidense y, por extensi√≥n, las tendencias de innovaci√≥n que impulsan la econom√≠a global.

La importancia de modelar series de precios como la del QQQ radica en m√∫ltiples factores. En primer lugar, los pron√≥sticos financieros juegan un papel fundamental en la formaci√≥n de expectativas de mercado e influyen directamente en las decisiones de inversi√≥n, la asignaci√≥n de activos y la evaluaci√≥n de riesgos. En segundo lugar, el an√°lisis cuantitativo de series temporales permite identificar patrones y comportamientos que proporcionan informaci√≥n valiosa para dise√±ar estrategias de inversi√≥n m√°s fundamentadas. La predicci√≥n espec√≠fica del $QQQ$ es particularmente importante porque replica el √≠ndice $Nasdaq-100$, concentrado en empresas tecnol√≥gicas l√≠deres en desarrollo de inteligencia artificial, computaci√≥n en la nube y ecosistemas digitales innovadores. Dado que el sector tecnol√≥gico representa uno de los mercados emergentes y con mayor potencial de crecimiento en la econom√≠a global, predecir el comportamiento del $QQQ$ permite anticipar tendencias en innovaci√≥n, evaluar correctamente la valuaci√≥n de activos tecnol√≥gicos y gestionar la exposici√≥n al riesgo en un sector de alta volatilidad que impulsa transformaciones estructurales en la econom√≠a mundial.

En este contexto, los modelos $ARIMA$ (AutoRegressive Integrated Moving Average) se han consolidado como uno de los enfoques m√°s utilizados para el pron√≥stico de series de tiempo, junto con los modelos de suavizado exponencial. Mientras que los modelos de suavizado exponencial se basan en una descripci√≥n de la tendencia y la estacionalidad en los datos, los modelos $ARIMA$ tienen como objetivo describir las autocorrelaciones presentes en la serie. Estos modelos integran tres componentes fundamentales: el componente autorregresivo (AR), que pronostica la variable de inter√©s utilizando una combinaci√≥n lineal de sus valores pasados; el componente de integraci√≥n (I), que transforma series no estacionarias en estacionarias mediante la aplicaci√≥n de diferencias sucesivas; y el componente de media m√≥vil (MA), que utiliza errores de pron√≥stico pasados en un modelo similar a la regresi√≥n.

Un aspecto fundamental previo al ajuste de modelos $ARIMA$ es la verificaci√≥n de la estacionariedad de la serie temporal. Una serie estacionaria es aquella cuyas propiedades no dependen del momento en que se observa; es decir, presenta media aproximadamente horizontal, varianza constante y no muestra patrones predecibles a largo plazo. Las series temporales con tendencias o estacionalidad no son estacionarias. Para identificar series no estacionarias, se emplean tanto herramientas gr√°ficas (la funci√≥n de autocorrelaci√≥n ACF de datos no estacionarios decrece lentamente) como pruebas estad√≠sticas formales, entre las que destaca el Test Aumentado de Dickey-Fuller, cuya hip√≥tesis nula establece que los datos son no estacionarios.

El presente estudio emplea datos hist√≥ricos del ETF $QQQ$ obtenidos de Yahoo Finance, abarcando el per√≠odo comprendido entre el 7 de octubre de 2022 y el 2 de diciembre de 2025, con un total de 791 observaciones diarias de precios de cierre. Durante este per√≠odo, el precio del $QQQ$ fluctu√≥ entre un m√≠nimo de \$260.10 y un m√°ximo de \$635.77, con un precio promedio de \$435.84 y una desviaci√≥n est√°ndar de \$97.95. El rendimiento acumulado del per√≠odo alcanz√≥ un notable 131.14%, reflejando la fuerte recuperaci√≥n del sector tecnol√≥gico tras el mercado bajista de 2022 y el impulso generado por desarrollos en inteligencia artificial. La volatilidad anualizada de la serie se ubic√≥ en aproximadamente 21.12%, caracter√≠stica de instrumentos con alta exposici√≥n al sector tecnol√≥gico.

El an√°lisis incluye la verificaci√≥n de supuestos estad√≠sticos fundamentales: evaluaci√≥n de estacionariedad mediante la prueba de $Dickey-Fuller$ Aumentada y an√°lisis gr√°fico de las funciones de autocorrelaci√≥n (ACF) y autocorrelaci√≥n parcial (PACF), la selecci√≥n del modelo √≥ptimo utilizando criterios de informaci√≥n (AICc), y la validaci√≥n diagn√≥stica de residuos para confirmar que se comporten como ruido blanco. Se comparan m√∫ltiples especificaciones $ARIMA$, incluyendo el modelo seleccionado autom√°ticamente mediante la funci√≥n `auto.arima` y configuraciones alternativas sugeridas por el an√°lisis de los gr√°ficos $ACF$ y $PACF$, reconociendo que aunque la automatizaci√≥n es √∫til, "cualquier cosa automatizada puede ser un poco peligrosa, y vale la pena entender algo sobre el comportamiento de los modelos".

---

# 2. Metodolog√≠a

La metodolog√≠a adoptada sigue el procedimiento est√°ndar de modelamiento de series temporales propuesto en la literatura Box-Jenkins: se particiona el conjunto de datos en un conjunto de entrenamiento destinado a la estimaci√≥n de par√°metros y validaci√≥n de modelos candidatos, y un conjunto de prueba para evaluar la capacidad predictiva fuera de muestra. Este dise√±o respeta la naturaleza secuencial de datos financieros, evitando la fuga de informaci√≥n que comprometer√≠a la validez de los pron√≥sticos.

---

## 2.1 Base de Datos

La base de datos utilizada proviene de Yahoo Finance, plataforma reconocida globalmente para obtenci√≥n de datos financieros hist√≥ricos de alta calidad y frecuencia diaria. Se extrajo informaci√≥n del ETF Invesco QQQ Trust (s√≠mbolo: QQQ), el cual replica el √≠ndice Nasdaq-100 compuesto por las 100 empresas no financieras de mayor capitalizaci√≥n burs√°til listadas en el mercado Nasdaq, con fuerte concentraci√≥n en sector tecnol√≥gico (Apple, Microsoft, NVIDIA, Amazon, Alphabet, Tesla, Meta).

La extracci√≥n se realiz√≥ mediante la funci√≥n `getSymbols()` del paquete `quantmod` de R, automatizando la descarga directa desde fuente oficial. El per√≠odo de estudio abarca desde 7 de octubre de 2022 hasta 2 de diciembre de 2025, capturando 791 observaciones diarias de precios de cierre. Este per√≠odo es particularmente informativo: incluye recuperaci√≥n post-crisis 2022, impulso del rally de inteligencia artificial (2023-2025), cambios en pol√≠tica monetaria de la Reserva Federal, y volatilidad estructural del sector tecnol√≥gico.

```{r cargar-datos, echo=TRUE}

serie_QQQ <- getSymbols("QQQ", src="yahoo", auto.assign=FALSE, from="2010-01-01") 
Precio <- serie_QQQ$`QQQ.Close`

```

---

## 2.2 Variable de An√°lisis

El dataset se centra en una √∫nica variable cuantitativa de inter√©s: **precio de cierre diario del ETF QQQ**. Esta variable representa el √∫ltimo precio de negociaci√≥n durante cada sesi√≥n burs√°til y es la medida est√°ndar en an√°lisis t√©cnico y modelizaci√≥n de series financieras.

La elecci√≥n del precio de cierre se fundamenta en que: (i) refleja el consenso del mercado al finalizar cada sesi√≥n, incorporando informaci√≥n completa del d√≠a; (ii) es el referente para c√°lculo de rendimientos y valoraci√≥n de portafolios; (iii) es utilizado en la mayor√≠a de indicadores t√©cnicos y modelos predictivos; (iv) su disponibilidad es consistente sin interrupciones en d√≠as h√°biles.

---

## 2.3 Partici√≥n Temporal de Datos

En an√°lisis de series temporales, la partici√≥n de datos debe respetar el orden cronol√≥gico, diferenci√°ndose fundamentalmente de validaci√≥n cruzada aleatoria. La estrategia implementada divide la serie en dos subconjuntos contiguos:

- **Conjunto de Entrenamiento:** Comprende la mayor√≠a de observaciones hist√≥ricas (aproximadamente 95% de datos), utilizado para identificar par√°metros √≥ptimos del modelo ARIMA, estimar coeficientes y evaluar criterios de informaci√≥n.

- **Conjunto de Prueba:** Representa per√≠odo posterior no utilizado durante ajuste (aproximadamente 5% de datos), destinado a evaluar capacidad predictiva en escenario realista de pron√≥stico.

Esta metodolog√≠a es esencial porque: (i) evita "fuga de informaci√≥n" (data leakage) donde datos futuros influir√≠an en predicci√≥n del pasado; (ii) mantiene estructura cronol√≥gica respetando dependencias temporales inherentes a series financieras; (iii) simula condiciones reales donde pron√≥sticos se generan sin conocimiento de valores posteriores; (iv) proporciona m√©tricas objetivas de desempe√±o ex-post que validan capacidad predictiva genuina.

---

## 2.4 Marco Conceptual: Modelos ARIMA(p,d,q)

Los modelos ARIMA (AutoRegressive Integrated Moving Average), desarrollados por Box y Jenkins en 1970, constituyen metodolog√≠a sistem√°tica y robusta para an√°lisis y pron√≥stico de series temporales. Se fundamentan en la idea de que el valor actual de una serie puede explicarse mediante: (i) sus valores hist√≥ricos (componente autorregresivo), (ii) transformaciones que alcancen estacionariedad (componente integrador), o (iii) errores de pron√≥stico pasados (componente de media m√≥vil).

A diferencia de modelos de regresi√≥n que requieren variables explicativas externas, los modelos ARIMA son **univariados**, extrayendo toda informaci√≥n predictiva de la propia historia de la serie. Esta caracter√≠stica los hace especialmente valiosos en contextos financieros donde no se dispone de predictores externos confiables, o donde el objetivo es capturar din√°micas intr√≠nsecas de evoluci√≥n temporal.

### 2.4.1 Componente Autorregresivo AR(p)

El modelo AR(p) pronostica la variable utilizando combinaci√≥n lineal de sus valores pasados:

$$y_t = c + \phi_1 y_{t-1} + \phi_2 y_{t-2} + \cdots + \phi_p y_{t-p} + \varepsilon_t$$

donde:
- $y_t$ es el valor de la serie en tiempo $t$
- $c$ es constante (intercepto o drift)
- $\phi_1, \phi_2, \ldots, \phi_p$ son coeficientes autorregresivos que miden influencia de cada rezago
- $\varepsilon_t$ es t√©rmino de error (ruido blanco) con $E[\varepsilon_t]=0$ y varianza $\sigma^2$ constante

El coeficiente $\phi_1$ en AR(1) indica **persistencia de la serie**: valores cercanos a 1 implican alta persistencia (shocks tienen efectos duraderos), mientras que valores cercanos a 0 indican reversi√≥n r√°pida a media. Para que modelo sea estacionario, los coeficientes deben satisfacer restricciones espec√≠ficas (ra√≠ces del polinomio caracter√≠stico fuera del c√≠rculo unitario).

La interpretaci√≥n econ√≥mica es que si una serie ha estado elevada en per√≠odo anterior, tiende a permanecer elevada actualmente, capturando inercia o persistencia en comportamiento de variable.

### 2.4.2 Componente de Media M√≥vil MA(q)

El modelo MA(q) utiliza errores de pron√≥stico pasados en lugar de valores hist√≥ricos de variable:

$$y_t = c + \varepsilon_t + \theta_1 \varepsilon_{t-1} + \theta_2 \varepsilon_{t-2} + \cdots + \theta_q \varepsilon_{t-q}$$

donde $\theta_1, \ldots, \theta_q$ son coeficientes de media m√≥vil.

La interpretaci√≥n econ√≥mica es que shocks o sorpresas en serie tienen efectos **transitorios** que se disipan gradualmente. Esto captura comportamientos donde precios regresan a nivel promedio tras perturbaci√≥n, en lugar de permanecer desplazados permanentemente. En contextos financieros, MA modela la reversi√≥n a media que caracteriza a mercados relativamente eficientes en corto plazo.

### 2.4.3 Componente de Integraci√≥n I(d)

Muchas series econ√≥micas y financieras **no son estacionarias** en forma original, presentando tendencias, medias cambiantes, o varianzas no constantes. Una serie estacionaria tiene propiedades estad√≠sticas (media, varianza, autocovarianzas) invariantes en tiempo; una serie no-estacionaria exhibe comportamientos dependientes del momento observado.

El componente de integraci√≥n aborda esto mediante **diferenciaci√≥n**, transformaci√≥n que calcula cambios entre observaciones consecutivas:

$$y'_t = y_t - y_{t-1} = \Delta y_t$$

Esta operaci√≥n (primera diferencia) elimina tendencias lineales y estabiliza media. Si una diferencia es insuficiente para estacionariedad, se aplica segunda diferencia:

$$y''_t = y'_t - y'_{t-1} = \Delta^2 y_t$$

El par√°metro $d$ indica n√∫mero de diferencias necesarias para que serie se vuelva estacionaria. Una serie que requiere $d$ diferencias se denomina "integrada de orden $d$", denotada I(d). En pr√°ctica, rara vez se requieren m√°s de dos diferencias; para series financieras como precios de activos, t√≠picamente $d=1$ es suficiente.

### 2.4.4 Formulaci√≥n Compacta con Operador de Rezago

Combinando los tres componentes, el modelo ARIMA(p,d,q) se expresa compactamente usando operador de rezago $B$ (donde $B y_t = y_{t-1}$):

$$\Phi(B)(1-B)^d y_t = c + \Theta(B) \varepsilon_t$$

donde:
- $\Phi(B) = 1 - \phi_1 B - \phi_2 B^2 - \cdots - \phi_p B^p$ es polinomio autorregresivo
- $(1-B)^d$ es operador de diferenciaci√≥n aplicado $d$ veces
- $\Theta(B) = 1 + \theta_1 B + \theta_2 B^2 + \cdots + \theta_q B^q$ es polinomio de media m√≥vil

Esta representaci√≥n facilita an√°lisis te√≥rico y derivaci√≥n de propiedades estad√≠sticas. Su elegancia radica en capturar din√°micas complejas mediante combinaci√≥n sistem√°tica de componentes que act√∫an en niveles distintos: AR modela persistencia, MA modela efectos de shocks transitorios, I transforma serie hacia propiedades deseadas.

### 2.4.5 Supuestos Fundamentales del Modelo

Para que inferencias y pron√≥sticos derivados de ARIMA sean v√°lidos y confiables, deben cumplirse supuestos sobre naturaleza de serie y sus residuos:

1. **Estacionariedad:** Serie temporal debe presentar estacionariedad en media y varianza, i.e., propiedades estad√≠sticas permanecen aproximadamente constantes en tiempo. Esto asegura que relaciones identificadas entre observaciones son estables y predecibles, en lugar de resultado de tendencias determin√≠sticas no modeladas.

2. **Ruido Blanco en Residuos:** Los residuos del modelo ajustado deben comportarse como secuencia aleatoria e independiente sin patrones sistem√°ticos. Si residuos contienen estructura, sugiere que modelo no ha capturado completamente din√°mica temporal, requiriendo respecificaci√≥n.

3. **Homocedasticidad:** Se asume que errores tienen varianza constante a trav√©s del tiempo. Violaciones (heteroscedasticidad o volatilidad que cambia en tiempo) comprometen precisi√≥n de intervalos de confianza.

4. **Normalidad de Residuos:** Aunque no es estrictamente necesaria para estimaci√≥n del modelo, la normalidad es deseable para construcci√≥n precisa de intervalos de confianza y validez de pruebas de hip√≥tesis sobre par√°metros.

---

## 2.5 Herramientas Estad√≠sticas para Identificaci√≥n y Validaci√≥n

### 2.5.1 Prueba Aumentada de Dickey-Fuller (ADF)

La estacionariedad es requisito previo fundamental antes de modelizaci√≥n ARIMA. Una serie no-estacionaria producir√≠a inferencias enga√±osas y pron√≥sticos poco confiables.

La **Prueba Aumentada de Dickey-Fuller (ADF)** es contraste estad√≠stico est√°ndar para evaluaci√≥n formal. Contrasta:
- $H_0$: Serie tiene ra√≠z unitaria (no-estacionaria)
- $H_1$: Serie es estacionaria

El resultado de esta prueba determina el orden de integraci√≥n $d$: si serie original rechaza $H_0$ (p-valor < 0.05), se procede a diferenciar y repetir hasta lograr estacionariedad. El estad√≠stico ADF compara contra valores cr√≠ticos tabulados; si estad√≠stico de prueba es m√°s negativo que valor cr√≠tico (mayor en magnitud), se rechaza $H_0$.

### 2.5.2 Funciones de Autocorrelaci√≥n: ACF y PACF

Las funciones de autocorrelaci√≥n proporcionan **diagn√≥stico visual** fundamental para entender patrones de dependencia temporal y sugerir especificaciones ARIMA iniciales.

**Funci√≥n de Autocorrelaci√≥n (ACF):** Cuantifica correlaci√≥n lineal entre observaciones separadas por rezagos 1, 2, ..., k. Su comportamiento es diagn√≥stico:
- En series estacionarias: ACF decae gradualmente hacia cero
- En series no-estacionarias: ACF persiste en valores altos durante muchos rezagos

Para identificaci√≥n de modelo, ACF es especialmente √∫til para distinguir procesos MA(q): un corte abrupto despu√©s de rezago $q$ (i.e., autocorrelaciones significativas hasta lag $q$ luego caen a cero dentro de bandas) sugiere componente MA(q).

**Funci√≥n de Autocorrelaci√≥n Parcial (PACF):** Elimina influencia de rezagos intermedios, aislando efecto directo de cada rezago sobre presente. Es especialmente informativa para identificar procesos AR(p): un corte abrupto despu√©s de rezago $p$ sugiere componente AR(p).

El an√°lisis combinado de ACF y PACF proporciona indicios valiosos sobre especificaci√≥n inicial del modelo, aunque debe complementarse con criterios estad√≠sticos formales.

### 2.5.3 B√∫squeda Autom√°tica: Funci√≥n auto.arima()

En pr√°ctica moderna, la funci√≥n `auto.arima()` automatiza gran parte del proceso de identificaci√≥n mediante algoritmos de b√∫squeda sistem√°tica. Realiza b√∫squeda sobre rango especificado de valores para $p$, $d$ y $q$, evaluando cada combinaci√≥n mediante criterios de informaci√≥n como AICc.

Sin embargo, es importante reconocer limitaciones: un modelo automatizado puede omitir especificaciones que, aunque menos √≥ptimas seg√∫n criterios puramente estad√≠sticos, podr√≠an ser preferibles bajo consideraciones te√≥ricas o interpretativas. Por ello, resulta valioso complementar b√∫squeda autom√°tica con an√°lisis visual de ACF/PACF, permitiendo que teor√≠a econ√≥mica y conocimiento del dominio del problema informen especificaci√≥n final.

### 2.5.4 Criterios de Selecci√≥n del Modelo: AICc

Cuando m√∫ltiples especificaciones ARIMA son candidatas, es necesario criterio objetivo para elegir entre ellas. Los **criterios de informaci√≥n** cumplen este rol al balancear calidad del ajuste con complejidad del modelo.

El **AICc (Criterio de Informaci√≥n de Akaike Corregido)** es criterio m√°s utilizado en pr√°ctica para selecci√≥n de modelos ARIMA. Eval√∫a verosimilitud del modelo (qu√© tan bien se ajusta a datos) y aplica penalizaci√≥n por agregar par√°metros adicionales, reduciendo tendencia al sobreajuste. Su f√≥rmula es:

$$\text{AICc} = \text{AIC} + \frac{2(p+q+k+1)(p+q+k+2)}{T-p-q-k-2}$$

donde:
- $T$ es n√∫mero de observaciones
- $p$ y $q$ son √≥rdenes del modelo ARIMA
- $k$ es n√∫mero de par√°metros adicionales (como constante)

El t√©rmino adicional respecto al AIC cl√°sico corrige sesgo que ocurre en muestras peque√±as. **Especificaciones con menor AICc son preferibles**, indicando mejor balance entre ajuste y parsimonia.

**Aspecto cr√≠tico:** Criterios de informaci√≥n NO son aplicables para seleccionar orden de diferenciaci√≥n $d$, pues diferenciaci√≥n altera escala de datos sobre cual se computa verosimilitud, haciendo valores de AICc no comparables entre modelos con diferente $d$. Por ello, par√°metro $d$ se determina primero mediante pruebas de estacionariedad (ADF), y AICc se utiliza posteriormente para optimizar √≥rdenes $p$ y $q$.

### 2.5.5 Diagn√≥stico de Residuos: Prueba de Ljung-Box

Despu√©s de ajustar modelo ARIMA espec√≠fico, es necesario verificar que modelo haya capturado adecuadamente estructura temporal.

La **Prueba de Ljung-Box** es contraste estad√≠stico que eval√∫a si existe autocorrelaci√≥n significativa en residuos. Contrasta:
- $H_0$: Residuos son ruido blanco independiente (sin autocorrelaci√≥n)
- $H_1$: Residuos contienen autocorrelaci√≥n significativa

Si residuos conservan autocorrelaci√≥n, es se√±al de que modelo especificado no ha extra√≠do completamente informaci√≥n temporal disponible, requiriendo respecificaci√≥n con √≥rdenes m√°s altos. Un p-valor elevado (> 0.05) indica que residuos se comportan consistentemente con ruido blanco, suministrando confianza en que modelo ha cumplido su prop√≥sito de modelar adecuadamente din√°mica temporal de serie.

---

## 2.6 Procedimiento Metodol√≥gico: Metodolog√≠a Box-Jenkins

La metodolog√≠a Box-Jenkins propone proceso iterativo sistem√°tico para modelizaci√≥n ARIMA. El procedimiento implementado en este an√°lisis sigue estos pasos secuenciales:

### Paso 1: Determinaci√≥n del Orden de Integraci√≥n (d)

Se eval√∫a estacionariedad de serie mediante pruebas formales (ADF) y an√°lisis visual de ACF. Se identifica n√∫mero de diferencias necesarias para que serie se vuelva estacionaria:
- Si serie original es estacionaria: $d=0$
- Si primera diferencia es estacionaria: $d=1$
- Si segunda diferencia es estacionaria: $d=2$

El par√°metro $d$ es determinado independientemente de $p$ y $q$, antes de cualquier comparaci√≥n de criterios de informaci√≥n.

### Paso 2: An√°lisis Exploratorio de ACF y PACF

Se examinan gr√°ficos de autocorrelaci√≥n para serie potencialmente diferenciada, obteniendo sugerencias preliminares sobre √≥rdenes $p$ y $q$:
- Si ACF corta abruptamente en lag $q$: sugiere MA(q)
- Si PACF corta abruptamente en lag $p$: sugiere AR(p)
- Si ambos decaen gradualmente: sugiere proceso mixto ARMA(p,q)

### Paso 3: Identificaci√≥n de Modelos Candidatos

Se identifican especificaciones ARIMA plausibles basadas en:
- An√°lisis visual de ACF/PACF
- B√∫squeda autom√°tica mediante `auto.arima()`
- Consideraciones de parsimonia (preferir modelos simples)
- Teor√≠a econ√≥mica/financiera sobre comportamiento de variable

Se ajustan m√∫ltiples modelos candidatos con diferentes combinaciones de $(p,d,q)$.

### Paso 4: Estimaci√≥n Comparativa y Selecci√≥n

Se comparan especificaciones mediante:
- Criterios de informaci√≥n (AICc, AIC, BIC)
- M√©tricas de precisi√≥n en datos de entrenamiento (RMSE, MAE, MAPE)
- Principio de parsimonia: preferir modelos m√°s simples si diferencias en ajuste son marginales

Se selecciona modelo que balanc√©a mejor ajuste con complejidad.

### Paso 5: Validaci√≥n Diagn√≥stica de Residuos

Se examinan residuos del modelo seleccionado mediante:
- An√°lisis gr√°fico temporal de residuos (verificar media cero, varianza constante)
- Gr√°fico de ACF de residuos (verificar ausencia de autocorrelaci√≥n)
- Q-Q plot (verificar aproximaci√≥n a normalidad)
- Prueba de Ljung-Box (verificar formalmente que residuos son ruido blanco)

Si residuos no se comportan como ruido blanco, se regresa a Paso 3 para respecificaci√≥n.

### Paso 6: Generaci√≥n de Pron√≥sticos

Una vez validado modelo, se procede a:
- Pron√≥sticos puntuales sobre conjunto de prueba
- Intervalos de confianza (t√≠picamente 95%) que cuantifican incertidumbre
- Evaluaci√≥n ex-post comparando predicciones contra valores reales observados

---

## 2.7 M√©tricas de Evaluaci√≥n del Desempe√±o Predictivo

Para evaluar objetivamente precisi√≥n de pron√≥sticos generados por modelo ARIMA en conjunto de prueba, se emplean m√©tricas cuantitativas est√°ndar:

**RMSE (Root Mean Squared Error):**

$$\text{RMSE} = \sqrt{\frac{1}{n} \sum_{t=1}^{n} (\hat{y}_t - y_t)^2}$$

Amplifica penalizaciones sobre errores grandes, siendo sensible a presencia de valores at√≠picos en errores de pron√≥stico. √ötil para identificar si modelo comete errores sistem√°ticamente grandes en alg√∫n per√≠odo.

**MAE (Mean Absolute Error):**

$$\text{MAE} = \frac{1}{n} \sum_{t=1}^{n} |\hat{y}_t - y_t|$$

Proporciona medida de error promedio menos sensible a outliers que RMSE, ofreciendo perspectiva m√°s robusta de desempe√±o general. Tiene interpretaci√≥n directa: en promedio, predicciones desviaci√≥n esta cantidad del valor real.

**MAPE (Mean Absolute Percentage Error):**

$$\text{MAPE} = \frac{100}{n} \sum_{t=1}^{n} \left| \frac{y_t - \hat{y}_t}{y_t} \right|$$

Expresa error como porcentaje relativo del valor observado, permitiendo comparabilidad del desempe√±o independientemente de magnitud absoluta de valores predichos. Especialmente √∫til en contextos financieros donde escala de precios var√≠a.

**Cobertura de Intervalos de Confianza:**

Se eval√∫a proporci√≥n de valores reales que caen dentro de intervalos de confianza predichos (t√≠picamente 95%). Una calibraci√≥n correcta sugiere que incertidumbre fue estimada apropiadamente; demasiadas observaciones fuera del intervalo sugiere que modelo subestim√≥ volatilidad.

---


# 3. An√°lisis descriptivo

En esta secci√≥n se presenta un an√°lisis descriptivo exhaustivo de la serie hist√≥rica del ETF QQQ (Invesco QQQ Trust) ‚Äîutilizado aqu√≠ como proxy del desempe√±o conjunto de las empresas del Nasdaq-100‚Äî recuperada program√°ticamente desde Yahoo Finance. La serie cubre desde el 1 de enero de 2010 hasta 2025 y trabaja en frecuencia diaria; la variable base es el precio de cierre ajustado, a partir del cual se calculan rendimientos, logar√≠tmicos diarios, mensuales y anuales, as√≠ como medidas de riesgo y desempe√±o.
El prop√≥sito central de este bloque es ofrecer una visi√≥n integrada y reproducible de (i) la evoluci√≥n temporal acumulada del precio del QQQ, (ii) la estructura actual del instrumento ‚Äîpor sectores y principales holdings‚Äî y (iii) un conjunto de estad√≠sticas descriptivas y m√©tricas financieras que cuantifiquen nivel, dispersi√≥n, asimetr√≠a, colas y riesgos extremos. 
Las visualizaciones incluyen gr√°ficos interactivos para facilitar la exploraci√≥n temporal, un gr√°fico de asignaci√≥n sectorial, un diagrama de empaquetamiento circular para las mayores participaciones, histogramas y densidades de retornos, boxplots por a√±o, heatmap estacional mensual y comparaciones normalizadas frente a otros ETFs de mercado . Adem√°s, se presenta un resumen anual con volatilidad y drawdown por a√±o para identificar episodios de estr√©s y recuperaci√≥n, as√≠ como una cronolog√≠a de hitos tecnol√≥gicos relevantes que permite contextualizar inflexiones recientes en la din√°mica del QQQ.
La interpretaci√≥n de los resultados prioriza tres ejes: nivel y tendencia de largo plazo, din√°mica de riesgo (volatilidad y drawdowns) y concentraci√≥n (sectorial y por holdings), con el objetivo de brindar una base s√≥lida para cualquier an√°lisis inferencial o de modelado posterior.

## 3.1.1 serie QQQ historica 

```{r serie, echo=TRUE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
library(xts)
library(tidyquant)
library(tidyverse)
library(plotly)
library(viridis)
library(reshape2)
library(zoo)
library(PerformanceAnalytics)
library(quantmod)
library(knitr)
library(moments)
library(packcircles)
library(tidyr)
library(lubridate)
serie <- getSymbols('QQQ', src='yahoo', auto.assign=FALSE, from="2010-01-01")
precios <- serie$QQQ.Close
datos_qqq <- data.frame(
  Fecha = index(precios),
  Precio = as.numeric(precios)
)
datos_qqq <- datos_qqq %>%
  mutate(Corte = as.yearqtr(Fecha)) 
lista_frames <- lapply(unique(datos_qqq$Corte), function(c) {
  dt <- datos_qqq[datos_qqq$Corte <= c, ]
  dt$Frame <- as.character(c) 
  return(dt)
})

datos_animados <- dplyr::bind_rows(lista_frames)
p <- ggplot(datos_animados, aes(x = Fecha, y = Precio)) +
  
  geom_area(aes(frame = Frame), fill = tesla_pal$primary, alpha = 0.1, position = "identity") +
  
  geom_line(aes(frame = Frame), color = tesla_pal$primary, size = 0.8) +
  
  labs(
    title = "Evoluci√≥n Din√°mica del QQQ",
    subtitle = "Crecimiento hist√≥rico acumulado",
    x = "", 
    y = "Precio (USD)"
  ) +
  scale_y_continuous(labels = scales::dollar_format()) +
  theme_tesla() +
  theme(plot.title = element_text(size = 14))

plotly::ggplotly(p, tooltip = c("x", "y")) %>%
  plotly::layout(
    paper_bgcolor = 'rgba(0,0,0,0)',
    plot_bgcolor = 'rgba(0,0,0,0)',
    font = list(family = "Inter, sans-serif", color = tesla_pal$text_gray),
    hovermode = "x unified"
  ) %>%
  plotly::animation_opts(
    frame = 100,       
    transition = 0,    
    redraw = FALSE     
  ) %>%
  plotly::animation_slider(
    currentvalue = list(prefix = "Periodo: ") 
  ) %>%
  plotly::config(displayModeBar = FALSE)
```

Desde 2010, la trayectoria del QQQ ha mantenido una direcci√≥n claramente ascendente, reflejando el impulso sostenido del sector tecnol√≥gico dentro del mercado estadounidense. El fondo pas√≥ de cotizar por debajo de los 60‚Äì70 USD a comienzos de la d√©cada a superar con holgura los 600 USD hacia 2025, un avance que evidencia un crecimiento compuesto fuerte y continuo. En series con este tipo de expansi√≥n acelerada, es habitual recurrir a retornos logar√≠tmicos para describir mejor los cambios relativos y evitar interpretaciones distorsionadas cuando los precios se multiplican varias veces a lo largo del tiempo.

Aunque la tendencia de fondo es positiva, el gr√°fico tambi√©n deja ver fases de tensi√≥n que marcan la din√°mica del riesgo. La ca√≠da de 2020, derivada del choque inicial por la pandemia, destaca por su brusquedad y r√°pida recuperaci√≥n, mientras que la correcci√≥n de 2022 ‚Äîrelacionada con el ciclo restrictivo de la Reserva Federal‚Äî muestra un descenso m√°s prolongado y coherente con un aumento generalizado de la aversi√≥n al riesgo. Estos episodios reflejan lo que suele documentarse en la literatura: la volatilidad tiende a agruparse en ciertos periodos y no se distribuye de forma uniforme en el tiempo, lo que justifica complementar el an√°lisis con m√©tricas de drawdown y distribuciones de retornos.

En los a√±os m√°s recientes, especialmente entre 2023 y 2025, el ritmo de apreciaci√≥n del QQQ se acelera de manera notable. Este comportamiento coincide con el empuje de las grandes compa√±√≠as vinculadas a inteligencia artificial y computaci√≥n avanzada, cuyo peso dentro del √≠ndice es determinante. En ese contexto, la concentraci√≥n en mega-caps tecnol√≥gicas act√∫a como un motor de crecimiento, pero tambi√©n incrementa la sensibilidad del fondo a cualquier cambio en las valoraciones del sector.

En conjunto, la evoluci√≥n del QQQ entre 2010 y 2025 combina una tendencia estructural de crecimiento con episodios de inestabilidad y con una dependencia cada vez mayor del desempe√±o de unas pocas empresas de gran capitalizaci√≥n. Esta mezcla explica tanto su elevado rendimiento hist√≥rico como su exposici√≥n marcada a shocks de volatilidad.

## 4.1 Resumen anual retornos

```{r resumen_anual_tabla, echo=TRUE, warning=FALSE, message=FALSE}


if (!exists("precios")) {
  precios <- serie[,6]   
}
ret_diario <- dailyReturn(precios, type = "log")
ret_anual  <- yearlyReturn(precios, type = "log")
df_ann <- data.frame(Fecha = index(ret_anual), Ret = as.numeric(ret_anual))
df_ann <- df_ann %>% mutate(A√±o = year(Fecha), RetPct = Ret * 100)
vol_year <- ret_diario %>%
  data.frame(Fecha = index(ret_diario), Ret = as.numeric(ret_diario)) %>%
  mutate(A√±o = year(Fecha)) %>%
  group_by(A√±o) %>%
  summarise(
    Volatilidad = sd(Ret, na.rm = TRUE) * sqrt(252) * 100,
    RetornoTotal = sum(Ret) * 100
  )
dd_df <- data.frame(Fecha = index(ret_diario), Ret = as.numeric(ret_diario)) %>%
  mutate(A√±o = year(Fecha))

maxdd_yr <- dd_df %>% group_by(A√±o) %>%
  summarise(
    MaxDrawdown = min(cumprod(1 + Ret) / cummax(cumprod(1 + Ret)) - 1) * 100
  )
res_yr <- left_join(vol_year, maxdd_yr, by = "A√±o") %>% arrange(desc(A√±o))
kable(
  res_yr,
  format = "html",
  digits = 2,
  align = c("l", "r", "r", "r"),
  col.names = c("A√±o", "Volatilidad (%)", "Retorno Total (%)", "Max Drawdown (%)"),
  table.attr = "class='table' style='width:60%; margin:auto; font-size:18px;'"
)

```

Las estad√≠sticas descriptivas del nivel de precios refuerzan la lectura estructural del comportamiento del QQQ en el periodo 2010‚Äì2025. A diferencia de los rendimientos ‚Äîque fluct√∫an alrededor de cero‚Äî los niveles de precio capturan la magnitud absoluta del crecimiento del √≠ndice y el sesgo temporal que caracteriza su trayectoria ascendente.

El promedio de la muestra (202.67 USD) se sit√∫a muy por encima de la mediana (152.08 USD), una diferencia que revela una asimetr√≠a positiva moderada (Skewness ‚âà 0.92). Esto implica que la distribuci√≥n est√° desplazada hacia valores altos, lo cual es consistente con la aceleraci√≥n del precio en los a√±os recientes. En otras palabras, aunque el QQQ pas√≥ gran parte del periodo operando en niveles intermedios, la fuerte expansi√≥n desde 2020 ‚Äîparticularmente entre 2023 y 2025‚Äî ‚Äúempuja‚Äù el promedio hacia arriba. Desde el punto de vista financiero, esta asimetr√≠a refleja que una porci√≥n significativa de la creaci√≥n de valor se concentra en el tramo final de la serie, en l√≠nea con el auge tecnol√≥gico vinculado a inteligencia artificial.

El recorrido completo del precio, que va desde un m√≠nimo de 37.14 USD hasta un m√°ximo de 635.77 USD, muestra una amplitud cercana a 600 USD, coherente con una tendencia secular de gran magnitud. Esta amplitud se expresa tambi√©n en la desviaci√≥n est√°ndar (150.65 USD), que m√°s que capturar riesgo ‚Äúinstant√°neo‚Äù, sirve aqu√≠ como medida del tama√±o de la tendencia: un activo que multiplica varias veces su valor en quince a√±os exhibe, por construcci√≥n, una dispersi√≥n elevada en sus niveles observados.

La curtosis de 2.78 ‚Äîligeramente inferior al valor de referencia normal (=3)‚Äî indica una distribuci√≥n mesoc√∫rtica, es decir, sin una concentraci√≥n excesiva en los extremos. Sin embargo, esto no contradice el comportamiento observado: al tratarse de precios y no de retornos, es com√∫n que las colas sean menos pronunciadas, ya que la tendencia de largo plazo suaviza parte de la variabilidad relativa. Lo relevante aqu√≠ es que la distribuci√≥n no se ajusta a un patr√≥n estrictamente sim√©trico ni estacionario, lo cual coincide con la naturaleza del QQQ como activo fuertemente direccionado por ciclos tecnol√≥gicos.

En conjunto, estas m√©tricas reafirman que la estructura estad√≠stica del precio del QQQ est√° dominada por una tendencia alcista persistente, episodios de aceleraci√≥n reciente y una asimetr√≠a que refleja c√≥mo la mayor parte de la apreciaci√≥n del valor se concentra en la √∫ltima fase del periodo analizado.

## 3.1.2 Divisi√≥n sectorial 


```{r tortA, echo=TRUE, warning=FALSE, message=FALSE}

sectores <- data.frame(
  Sector = c("Tecnolog√≠a", "Consumo Discrecional", "Servicios de Comunicaci√≥n", 
             "Consumo B√°sico", "Industriales", "Salud", "Otros", 
             "Servicios P√∫blicos", "Materiales", "Energ√≠a"),
  Peso = c(53.60, 13.04, 12.61, 4.99, 4.58, 4.28, 3.22, 1.38, 1.25, 0.47)
)

colores_sector <- c(
  "#2b5c8a",
  "#5d5b94", 
  "#8e6fa3",
  "#c46d9e",
  "#e67586", 
  "#f38972", 
  "#f8a262",
  "#fbc058", 
  "#fce05d", 
  "#34495e"  
)
fig_pie <- plot_ly(sectores, labels = ~Sector, values = ~Peso, type = 'pie',
        textposition = 'outside',      
        textinfo = 'label+percent',    
        hoverinfo = 'label+value+percent',
        marker = list(
          colors = colores_sector, 
          line = list(color = '#ffffff', width = 1.5) 
        ),
        sort = FALSE, 
        automargin = TRUE
)

fig_pie <- fig_pie %>% layout(
  title = list(
    text = "<b>Asignaci√≥n Sectorial</b>",
    font = list(size = 22, family = "Poppins, sans-serif", color = tesla_pal$text_main),
    x = 0.05, 
    y = 0.95
  ),
  showlegend = FALSE, 
  margin = list(t = 80, b = 40, l = 80, r = 80), 
  paper_bgcolor = 'rgba(0,0,0,0)',
  plot_bgcolor = 'rgba(0,0,0,0)',
  font = list(family = "Inter, sans-serif", size = 12, color = tesla_pal$text_gray)
)

fig_pie

```

El gr√°fico de Asignaci√≥n Sectorial ratifica la identidad del QQQ no como un √≠ndice de mercado amplio, sino como un veh√≠culo de inversi√≥n tem√°tico con un sesgo factorial expl√≠cito: el sector Tecnolog√≠a ejerce una hegemon√≠a absoluta sobre la estructura del fondo, acaparando el 53.9% de los activos netos. Esta concentraci√≥n masiva desborda los l√≠mites tradicionales de la diversificaci√≥n sectorial, convirtiendo al ETF en un instrumento altamente sensible a los ciclos de innovaci√≥n y a las revisiones de valoraci√≥n espec√≠ficas de la industria tecnol√≥gica.

Esta preponderancia se ve magnificada por la correlaci√≥n estrat√©gica de los sectores secundarios: Consumo Discrecional (13.1%) y Servicios de Comunicaci√≥n (12.7%) ocupan el segundo y tercer lugar respectivamente. Desde una perspectiva fundamental, esta distribuci√≥n es enga√±osa, pues gran parte de los componentes de estos sectores (como Amazon en consumo o Alphabet/Meta en comunicaci√≥n) operan bajo din√°micas digitales similares a las tecnol√≥gicas puras. En consecuencia, cerca del 80% del portafolio se encuentra expuesto al factor Growth (Crecimiento), lo que implica una alta sensibilidad a la liquidez del mercado y al apetito por riesgo, distanci√°ndose de la estructura m√°s balanceada que ofrecen √≠ndices generalistas como el S&P 500 (MSCI, 2023).

Por el contrario, la participaci√≥n marginal de sectores defensivos y antic√≠clicos ‚Äîcomo Consumo B√°sico (5.02%), Salud (4.3%), Industriales (4.61%) y las asignaciones residuales en Servicios P√∫blicos (1.39%) y Energ√≠a (0.473%)‚Äî sugiere que el QQQ carece de los "amortiguadores" tradicionales contra la volatilidad macroecon√≥mica. Esta asimetr√≠a estructural dota al portafolio de una elevada duraci√≥n de acciones impl√≠cita, haci√©ndolo mec√°nicamente vulnerable a las variaciones en la tasa de descuento (tasas de inter√©s), una caracter√≠stica que explica la severidad de las correcciones observadas en 2022 cuando el costo del capital se increment√≥ (Bernstein, 1997).

## 3.3 Mayores Holdings 

```{r top10, echo=TRUE, warning=FALSE, message=FALSE}

top10 <- data.frame(
  ticker = c("NVDA","AAPL","MSFT","AVGO","AMZN","GOOGL","GOOG","TSLA","META","NFLX"),
  empresa = c("NVIDIA","Apple Inc.","Microsoft","Broadcom Inc.","Amazon.com, Inc.",
              "Alphabet Class A","Alphabet Class C","Tesla, Inc.","Meta Plataformas, Inc.","Netflix, Inc."),
  peso = c(9.33, 8.78, 7.69, 6.59, 5.21, 3.97, 3.71, 3.31, 2.93, 2.36),
  sector = c("Tecnolog√≠a","Tecnolog√≠a","Tecnolog√≠a","Tecnolog√≠a",
             "Consumo","Comunicaci√≥n","Comunicaci√≥n",
             "Consumo","Comunicaci√≥n","Consumo"),
  stringsAsFactors = FALSE
)

otros_val <- round(100 - sum(top10$peso), 2)
holdings <- bind_rows(top10,
                      data.frame(ticker="OTROS", empresa="Resto del QQQ",
                                 peso = otros_val, sector="Varios", stringsAsFactors = FALSE)) %>%
  arrange(desc(peso))

packing <- circleProgressiveLayout(holdings$peso, sizetype='area')
holdings_pack <- cbind(holdings, packing)
holdings_pack$id <- seq_len(nrow(holdings_pack))
holdings_pack <- holdings_pack %>% rename(center_x = x, center_y = y)

dat.gg <- circleLayoutVertices(packing, npoints = 100)
dat.gg <- merge(dat.gg, holdings_pack, by = "id")

holdings_pack <- holdings_pack %>%
  mutate(
    peso_label = gsub("\\.", ",", formatC(peso, digits = 2, format = "f")),
    hover_text = paste0(
      empresa, "\n",
      "Ticker: ", ticker, "\n",
      "Peso: ", peso_label, "%\n",
      "Sector: ", sector
    ),
    label_text = ifelse(peso >= 2.3, paste0(ticker, "\n", peso_label, "%"), "")
  )

fill_map <- c(
  "Tecnolog√≠a"   = tesla_pal$primary,
  "Consumo"      = tesla_pal$secondary,
  "Comunicaci√≥n" = "#3b82f6",
  "Varios"       = tesla_pal$text_gray
)

p_bubble <- ggplot() +
  geom_polygon(
    data = dat.gg,
    aes(x = x, y = y, group = id, fill = sector,
        text = holdings_pack$hover_text[match(id, holdings_pack$id)]),
    color = "white", size = 0.5, alpha = 0.95
  ) +
  geom_text(
    data = holdings_pack,
    aes(x = center_x, y = center_y, label = label_text, text = hover_text),
    size = 3.8, color = "white", fontface = "bold", lineheight = 0.9
  ) +
  scale_fill_manual(values = fill_map) +
  theme_void() +
  coord_equal() +
  labs(title = "Composici√≥n del Portafolio QQQ",
       subtitle = "Top holdings seg√∫n la imagen") +
  theme(
    plot.title = element_text(face = "bold", size = 16, color = tesla_pal$text_main, hjust = 0.5),
    plot.subtitle = element_text(size = 12, color = tesla_pal$text_gray, hjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    plot.margin = margin(10,10,10,10)
  )

ggplotly(p_bubble, tooltip = "text") %>%
  config(displayModeBar = FALSE) %>%
  layout(
    font = list(family = "Inter", color = tesla_pal$text_main),
    plot_bgcolor  = "rgba(0,0,0,0)",
    paper_bgcolor = "rgba(0,0,0,0)",
    legend = list(orientation = "h", yanchor = "bottom", y = -0.12, xanchor = "center", x = 0.5),
    hoverlabel = list(
      bgcolor = "rgba(255,255,255,0.97)",
      bordercolor = "rgba(0,0,0,0.08)",
      font = list(family = "Inter", color = tesla_pal$text_main, size = 11)
    )
  )
```

El diagrama de empaquetamiento circular revela la estructura interna del QQQ, evidenciando una alta concentraci√≥n jer√°rquica en un n√∫mero reducido de activos de mega-capitalizaci√≥n. Visualmente, el gr√°fico confirma que el rendimiento del √≠ndice no es el resultado de una contribuci√≥n homog√©nea, sino que depende desproporcionadamente de un cl√∫ster de empresas dominantes: las diez mayores posiciones (encabezadas por NVDA, AAPL, MSFT y AVGO) representan, en conjunto, m√°s del 50% del peso total del portafolio, relegando al segmento de "Otros" (el resto de los componentes del Nasdaq-100) a una participaci√≥n minoritaria del 46.12%. Esta arquitectura de cartera contradice el principio cl√°sico de diversificaci√≥n ingenua, exponiendo al inversor a un significativo riesgo idiosincr√°tico derivado del desempe√±o individual de estos gigantes tecnol√≥gicos (Markowitz, 1952).

La distribuci√≥n sectorial refuerza el sesgo hacia la innovaci√≥n: las burbujas predominantes en color verde (Tecnolog√≠a), azul (Comunicaci√≥n) y cian (Consumo Discrecional) ilustran que el QQQ es, en esencia, una apuesta factorial hacia el crecimiento y la econom√≠a digital, con una exposici√≥n m√≠nima a sectores defensivos tradicionales. Resulta particularmente notable que NVIDIA (9.33%) haya superado a Apple (8.78%) y Microsoft (7.69%) como el componente de mayor ponderaci√≥n, un cambio estructural que valida emp√≠ricamente la hip√≥tesis planteada en el an√°lisis de precios sobre el impacto disruptivo de la Inteligencia Artificial Generativa en la valoraci√≥n de activos recientes (Fama & French, 2015).

Desde una perspectiva de gesti√≥n de riesgos, esta configuraci√≥n explica la alta beta y la convexidad observada en la serie hist√≥rica: la correlaci√≥n positiva entre estos pocos activos l√≠deres amplifica tanto los rendimientos exponenciales en mercados alcistas como la severidad de los drawdowns en periodos de correcci√≥n, confirmando que la din√°mica del QQQ est√° intr√≠nsecamente ligada a la salud financiera y las expectativas de crecimiento de este selecto grupo de empresas (Sharpe, 1964).


## 3.4 An√°lisis Estad√≠stico precios

```{r tabla, echo=TRUE, warning=FALSE, message=FALSE}

serie_vec <- as.numeric(serie[,6])
serie_vec <- serie_vec[!is.na(serie_vec)]
if (max(serie_vec) > 1000) {
  warning("‚ö†Ô∏è La serie est√° por fuera del rango t√≠pico del QQQ (0‚Äì1000 USD)")
}

valores_calculados <- c(
  length(serie_vec),
  mean(serie_vec),
  median(serie_vec),
  min(serie_vec),
  max(serie_vec),
  max(serie_vec) - min(serie_vec),
  var(serie_vec),
  sd(serie_vec),
  skewness(serie_vec),
  kurtosis(serie_vec)
)

desc <- data.frame(
  M√©trica = c(
    "Observaciones Totales",
    "Media",
    "Mediana",
    "M√≠nimo",
    "M√°ximo",
    "Rango",
    "Varianza",
    "Desviaci√≥n Est√°ndar",
    "Asimetr√≠a (Skewness)",
    "Curtosis"
  ),
  Valor = format(
    round(valores_calculados, 4),
    scientific = FALSE,
    big.mark = ","
  )
)

kable(
  desc,
  format = "html",
  align = c('l', 'r'),
  table.attr = "class='table' style='width:60%; margin:auto; font-size:18px;'"
)

```

Las estad√≠sticas b√°sicas del nivel de precios confirman una estructura marcada por una tendencia ascendente persistente y un aumento significativo de los valores en los √∫ltimos a√±os. El promedio de la muestra (202.67 USD) se ubica claramente por encima de la mediana (152.08 USD), lo que evidencia una asimetr√≠a positiva moderada. Esta diferencia indica que los registros m√°s recientes ‚Äîdonde el QQQ alcanz√≥ niveles hist√≥ricamente altos‚Äî desplazan la distribuci√≥n hacia la parte superior del rango, reflejando que buena parte de la apreciaci√≥n del valor se concentra en la etapa final del periodo analizado.

El m√≠nimo (37.14 USD) y el m√°ximo (635.77 USD) delimitan un rango amplio de casi 600 USD, coherente con un activo que ha multiplicado varias veces su precio desde 2010. Esta amplitud tambi√©n se manifiesta en la desviaci√≥n est√°ndar (150.65 USD) y en la varianza asociada, que m√°s que representar ‚Äúriesgo‚Äù en sentido estricto, describen la magnitud de la tendencia de largo plazo: un activo con una trayectoria fuertemente alcista necesariamente presenta una dispersi√≥n elevada en sus niveles hist√≥ricos.

La asimetr√≠a de 0.92 confirma el desplazamiento de la distribuci√≥n hacia valores altos, en l√≠nea con la aceleraci√≥n reciente del √≠ndice. Por su parte, la curtosis de 2.78 ‚Äîligeramente inferior al valor normal‚Äî sugiere una distribuci√≥n mesoc√∫rtica, sin una concentraci√≥n extrema en las colas pero tampoco completamente sim√©trica o estacionaria, algo t√≠pico en series de precios que siguen una tendencia estructural fuerte.

En conjunto, estas m√©tricas describen una serie dominada por la apreciaci√≥n sostenida del QQQ, con una distribuci√≥n inclinada hacia los niveles altos y una dispersi√≥n que refleja la magnitud del crecimiento acumulado a lo largo del periodo.

## 3.5 Rendimientos Diarios

```{r tablarendimientos, echo=TRUE, warning=FALSE, message=FALSE}

precios <- serie$QQQ.Close
ret_diario  <- dailyReturn(precios, type = "log")
ret_mensual <- monthlyReturn(precios, type = "log")
ret_anual   <- yearlyReturn(precios, type = "log")
vol_anual <- sd(ret_diario) * sqrt(252)
resumen <- data.frame(
  Concepto = "Volatilidad Anualizada (Riesgo)",
  Valor = scales::percent(vol_anual, accuracy = 0.01)
)
kable(resumen, 
      format = "html", 
      table.attr = "class='table' style='width:50%; margin:auto;'")

```

La volatilidad anualizada del 20.80% sintetiza, en un √∫nico indicador, el nivel de riesgo que ha acompa√±ado la trayectoria del QQQ durante el periodo analizado. Este valor es coherente con un activo que, aunque mantiene una tendencia alcista sostenida, experimenta episodios concentrados de inestabilidad propios de un √≠ndice fuertemente expuesto al sector tecnol√≥gico.

Un nivel de volatilidad cercano al 21% puede considerarse moderado-alto para un ETF de renta variable, y encaja con los patrones ya observados: a√±os de gran expansi√≥n seguidos por correcciones abruptas (como en 2020 y 2022), as√≠ como periodos de aceleraci√≥n extraordinaria impulsados por innovaciones tecnol√≥gicas recientes. En t√©rminos pr√°cticos, esta magnitud implica que las fluctuaciones anuales t√≠picas del precio se mueven alrededor de ese rango, lo que coincide con la dispersi√≥n vista en los drawdowns y en las amplitudes anuales de retornos.

Desde la perspectiva estad√≠stica, una volatilidad de este tama√±o tambi√©n respalda la idea de volatilidad agrupada: largos tramos de relativa estabilidad interrumpidos por fases cortas de sobresaltos. Es la misma din√°mica que se evidenci√≥ en el comportamiento hist√≥rico del √≠ndice y que la literatura cl√°sica asocia a mercados impulsados por ciclos tecnol√≥gicos, donde los cambios de expectativas pueden ser abruptos.

En s√≠ntesis, la volatilidad anualizada del 20.80% no solo caracteriza el riesgo promedio del QQQ, sino que encaja con la narrativa general: un activo con una tendencia estructural potente, pero atravesado por episodios de estr√©s que amplifican temporalmente sus oscilaciones.

## 3.6 Retornos Diarios

```{r tablaretrnosentos, echo=TRUE, warning=FALSE, message=FALSE}
ret_df <- data.frame(Retorno = as.numeric(ret_diario))

ggplot(ret_df, aes(x = Retorno)) +
  geom_histogram(aes(y = ..density..), bins = 60, fill = tesla_pal$primary, alpha = 0.4) +
  geom_density(color = tesla_pal$secondary, size = 1.2) +
  labs(title = "Distribuci√≥n de los Rendimientos Diarios del QQQ",
       x = "Retorno Diario (log)", y = "Densidad") +
  theme_tesla()

```

La distribuci√≥n de los rendimientos diarios del QQQ revela una estructura estad√≠stica coherente con la arquitectura altamente concentrada del portafolio descrita en los apartados anteriores. Como muestra el gr√°fico, la curva de densidad presenta un pico pronunciado alrededor de cero y colas m√°s gruesas de lo que predecir√≠a una distribuci√≥n normal, rasgo t√≠pico de activos dominados por empresas de gran capitalizaci√≥n fuertemente correlacionadas entre s√≠.

Este patr√≥n leptoc√∫rtico ‚Äîevidenciado visualmente por la altura central desproporcionada y la presencia de observaciones extremas (tanto positivas como negativas) en los m√°rgenes‚Äî es consistente con el comportamiento de un √≠ndice no diversificado de manera homog√©nea, sino fuertemente dependiente de unos pocos motores de crecimiento. En efecto, la concentraci√≥n estructural en NVDA, AAPL, MSFT y AVGO expuesta en el diagrama de empaquetamiento circular se manifiesta directamente en la forma de la distribuci√≥n:

cuando estas compa√±√≠as se sincronizan al alza, generan acumulaci√≥n de rendimientos peque√±os y frecuentes, que estrechan la parte central de la distribuci√≥n;

pero cuando experimentan shocks idiosincr√°ticos o correcciones de m√∫ltiplos, producen movimientos abruptos de mayor magnitud, responsables de las colas pesadas observadas.

Desde una perspectiva de riesgo, esta distribuci√≥n asim√©trica confirma una alta kurtosis y la presencia de eventos de gran impacto con mayor probabilidad que la predicha por modelos cl√°sicos de media-varianza (Markowitz, 1952). Ello es coherente con el sesgo factorial descrito previamente: un ETF con exposici√≥n cercana al 80% al factor Growth y m√≠nima participaci√≥n en sectores defensivos exhibir√° de forma natural una mayor propensi√≥n a "jumps" y episodios de volatilidad concentrada.

La ligera inclinaci√≥n de la distribuci√≥n hacia rendimientos negativos ‚Äîvisible en la cola izquierda m√°s extendida‚Äî es una expresi√≥n emp√≠rica de la sensibilidad del QQQ a cambios en la tasa de descuento, propiedad tambi√©n discutida en el an√°lisis sectorial. Durante ciclos de endurecimiento monetario, los activos de larga duraci√≥n impl√≠cita (como la tecnolog√≠a de mega-capitalizaci√≥n) tienden a exhibir ca√≠das m√°s pronunciadas, lo cual explica tanto la asimetr√≠a negativa como la convexidad detectada en la serie hist√≥rica (Sharpe, 1964).

En conjunto, la forma de la distribuci√≥n no solo plasma el comportamiento estad√≠stico de los rendimientos, sino que funciona como una evidencia visual directa de la propia identidad del QQQ:
un veh√≠culo altamente concentrado, dominado por factores de crecimiento, sensible a liquidez y a ciclos tecnol√≥gicos, y estructuralmente propenso a movimientos extremos m√°s frecuentes que los esperados bajo supuestos gaussianos.



```{r boxpllot, echo=TRUE, warning=FALSE, message=FALSE}

ret_anual_df <- data.frame(
  Fecha = index(ret_diario),
  Ret = as.numeric(ret_diario),
  A√±o = format(index(ret_diario), "%Y")
)

ggplot(ret_anual_df, aes(x = A√±o, y = Ret, group = A√±o)) +
  geom_boxplot(fill = tesla_pal$primary, alpha = 0.7) +
  labs(title = "Distribuci√≥n de los Retornos Diarios por A√±o (QQQ)",
       x = "A√±o", y = "Retorno Diario") +
  theme_tesla() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))

```

La evoluci√≥n anual de los retornos diarios del QQQ confirma varios de los patrones ya identificados en el comportamiento hist√≥rico del √≠ndice. A lo largo del periodo 2010‚Äì2025, los boxplots muestran que la mediana de los retornos permanece cercana a cero, un rasgo t√≠pico de los activos financieros, donde la tendencia de largo plazo se manifiesta en los niveles de precio, no en variaciones diarias (Tsay, 2010). Sin embargo, la dispersi√≥n en torno a esa mediana cambia significativamente entre a√±os, reflejando la naturaleza c√≠clica y no constante de la volatilidad.

Durante la primera mitad del periodo (2010‚Äì2019), la amplitud de las cajas y la presencia moderada de valores at√≠picos sugieren un entorno relativamente estable, coherente con los dem√°s indicadores anuales: retornos positivos sostenidos y drawdowns acotados. No obstante, incluso en esos a√±os se observa el fen√≥meno de agrupamiento de volatilidad, donde los d√≠as con movimientos extremos tienden a aparecer en racimos, tal como anticipa la literatura de colas pesadas y dependencia temporal (Mandelbrot, 1963).

Los cambios m√°s notorios aparecen a partir de 2020. El ensanchamiento abrupto de los boxplots y la proliferaci√≥n de outliers tanto positivos como negativos reflejan el choque de la pandemia: un episodio de volatilidad extrema seguido de una recuperaci√≥n igualmente acelerada. Este patr√≥n contin√∫a en 2021, aunque con menor severidad, y se intensifica nuevamente en 2022, cuando la pol√≠tica monetaria restrictiva genera el conjunto m√°s amplio de retornos diarios negativos y una dispersi√≥n considerablemente mayor, en l√≠nea con el desplome anual registrado en ese a√±o.

A partir de 2023, la dispersi√≥n disminuye parcialmente, pero se mantienen puntos aislados de retornos altos, consistentes con el impulso generado por el auge de la inteligencia artificial generativa y el papel dominante de las mega-caps tecnol√≥gicas en el √≠ndice (Invesco, 2024). Esto explica por qu√©, pese a un entorno de fuerte apreciaci√≥n del precio, los boxplots a√∫n muestran eventos extremos: la innovaci√≥n tecnol√≥gica tiende a amplificar reacciones del mercado, tanto alcistas como bajistas (Malkiel, 2003).

En conjunto, la distribuci√≥n anual de retornos evidencia que el QQQ combina periodos prolongados de estabilidad con episodios de sobresaltos intensos, confirmando que la volatilidad no es constante sino heterog√©nea y concentrada en momentos espec√≠ficos. Este comportamiento es caracter√≠stico de los activos con fuerte exposici√≥n tecnol√≥gica y ajusta perfectamente con las dem√°s m√©tricas analizadas del √≠ndice.

## 3.7 Rendimientos por a√±o

```{r rendimientosa√±o, echo=TRUE, eval=TRUE, warning=FALSE, message=FALSE}
ret_anual_df <- data.frame(
  A√±o = year(index(ret_anual)),
  Retorno = round(100 * as.numeric(ret_anual), 2)
) %>%
  mutate(
    Tipo = ifelse(Retorno >= 0, "Positivo", "Negativo"),
  
    Pos_Texto = ifelse(Retorno >= 0, -0.4, 1.2)
  )

ggplot(ret_anual_df, aes(x = factor(A√±o), y = Retorno, fill = Tipo)) +
  
  geom_col(show.legend = FALSE) + 
    scale_fill_manual(values = c(
    "Positivo" = tesla_pal$primary,   
    "Negativo" = tesla_pal$negative   
  )) +
    geom_text(
    aes(label = paste0(Retorno, "%"), vjust = Pos_Texto),
    color = tesla_pal$text_main,
    size = 3.2,          
    fontface = "bold"     
  ) +
  
  labs(
    title = "Retorno Anual Hist√≥rico del QQQ",
    subtitle = "Rendimiento logar√≠tmico anualizado (1999-2025)",
    x = "", 
    y = "Retorno (%)"
  ) +
  
  scale_y_continuous(expand = expansion(mult = 0.15)) +
    theme_tesla() +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, size = 10),
    panel.grid.major.x = element_blank() 
  )
```

La secuencia de retornos anuales entre 2010 y 2025 muestra de manera clara c√≥mo el comportamiento del QQQ combina una tendencia alcista de largo plazo con episodios puntuales de extrema volatilidad. Durante la d√©cada 2010‚Äì2019 predominan los resultados positivos, con solo una correcci√≥n leve en 2018 (-0.97%). Este patr√≥n coincide con el periodo de expansi√≥n tecnol√≥gica posterior a la Crisis Financiera, donde la acumulaci√≥n de retornos se desarroll√≥ de forma progresiva y relativamente estable (Tsay, 2010).

La presencia de a√±os sobresalientes ‚Äîcomo 2013 (30.05%), 2017 (27.36%) o 2019 (32.08%)‚Äî confirma que buena parte del crecimiento del √≠ndice ocurri√≥ en impulsos discretos, m√°s que en un aumento lineal. Estos episodios de fuerte apreciaci√≥n son caracter√≠sticos de los activos con exposici√≥n tecnol√≥gica, donde la adopci√≥n de nuevas plataformas y ciclos de innovaci√≥n generan ondas de crecimiento acelerado (Malkiel, 2003).

El quiebre m√°s severo del periodo ocurre en 2022, con un retorno anual de ‚Äì40.15%, el m√°s profundo de toda la muestra. Este a√±o concentra el efecto del ajuste monetario m√°s agresivo en d√©cadas, sumado al drenaje de liquidez que afect√≥ particularmente a las compa√±√≠as de crecimiento. La ca√≠da coincide con lo observado en los boxplots de retornos y en las m√©tricas anuales de riesgo, donde 2022 destaca como el a√±o con mayor dispersi√≥n y drawdown, validando la presencia de un episodio claro de riesgo de cola (Mandelbrot, 1963).

A partir de 2023, el retorno se recupera con fuerza (43.04%), reflejando el impulso generado por el auge de la inteligencia artificial generativa y el liderazgo de las mega-caps tecnol√≥gicas, que dominan la composici√≥n del √≠ndice (Invesco, 2024). Los a√±os 2024 y 2025 mantienen retornos positivos, aunque m√°s moderados, lo que sugiere una normalizaci√≥n despu√©s del rebote inicial, pero dentro de un entorno a√∫n marcado por expectativas de crecimiento tecnol√≥gico.

En suma, la serie de retornos anuales del QQQ muestra un activo con convexidad positiva de largo plazo, capaz de generar apreciaciones significativas en fases expansivas, pero sujeto a ca√≠das abruptas cuando el ciclo tecnol√≥gico o monetario se invierte. Esta din√°mica encaja plenamente con las dem√°s m√©tricas analizadas: volatilidad variable, asimetr√≠a positiva en los precios y episodios concentrados de estr√©s, todos rasgos caracter√≠sticos de un √≠ndice liderado por innovaci√≥n y crecimiento acelerado.

## 3.8 Drawdown 

```{r drawdown, echo=TRUE, eval=TRUE, warning=FALSE, message=FALSE}

ret_diario <- dailyReturn(precios, type = "log")

dd <- PerformanceAnalytics::Drawdowns(ret_diario)
dd_df <- data.frame(
  Fecha = index(dd),
  Drawdown = as.numeric(dd)
)
ggplot(dd_df, aes(x = Fecha, y = Drawdown)) +
  geom_line(color = tesla_pal$primary, linewidth = 0.7) +
  labs(title = "Drawdown Hist√≥rico del QQQ",
       x = "", y = "Drawdown") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  theme_tesla()
```

El gr√°fico revela de manera clara la profundidad y duraci√≥n de las p√©rdidas relativas del √≠ndice respecto a sus m√°ximos previos durante el per√≠odo 2010-2025, permitiendo evaluar no solo la volatilidad, sino tambi√©n la resiliencia del mercado tecnol√≥gico a lo largo de estos quince a√±os.

Entre 2010 y 2019, el QQQ experimenta drawdowns moderados y controlados. El a√±o m√°s desafiante de esta d√©cada fue 2011, con un m√°ximo drawdown de -16.81%, seguido por 2015-2016 con -16.88%, representando correcciones breves pero significativas. Sin embargo, estos episodios fueron de corta duraci√≥n, caracterizados por recuperaciones relativamente r√°pidas. Este comportamiento coincide con la fase de crecimiento sostenido observada en los retornos anuales, impulsada por la expansi√≥n de las grandes empresas tecnol√≥gicas, avances en inteligencia artificial temprana, comercio digital y servicios en la nube. El patr√≥n es coherente con estudios que evidencian la creciente madurez y resistencia del sector tecnol√≥gico durante esta d√©cada. En este per√≠odo, las ca√≠das existen, pero ninguna se aproxima a niveles catastr√≥ficos, indicando una solidez estructural progresiva del √≠ndice.

El gr√°fico tambi√©n evidencia un drawdown significativo durante la pandemia de COVID-19 en 2020, alcanzando -30.54%. Aunque de severidad notable, fue de corta duraci√≥n. A diferencia de crisis prolongadas, el QQQ experiment√≥ una ca√≠da r√°pida seguida de una recuperaci√≥n igual de acelerada, fen√≥meno asociado a la digitalizaci√≥n abrupta de la econom√≠a que impuls√≥ fuertemente la demanda por empresas tecnol√≥gicas. Este comportamiento refuerza la idea de que el QQQ posee una estructura sectorial que se beneficia de shocks que incrementan la dependencia digital, lo que explica la r√°pida salida del drawdown. La recuperaci√≥n en 2021, con drawdown de solo -11.10%, confirma que el mercado absorbi√≥ r√°pidamente el shock de la pandemia.

El per√≠odo 2022-2023 muestra el episodio m√°s desafiante del per√≠odo 2010-2025. En 2022, el drawdown alcanz√≥ -39.03%, el m√°ximo de toda la ventana de 15 a√±os analizada. Esta ca√≠da coincide con el ajuste de valoraciones provocado por el aumento agresivo de tasas de inter√©s de la Reserva Federal, la inflaci√≥n elevada y la contracci√≥n monetaria global. Estos shocks afectan especialmente a activos de crecimiento como los tecnol√≥gicos, cuyo valor presente es altamente sensible a cambios en las tasas de descuento, en l√≠nea con los argumentos del modelo CAPM y la literatura sobre sensibilidad de activos de crecimiento a tasas de inter√©s. No obstante, a diferencia de crisis anteriores, el drawdown se recupera parcialmente durante el mismo per√≠odo: en 2023, el m√°ximo drawdown desciende a -38.71%, y en 2024 contin√∫a mejorando hasta -13.85%, demostrando mayor robustez del mercado tecnol√≥gico contempor√°neo y capacidad de recuperaci√≥n acelerada.

Los datos m√°s recientes (2024-2025) muestran estabilizaci√≥n. El m√°ximo drawdown de 2024 fue de -13.85%, y en 2025 se ubica en -23.54%, sugiriendo que el mercado ha procesado el ajuste monetario y opera en un nuevo equilibrio. Aunque persisten correcciones menores, estas son caracter√≠sticas normales de mercados din√°micos impulsados por innovaci√≥n tecnol√≥gica.

En conjunto, el an√°lisis del drawdown en el per√≠odo 2010-2025 confirma una narrativa de progresi√≥n y maduraci√≥n del mercado tecnol√≥gico. El √≠ndice QQQ es un activo con potencial de crecimiento extraordinario, como evidencian los retornos anuales acumulados positivos en la mayor√≠a de los a√±os. Sin embargo, es susceptible a episodios de ca√≠das significativas, particularmente cuando se enfrentan cambios estructurales en pol√≠tica monetaria (como en 2022) o shocks sist√©micos (como COVID-19 en 2020). Lo que distingue este per√≠odo de crisis hist√≥ricas anteriores (como la burbuja punto-com) es la rapidez de recuperaci√≥n: mientras que los drawdowns de 2000-2002 tardaron casi una d√©cada en recuperarse completamente, los episodios de 2020 y 2022 se recuperaron en meses a un par de a√±os, reflejando una mayor eficiencia de mercado, mejor comprensi√≥n de valoraciones y una base econ√≥mica m√°s s√≥lida en el sector tecnol√≥gico.

Este comportamiento hace evidente la naturaleza no estacionaria y heteroced√°stica de la serie QQQ, caracterizada por volatilidad que se agrupa en per√≠odos espec√≠ficos de estr√©s macroecon√≥mico. Este patr√≥n justifica el uso de modelos ARIMA para capturar tendencias y din√°micas temporales, y de modelos GARCH para describir la volatilidad condicional que cambia en el tiempo. El drawdown, por tanto, complementa los an√°lisis anteriores al mostrar no solo cu√°n profunda es la ca√≠da del √≠ndice, sino tambi√©n cu√°nto tiempo tarda en recuperarse‚Äîun factor cr√≠tico en la gesti√≥n del riesgo financiero y fundamental para cualquier evaluaci√≥n prospectiva del desempe√±o de este instrumento.

## 3.9 M√©tricas Financieras 

```{r metrics_financieras, echo=TRUE, warning=FALSE, message=FALSE}

cagr <- Return.annualized(ret_diario, scale = 252)
cumulative_return <- Return.cumulative(ret_diario)

sharpe_annual <- (mean(ret_diario, na.rm=TRUE) / sd(ret_diario, na.rm=TRUE)) * sqrt(252)
sortino <- SortinoRatio(ret_diario, MAR = 0)
max_dd <- maxDrawdown(ret_diario)

calmar <- as.numeric(cagr) / abs(as.numeric(max_dd))

metrics <- data.frame(
  M√©trica = c("CAGR (anual)", "Retorno acumulado", "Sharpe (aprx anual)", 
              "Sortino", "Max Drawdown", "Calmar"),
  Valor = c(
    scales::percent(as.numeric(cagr), accuracy = 0.01),
    scales::percent(as.numeric(cumulative_return), accuracy = 0.01),
    round(as.numeric(sharpe_annual), 3),
    round(as.numeric(sortino), 3),
    scales::percent(as.numeric(max_dd), accuracy = 0.1),
    round(as.numeric(calmar), 3)
  ),
  stringsAsFactors = FALSE
)

knitr::kable(metrics, format = "html", table.attr = "class='table' style='width:60%; margin:auto;'")
```

El presente conjunto de M√©tricas Financieras ofrece una visi√≥n sint√©tica y cuantitativa de la eficiencia, el riesgo y el rendimiento agregado del QQQ durante el per√≠odo 2010-2025, complementando de manera cr√≠tica los an√°lisis de retornos anuales y drawdown hist√≥rico.

El **Retorno Acumulado de 852.76%** y la **Tasa de Crecimiento Anual Compuesto (CAGR) de 15.23%** validan el extraordinario potencial de apreciaci√≥n del activo, una caracter√≠stica consistente con la fase de crecimiento sostenido del sector tecnol√≥gico observada durante este per√≠odo. Estas cifras de rendimiento total confirman que, a pesar de los episodios de riesgo extremo como la correcci√≥n de 2022, el QQQ posee una capacidad sustancial y demostrada para generar riqueza a largo plazo. Un inversor que hubiera mantenido posici√≥n durante los 15 a√±os habr√≠a multiplicado su capital m√°s de 9 veces.

Sin embargo, las m√©tricas ajustadas al riesgo revelan informaci√≥n m√°s matizada sobre la eficiencia del rendimiento. El **Ratio de Sharpe de 0.789** es razonablemente bueno, situ√°ndose en el rango 0.5-1.0 considerado aceptable a bueno. Esto sugiere que el QQQ ha generado retorno excesivo en proporci√≥n moderada a la volatilidad asumida. A diferencia de per√≠odos hist√≥ricos que incluyen la burbuja punto-com, el per√≠odo 2010-2025 muestra una eficiencia riesgo-ajustada decente, indicando que los retornos no han sido completamente consumidos por la dispersi√≥n.

M√°s revelador a√∫n es el **Ratio de Sortino de 0.069**, que espec√≠ficamente penaliza el riesgo de cola negativo (downside risk). Un valor tan bajo indica que el riesgo de ca√≠da ha sido desproporcionadamente alto en relaci√≥n con el rendimiento generado. Este hallazgo se alinea directamente con los eventos identificados en los an√°lisis de drawdown, particularmente el colapso de -39.0% en 2022. El Sortino bajo refleja que aunque el QQQ sube mucho en per√≠odos alcistas, tambi√©n cae profundamente en per√≠odos de estr√©s, lo que penaliza a inversores con baja tolerancia al downside.

El indicador de riesgo extremo, el **Max Drawdown de 39.0%**, es significativo pero no catastr√≥fico comparado con crisis hist√≥ricas. Esta cifra es la manifestaci√≥n cuantitativa del ajuste de valoraciones provocado por el ciclo de aumentos de tasas de 2022, y subraya que aunque el sector tecnol√≥gico es resiliente, sigue siendo sensible a cambios estructurales en pol√≠tica monetaria. Desde la perspectiva de la gesti√≥n de riesgo, este valor define el peor escenario del per√≠odo 2010-2025. No obstante, el time to recovery fue mucho m√°s r√°pido que en crisis pasadas: de -39% en 2022 a recuperaci√≥n parcial en 2023-2024, demostrando mayor eficiencia de mercado.

Finalmente, el **Ratio Calmar de 0.39** relaciona el rendimiento anualizado (15.23%) con el Max Drawdown (39.0%). Un valor de 0.39, aunque moderado (el umbral de "bueno" es 0.5), es coherente con un activo que gener√≥ rendimiento significativo pero experiment√≥ correcciones profundas. Si 2022 no hubiera ocurrido, el Calmar ser√≠a m√°s alto. Este ratio sugiere que existen oportunidades para mejorar la eficiencia riesgo-ajustada mediante diversificaci√≥n adicional o estrategias defensivas durante ciclos de endurecimiento monetario.

En conclusi√≥n, el an√°lisis de las m√©tricas confirma una narrativa de progresi√≥n: el QQQ ofrece potencial de crecimiento extraordinario, evidenciado por el CAGR de 15.23% y retorno acumulado de 852.76%, lo que lo convierte en un activo atractivo para inversores de largo plazo. Sin embargo, lo hace asumiendo un costo de riesgo moderado-alto, manifestado en el Max Drawdown de 39.0% y Sortino bajo. Las m√©tricas sugieren que el perfil de riesgo del QQQ est√° caracterizado por volatilidad concentrada en episodios de estr√©s (2022) m√°s que por variabilidad constante. Para inversores con horizonte de 10+ a√±os y tolerancia al riesgo moderada-alta, el perfil riesgo-retorno es favorable; para inversores conservadores u horizontes cortos, requiere consideraciones de hedging o diversificaci√≥n adicional. El modelado y la gesti√≥n de este activo deben necesariamente considerar la asimetr√≠a y la volatilidad heteroced√°stica inherentes a su comportamiento, lo que justifica el uso de modelos GARCH para capturar volatilidad condicional y ARIMA para tendencias.

## 3.10 Volatilidad
```{r rolling_vol, echo=TRUE, warning=FALSE, message=FALSE}

rollsd30  <- rollapply(as.numeric(ret_diario), width = 30, FUN = sd, fill = NA, align = "right")
rollsd90  <- rollapply(as.numeric(ret_diario), width = 90, FUN = sd, fill = NA, align = "right")
rollsd252 <- rollapply(as.numeric(ret_diario), width = 252, FUN = sd, fill = NA, align = "right")

df_roll <- data.frame(
  Fecha = index(ret_diario),
  vol30 = rollsd30 * sqrt(252),
  vol90 = rollsd90 * sqrt(252),
  vol252 = rollsd252 * sqrt(252)
)

dfm <- melt(df_roll, id.vars = "Fecha", variable.name = "Window", value.name = "VolAnual")

ggplot(dfm, aes(x = Fecha, y = VolAnual, color = Window)) +
  geom_line(size = 0.8) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 0.1)) +
  labs(title = "Volatilidad Rolling (annualizada)", y = "Vol Annualizada", x = "") +
  scale_color_manual(values = c("vol30" = tesla_pal$primary, "vol90" = tesla_pal$secondary, "vol252" = tesla_pal$text_gray)) +
  theme_tesla()
```

El gr√°fico de volatilidad rolling desagrega temporalmente la cifra est√°tica de riesgo anualizado, proporcionando la evidencia visual definitiva de la heterocedasticidad condicional inherente a la serie del QQQ. Al observar la evoluci√≥n de la desviaci√≥n est√°ndar anualizada en distintas ventanas temporales, se confirma que el riesgo del activo no es constante, sino que exhibe un marcado comportamiento de agrupamiento de volatilidad (volatility clustering): grandes cambios tienden a ser seguidos por grandes cambios, y per√≠odos de calma por calma, validando emp√≠ricamente los postulados de los modelos ARCH/GARCH (Engle, 1982).

La estructura del gr√°fico est√° dominada por dos "reg√≠menes de volatilidad elevada" que se corresponden con los episodios de drawdown m√°ximo identificados en el an√°lisis hist√≥rico. El primer r√©gimen (2010-2012) muestra volatilidad anualizada entre 30-40%, reflejando la incertidumbre residual post-Crisis Financiera. Sin embargo, a diferencia de crisis prolongadas, este per√≠odo se resuelve en 2-3 a√±os. El segundo r√©gimen m√°s severo ocurre durante 2022, donde la volatilidad se mantiene persistentemente elevada alrededor de 30-35%, reflejando el cambio estructural en tasas de inter√©s de la Reserva Federal. En contraste, el pico de 2020 (Pandemia) es extremadamente agudo pero transitorio, con vol30 alcanzando picos superiores al 80% pero recuperaci√≥n acelerada.

La discrepancia entre las ventanas de corto plazo (vol30) y largo plazo (vol252) ofrece una lectura sobre la "tensi√≥n" del mercado. En 2022, la volatilidad de corto plazo oscila con mucha mayor amplitud, se√±alando b√∫squeda de equilibrio ante incertidumbre sobre tasas de inter√©s. Esta sensibilidad valida la hip√≥tesis de duraci√≥n: la concentraci√≥n en activos de crecimiento hace que el QQQ reaccione hipersensiblemente a cambios en pol√≠tica monetaria (Sharpe, 1964).

El per√≠odo 2013-2019 representa un r√©gimen de volatilidad comprimida, con vol252 oscilando entre 12-18%, el m√°s bajo del per√≠odo. A partir de 2023, la volatilidad desciende pero se estabiliza en niveles superiores a 2013-2019 (17-22%), sugiriendo que el mercado opera bajo una nueva estructura de riesgo base m√°s elevada, coherente con la mayor concentraci√≥n en mega-caps.

En conclusi√≥n, este gr√°fico demuestra que la "volatilidad media" es una m√©trica enga√±osa para el QQQ, ya que el inversor rara vez experimenta el promedio; en su lugar, el activo transita entre largos per√≠odos de volatilidad moderada y explosiones de riesgo extremo. Esta din√°mica bimodal justifica plenamente la necesidad de modelos GARCH para capturar heterocedasticidad condicional (Mandelbrot, 1963; Bollerslev, 1986).

## 4 Estacionalidad Mensual del QQQ (2010‚Äì2025)

```{r heatmap_estacional_mejor, echo=TRUE, warning=FALSE, message=FALSE}
df_m <- data.frame(Fecha = index(ret_mensual), Ret = as.numeric(ret_mensual))
df_m <- df_m %>% mutate(A√±o = lubridate::year(Fecha), Mes = lubridate::month(Fecha, label = TRUE, abbr = TRUE), RetP = Ret*100)
tabla_m <- df_m %>% group_by(A√±o, Mes) %>% summarise(RetP = mean(RetP, na.rm = TRUE))
ggplot(tabla_m, aes(x = Mes, y = factor(A√±o), fill = RetP)) +
  geom_tile(color = "white") +
  scale_fill_viridis_c(option = "C", direction = 1, name = "Ret (%)") +
  labs(title = "Heatmap Estacional Mensual (QQQ)") +
  theme_tesla()
```

El mapa de calor estacional ofrece una deconstrucci√≥n granular de la din√°mica temporal del QQQ durante 2010-2025, permitiendo identificar patrones de estacionalidad e inercia que quedan ocultos en las m√©tricas anualizadas. La visualizaci√≥n confirma que la trayectoria del activo no es aleatoria, sino que exhibe una marcada dependencia serial: los retornos positivos (tonos naranjas y amarillos) tienden a agruparse en bloques temporales definidos, validando visualmente la presencia de reg√≠menes de mercado persistentes (Jegadeesh & Titman, 1993).

Durante 2010-2019, la d√©cada de crecimiento sostenido se manifiesta como un bloque predominantemente c√°lido (tonos naranja), caracterizado por una notable consistencia en retornos positivos mensuales. Esta fase visualiza la era dorada tecnol√≥gica impulsada por pol√≠tica monetaria acomodaticia y expansi√≥n de plataformas digitales. Sin embargo, el heatmap revela una anomal√≠a estacional importante: el "Efecto Septiembre". Observando la columna del noveno mes, se aprecia una recurrencia de tonos m√°s oscuros (a√±os 2011, 2015, 2018, 2022), sugiriendo una debilidad estacional estructural en el sector tecnol√≥gico, consistente con literatura sobre anomal√≠as de calendario y rebalanceo de portafolios institucionales (Thaler, 1987).

El per√≠odo 2020 muestra una alternancia violenta. Marzo inicia con tonos oscuros (shock COVID), seguido de recuperaci√≥n verde/amarilla agresiva a partir de abril. Este patr√≥n refleja la digitalizaci√≥n acelerada de la econom√≠a durante confinamiento, que benefici√≥ directamente activos tecnol√≥gicos. Enero tambi√©n aparece consistentemente con tonos c√°lidos a lo largo del per√≠odo, en l√≠nea con el "Efecto Enero" documentado en mercados de renta variable.

La correcci√≥n de tasas de 2022 produce un patr√≥n distintivo: el a√±o aparece como un "tablero de ajedrez" con meses alternados de p√©rdidas (morado/azul en abril, junio, septiembre, octubre) e intentos de recuperaci√≥n. Septiembre de 2022 es particularmente oscuro, validando el efecto estacional negativo combinado con presiones macroecon√≥micas de pol√≠tica monetaria restrictiva.

La recuperaci√≥n de 2023-2024, visible en las franjas superiores naranjas, confirma la resiliencia del √≠ndice y su capacidad para retomar momentum alcista tras per√≠odos de ajuste. Noviembre y diciembre hist√≥ricos tambi√©n muestran colores c√°lidos frecuentes, coherentes con el efecto fin de a√±o y rebalanceo pre-navide√±o.

En conjunto, el heatmap demuestra que el riesgo del QQQ no se distribuye uniformemente a lo largo del a√±o, sino que se concentra en ventanas espec√≠ficas. Septiembre emerge como mes vulnerables, mientras enero, noviembre y diciembre exhiben sesgo alcista recurrente. Esta estructura estacional tiene relevancia limitada para pron√≥sticos ARIMA de frecuencia diaria (como en este an√°lisis), pero es importante para decisiones de asignaci√≥n t√°ctica o rebalanceo de portafolios en horizonte mensual.



```{r comparacion, echo=TRUE, eval=TRUE, warning=FALSE, message=FALSE}

tesla_pal <- list(
  primary = "#cc0000",
  secondary = "#000000",
  text_main = "#333333",
  text_gray = "#666666"
)
theme_tesla <- function() {
  theme_minimal(base_family = "Inter") +
    theme(
      plot.title = element_text(face = "bold", size = 16, color = tesla_pal$text_main),
      plot.subtitle = element_text(size = 11, color = tesla_pal$text_gray, margin = margin(b = 15)),
      legend.position = "none",
      panel.grid.minor = element_blank(),
      panel.grid.major.x = element_blank(),
      panel.grid.major.y = element_line(color = "#e5e5e5", linetype = "dashed"),
      axis.text = element_text(color = tesla_pal$text_gray),
      axis.title = element_text(color = tesla_pal$text_gray, size = 10)
    )
}

tickers <- c("QQQ", "SPY", "DIA", "IWM")
nombres_map <- c(
  "QQQ" = "QQQ (Nasdaq-100)",
  "SPY" = "SPY (S&P 500)",
  "DIA" = "DIA (Dow Jones)",
  "IWM" = "IWM (Small Caps)"
)

datos_comp <- tq_get(tickers, get = "stock.prices", from = "1999-05-01")
datos_norm <- datos_comp %>%
  group_by(symbol) %>%
  mutate(
    Retorno_Acum = (adjusted / first(adjusted)) - 1,
    Nombre = nombres_map[symbol]
  ) %>%
  ungroup()

colores_comp <- c(
  "QQQ" = tesla_pal$primary,   
  "SPY" = "#2c3e50",           
  "DIA" = "#7f8c8d",        
  "IWM" = "#f39c12"            
)

p_comp <- ggplot(datos_norm, aes(x = date, y = Retorno_Acum, color = symbol)) +
  geom_line(aes(size = symbol, alpha = symbol)) +
  
  scale_color_manual(values = colores_comp, labels = nombres_map) +
  scale_size_manual(values = c("QQQ" = 1.2, "SPY" = 0.6, "DIA" = 0.6, "IWM" = 0.6), guide="none") +
  scale_alpha_manual(values = c("QQQ" = 1, "SPY" = 0.7, "DIA" = 0.7, "IWM" = 0.6), guide="none") +
  
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  
  labs(
    title = "QQQ vs El Mercado",
    subtitle = "Rendimiento acumulado comparativo (2010 - Presente)",
    x = "",
    y = "Retorno Acumulado"
  ) +
  theme_tesla()

plotly::ggplotly(p_comp, tooltip = c("x", "y", "colour")) %>%
  layout(
    legend = list(
      orientation = "h", 
      x = 0.5, 
      xanchor = "center",
      y = 1.05,
      title = list(text = "")
    ),
    hovermode = "x unified"
  ) %>%
  config(displayModeBar = FALSE)
```

La comparaci√≥n normalizada del retorno acumulado entre el QQQ (Nasdaq-100) y los principales √≠ndices de referencia ‚ÄîSPY (S&P 500), DIA (Dow Jones Industrial Average) e IWM (Russell 2000 / Small Caps) durante el per√≠odo 2010-2025 evidencia un desacople estructural en la generaci√≥n de valor burs√°til. Visualmente, la trayectoria del QQQ (l√≠nea roja prominente) se separa del cl√∫ster de mercado general a partir de 2015, confirmando que la exposici√≥n al factor tecnol√≥gico ha funcionado como el motor primario de apreciaci√≥n de capital en la econom√≠a moderna.

El per√≠odo 2010-2014 muestra un desempe√±o relativo moderado del QQQ frente a SPY y DIA, con trayectorias aproximadamente paralelas. Este comportamiento refleja que en la fase inicial de recuperaci√≥n post-Crisis Financiera, los diferentes sectores generaron retornos homog√©neos bajo est√≠mulo monetario expansivo. El IWM, aunque presente, mostr√≥ sensibilidad mayor a la volatilidad c√≠clica.

La verdadera bifurcaci√≥n se consolida post-2015 y se acelera verticalmente tras el shock pand√©mico de 2020. El QQQ se dispara mientras el IWM lucha por mantener el ritmo, penalizado por el entorno de altas tasas de inter√©s que afecta desproporcionadamente a empresas de menor capitalizaci√≥n. El SPY y DIA crecen consistentemente pero a ritmo inferior, reflejando que la diluci√≥n del factor tecnol√≥gico en √≠ndices amplios limita su exposici√≥n al crecimiento acelerado de mega-caps.

La brecha masiva visible en 2025, donde el retorno acumulado del QQQ alcanza niveles significativamente superiores (852.76%) frente a SPY y DIA (aproximadamente 400-500%), demuestra la eficiencia superior de la concentraci√≥n tecnol√≥gica durante per√≠odos de expansi√≥n digital e inteligencia artificial. Este desempe√±o diferencial no es aleatorio, sino consecuencia directa de la estructura del QQQ: 53.6% en Tecnolog√≠a, frente a ~30% del SPY, y <5% del DIA.

En conclusi√≥n, el gr√°fico ratifica que el QQQ no es un sustituto del mercado general, sino un veh√≠culo de crecimiento agresivo. Su desempe√±o superior a largo plazo frente al SPY y al DIA justifica su inclusi√≥n en portafolios que buscan maximizaci√≥n de capital. Sin embargo, como se document√≥ en an√°lisis previos, esta superior generaci√≥n de retorno viene acompa√±ada por volatilidad y drawdowns sistem√°ticamente superiores (39.0% m√°ximo vs ~27% para SPY). El inversor en QQQ asume expl√≠citamente una postura factorial hacia la tecnolog√≠a, aceptando mayor riesgo idiosincr√°tico a cambio de participaci√≥n en el crecimiento de la "nueva econom√≠a" (Fama & French, 2015; Sharpe, 1964).

```{r partiion, echo=TRUE, warning=FALSE, message=FALSE}


datos_plot <- data.frame(
  Fecha = index(precios),
  Precio = as.numeric(precios)
)

fecha_corte <- as.Date("2022-10-07")  
fecha_chatgpt <- as.Date("2022-11-30") 

ggplot(datos_plot, aes(x = Fecha, y = Precio)) +
  geom_line(color = tesla_pal$text_gray, alpha = 0.5, size = 0.5) +
    geom_line(data = subset(datos_plot, Fecha >= fecha_corte), 
            aes(x = Fecha, y = Precio), 
            color = tesla_pal$primary, size = 1.2) +
  
  geom_vline(xintercept = as.numeric(fecha_chatgpt), 
             color = "#8e44ad", linetype = "dashed", size = 0.9) +

  annotate("text", x = fecha_chatgpt, y = 320, 
           label = "Lanzamiento\nChatGPT", 
           angle = 90, vjust = -0.8, color = "#8e44ad", fontface="bold") +
  
  labs(
    title = "Impacto del Lanzamiento de ChatGPT",
    subtitle = "El inicio de la tendencia alcista coincide con la aparici√≥n de la IA Generativa",
    x = "", y = "Precio QQQ"
  ) +
  theme_tesla()
```
El gr√°fico visualiza el punto de inflexi√≥n m√°s cr√≠tico en la historia reciente del QQQ, identificando finales de 2022 como el inicio de un cambio de r√©gimen estructural en el mercado tecnol√≥gico. La l√≠nea punteada marca la introducci√≥n p√∫blica de ChatGPT en noviembre de 2022, un evento que coincide con el final de la tendencia bajista de 2022 y el comienzo de una recuperaci√≥n acelerada que ha llevado al √≠ndice a nuevos m√°ximos hist√≥ricos.

Este comportamiento confirma la hip√≥tesis de una ruptura estructural (structural break) en la serie de tiempo. Durante 2022, el QQQ estuvo correlacionado negativamente con tasas de inter√©s e inflaci√≥n, siendo castigado por el ciclo restrictivo de la Reserva Federal. Sin embargo, la aparici√≥n de la Inteligencia Artificial Generativa actu√≥ como un shock tecnol√≥gico ex√≥geno que desacopl√≥ al √≠ndice de las presiones macroecon√≥micas tradicionales. La pendiente agresiva de la recuperaci√≥n post-noviembre 2022 refleja un repricing masivo de valoraciones, impulsado por la expectativa de que la IA provocar√° un aumento en la productividad corporativa comparable a revoluciones tecnol√≥gicas previas (Eloundou et al., 2023).

Esta narrativa explica la aceleraci√≥n visible entre 2023-2025, el QQQ ha generado retornos extraordinarios mientras la econom√≠a real permaneci√≥ bajo presi√≥n de altas tasas. El desacople es precisamente lo que cabr√≠a esperar si el mercado antecipase beneficios de largo plazo de la IA, independientes de ciclos macroecon√≥micos de corto plazo. La hegemon√≠a de NVIDIA (9.33% del portafolio) y Microsoft (7.69%) refuerza esta tesis: ambas empresas son centrales en la infraestructura y aplicaci√≥n de LLMs (Large Language Models).

En consecuencia, el gr√°fico demuestra que el mercado ha transicionado de un esquema de "valoraci√≥n por descuento de flujos" (sensible a tasas) a un esquema de "valoraci√≥n por crecimiento potencial" (sensible a adopci√≥n de IA). Cualquier estrategia de modelado predictivo debe reconocer que el per√≠odo 2023-2025 representa una nueva fase estoc√°stica caracterizada por momentum idiosincr√°tico derivado de la revoluci√≥n de los Grandes Modelos de Lenguaje, distinta de la din√°mica pre-2022. El modelo ARIMA calibrado en esta ventana temporal captura correctamente esta nueva estructura, mientras que su aplicaci√≥n a horizontes muy largos (d√©cadas) estar√≠a sujeta a riesgo de cambio de r√©gimen futuro.

```{r ias, echo=TRUE, eval=TRUE, warning=FALSE, message=FALSE, fig.width=10, fig.height=6}
library(ggplot2)
library(dplyr)
library(lubridate)
library(ggrepel) 
data_cronologia <- data.frame(
  Hito = c(
    "ChatGPT (OpenAI)", 
    "DALL¬∑E 2", "Midjourney v3", "Stable Diffusion", 
    "Nuevo Bing", "Claude (Anthropic)", "GPT-4", "Copilot 365", 
    "Google I/O (AI)", "Llama 2", "Mistral 7B", "DALL¬∑E 3", 
    "Gemini 1.0/Ultra", "Sora (Video)", "Gemini Android", 
    "Claude 3", "Llama 3", "GPT-4o", "PCs Copilot+"
  ),
  Fecha = as.Date(c(
    "2022-11-30", 
    "2022-04-06", "2022-07-25", "2022-08-22", 
    "2023-02-07", "2023-03-14", "2023-03-14", "2023-03-16", 
    "2023-05-10", "2023-07-18", "2023-09-27", "2023-10-19", 
    "2023-12-06", "2024-02-15", "2024-02-08", 
    "2024-03-04", "2024-04-18", "2024-05-13", "2024-05-20"  
  )),
  Categoria = factor(c(
    "EL PUNTO DE INFLEXI√ìN",
    rep("üé® IMAGEN Y VIDEO", 3),
    "üîÑ INTEGRACI√ìN", "üìù TEXTO Y LLMs", "üìù TEXTO Y LLMs", "üîÑ INTEGRACI√ìN",
    "üîÑ INTEGRACI√ìN", "üìù TEXTO Y LLMs", "üìù TEXTO Y LLMs", "üé® IMAGEN Y VIDEO",
    "üìù TEXTO Y LLMs", "üé® IMAGEN Y VIDEO", "üîÑ INTEGRACI√ìN",
    "üìù TEXTO Y LLMs", "üìù TEXTO Y LLMs", "üìù TEXTO Y LLMs", "üîÑ INTEGRACI√ìN"
  ), levels = c("EL PUNTO DE INFLEXI√ìN", "üìù TEXTO Y LLMs", "üé® IMAGEN Y VIDEO", "üîÑ INTEGRACI√ìN")),
  
  Importancia = c(
    "Critico", 
    "Normal", "Normal", "Normal", 
    "Critico", "Normal", "Critico", "Normal",
    "Normal", "Normal", "Normal", "Normal",
    "Critico", "Critico", "Normal",
    "Normal", "Normal", "Critico", "Normal"
  )
)

colores_cat <- c(
  "EL PUNTO DE INFLEXI√ìN" = "#e17055", 
  "üìù TEXTO Y LLMs"       = "#00b894", 
  "üé® IMAGEN Y VIDEO"     = "#06b6d4", 
  "üîÑ INTEGRACI√ìN"        = "#a29bfe"  
)

ggplot(data_cronologia, aes(x = Fecha, y = Categoria, color = Categoria)) +
  geom_line(aes(group = Categoria), size = 1, alpha = 0.3) +
  geom_point(aes(size = Importancia), alpha = 0.9) +
  geom_text_repel(
    aes(label = Hito), 
    size = 3.5, 
    fontface = "bold", 
    box.padding = 0.5,
    point.padding = 0.3,
    force = 2,
    direction = "y",      
    nudge_y = 0.2,        
    segment.color = "grey80"
  ) +
  scale_size_manual(values = c("Critico" = 5, "Normal" = 3), guide = "none") +
  scale_color_manual(values = colores_cat) +
  scale_x_date(date_breaks = "4 months", date_labels = "%b %Y") +
  geom_vline(xintercept = as.Date("2022-10-07"), linetype="dashed", color="#636e72") +
  annotate("text", x = as.Date("2022-10-07"), y = 4.3, label = "Inicio", 
           angle = 90, vjust = -0.5, size = 3, color="#636e72") +
  labs(
    title = "Cronolog√≠a del Boom de la IA Generativa",
    subtitle = "Lanzamientos clave que definieron la tendencia (2022-2024)",
    x = "", y = ""
  ) +
  theme_tesla() +
  theme(
    legend.position = "none",
    axis.text.y = element_text(face = "bold", size = 10),
    panel.grid.major.y = element_line(linetype = "dotted") 
  )
```

El gr√°fico "Cronolog√≠a del Boom de la IA Generativa" ilustra gr√°ficamente c√≥mo ChatGPT lo cambi√≥ todo: su lanzamiento en octubre de 2022 no fue un evento aislado, sino el detonante de una reacci√≥n en cadena que transform√≥ radicalmente el mercado tecnol√≥gico en un lapso extremadamente corto. Como se observa en la l√≠nea de tiempo, desde este punto de inflexi√≥n nacieron y se desplegaron a una velocidad sin precedentes m√∫ltiples nuevas inteligencias artificiales que redefinieron sectores enteros. La r√°pida sucesi√≥n de hitos ‚Äîque abarca desde la evoluci√≥n de LLMs (GPT-4, Claude, Llama) y la generaci√≥n de video (DALL-E 3, Sora), hasta la integraci√≥n profunda en sistemas operativos y productividad (Copilot 365, Gemini Android)‚Äî demuestra una densidad de innovaci√≥n que valida la tesis de un cambio de r√©gimen acelerado.

Esta proliferaci√≥n tecnol√≥gica ha sostenido el momentum del precio del QQQ, validando la concentraci√≥n del portafolio en los proveedores de infraestructura de IA (Microsoft, Google, NVIDIA) observada en las secciones anteriores. A la luz de este hallazgo y del an√°lisis descriptivo exhaustivo realizado, se derivan conclusiones estad√≠sticas fundamentales que condicionan la estrategia de modelado econom√©trico. Primero, la serie hist√≥rica del QQQ exhibe una no estacionariedad marcada y una tendencia exponencial que exige el uso de rendimientos logar√≠tmicos y diferenciaci√≥n. Segundo, la presencia de una curtosis extrema y agrupamientos de volatilidad (volatility clustering) visibles en los gr√°ficos de riesgo confirman que los modelos lineales simples subestimar√°n la probabilidad de eventos de cola, justificando la necesidad de complementar la estimaci√≥n de la media con modelos de volatilidad condicional (GARCH).

Finalmente, bas√°ndose en la evidencia visual y fundamental de la ruptura estructural provocada por la IA Generativa, se define el a√±o 2022 como el punto de inicio para la ventana de entrenamiento del modelo predictivo. Incluir datos anteriores a esta fecha introducir√≠a "ruido" en los par√°metros del modelo, dado que la din√°mica de precios de la d√©cada 2010-2021 respond√≠a a un r√©gimen de tasas cero y expansi√≥n monetaria, estructuralmente distinto al actual entorno de tasas medias e inversi√≥n intensiva en IA. La literatura econom√©trica sobre cambios estructurales (Perron, 1989) sugiere que, tras un shock permanente de esta magnitud, los datos previos pierden capacidad predictiva. Por consiguiente, al restringir la muestra al per√≠odo post-ChatGPT, el modelo capturar√° con mayor fidelidad la inercia (momentum) y la volatilidad espec√≠fica del actual "superciclo de IA", optimizando la precisi√≥n de los pron√≥sticos a corto plazo.

---

# 4. Resultados del Modelo ARIMA

## 4.1 Partici√≥n de Datos

### 4.1.1 Estrategia Train/Test

La aplicaci√≥n de la estrategia de partici√≥n temporal al conjunto de datos del QQQ divide el per√≠odo de an√°lisis (octubre 2022 - presente) en dos subconjuntos contiguos que respetan el orden cronol√≥gico. El punto de divisi√≥n se establece en el 30 de septiembre de 2025, coincidiendo con el cierre del tercer trimestre del a√±o 2025. Esta fecha marca un quiebre administrativo natural en calendarios financieros y evita arbitrariedades en la selecci√≥n del per√≠odo de corte.

El conjunto de entrenamiento comprende observaciones desde el 7 de octubre de 2022 hasta el 30 de septiembre de 2025, proporcionando una base robusta para estimaci√≥n de coeficientes $ARIMA$, mientras que el conjunto de prueba abarca desde el 1 de octubre de 2025 hasta el presente, permitiendo validaci√≥n con un horizonte de pron√≥stico consistente con est√°ndares de an√°lisis de corto plazo en mercados financieros (Hyndman & Athanasopoulos, 2021).

```{r particion-datos, echo=TRUE}
Entrenamiento <- window(Precio, start = "2022-10-07", end="2025-09-30")
Prueba <- window(Precio, start = "2025-10-01")
```

### 4.1.2 Tabla Resumen: Observaciones por Conjunto

```{r particion-tabla, echo=TRUE}
particion_resumen <- data.frame(
  Conjunto = c("Entrenamiento", "Prueba", "Total"),
  Per√≠odo = c(
    "07-Oct-2022 ‚Üí 30-Sep-2025",
    "01-Oct-2025 ‚Üí Presente",
    "07-Oct-2022 ‚Üí Presente"
  ),
  `Observaciones` = c(
    length(Entrenamiento),
    length(Prueba),
    length(Entrenamiento) + length(Prueba)
  ),
  Porcentaje = c(
    paste0(round(length(Entrenamiento)/(length(Entrenamiento)+length(Prueba))*100, 1), "%"),
    paste0(round(length(Prueba)/(length(Entrenamiento)+length(Prueba))*100, 1), "%"),
    "100%"
  ),
  Prop√≥sito = c(
    "Estimaci√≥n y validaci√≥n de modelo",
    "Evaluaci√≥n de capacidad predictiva",
    ""
  )
)

kable(particion_resumen,
      caption = "Resumen de Partici√≥n de Datos: Entrenamiento vs Prueba",
      align = c("l", "c", "c", "c", "l")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(3, bold = TRUE, color = qqq_pal$positive) %>%
  row_spec(3, bold = TRUE, background = "#e8f5e9", color = qqq_pal$text_dark)
```

El conjunto de entrenamiento contiene 747 observaciones diarias (aproximadamente 3 a√±os de negociaci√≥n), representando el 95% del total de datos disponibles. Este volumen es m√°s que suficiente para identificar par√°metros confiables de un modelo $ARIMA$ de complejidad moderada. El conjunto de prueba contiene 45 observaciones (aproximadamente 9 semanas de actividad burs√°til), permitiendo validaci√≥n con horizonte de pron√≥stico de al menos 10 d√≠as h√°biles conforme lo requiere el an√°lisis.

### 4.1.3 Visualizaci√≥n: Serie con Partici√≥n 

```{r grafico-particion, echo=TRUE, fig.height=6.5}
df_train <- data.frame(
  Fecha = index(Entrenamiento),
  Precio = as.numeric(Entrenamiento),
  Conjunto = "Entrenamiento"
)

df_test <- data.frame(
  Fecha = index(Prueba),
  Precio = as.numeric(Prueba),
  Conjunto = "Prueba"
)

df_completo <- bind_rows(df_train, df_test)
fecha_corte <- as.Date("2025-10-01")

ggplot(df_completo, aes(x = Fecha, y = Precio)) +
  geom_ribbon(data = df_train, 
              aes(ymin = min(df_completo$Precio) * 0.95, ymax = Precio),
              fill = qqq_pal$primary, alpha = 0.08) +
  geom_ribbon(data = df_test, 
              aes(ymin = min(df_completo$Precio) * 0.95, ymax = Precio),
              fill = qqq_pal$secondary, alpha = 0.15) +
  geom_line(data = df_train, color = qqq_pal$primary, linewidth = 0.9) +
  geom_line(data = df_test, color = qqq_pal$secondary, linewidth = 1.1) +
  geom_vline(xintercept = fecha_corte, 
             linetype = "dashed", color = qqq_pal$negative, linewidth = 0.8) +
  annotate("text", x = fecha_corte, y = max(df_completo$Precio) * 1.02,
           label = "Corte: 01-Oct-2025", hjust = -0.05, vjust = 0,
           color = qqq_pal$negative, fontface = "bold", size = 3.5) +
  annotate("label", 
           x = as.Date("2024-01-01"), 
           y = max(df_completo$Precio) * 0.85,
           label = paste0("ENTRENAMIENTO\n", nrow(df_train), " observaciones"),
           fill = qqq_pal$primary, color = "white", 
           fontface = "bold", size = 3.5, label.padding = unit(0.5, "lines")) +
  annotate("label", 
           x = max(df_test$Fecha) - 10,
           y = min(df_completo$Precio) * 1.15,
           label = paste0("PRUEBA\n", nrow(df_test), " obs."),
           fill = qqq_pal$secondary, color = "white", 
           fontface = "bold", size = 3.2, label.padding = unit(0.4, "lines")) +
  scale_x_date(date_breaks = "4 months", date_labels = "%b %Y",
               expand = expansion(mult = c(0.02, 0.05))) +
  scale_y_continuous(labels = dollar_format(prefix = "$"),
                     expand = expansion(mult = c(0.05, 0.08))) +
  labs(
    title = "Partici√≥n de Datos: Entrenamiento vs Prueba",
    subtitle = "QQQ (Nasdaq-100 ETF) | Serie de precios de cierre diarios",
    x = NULL,
    y = "Precio de Cierre (USD)",
    caption = paste0("Fuente: Yahoo Finance | Per√≠odo: ", 
                     min(df_completo$Fecha), " a ", max(df_completo$Fecha))
  ) +
  theme_QQQ() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

---

## 4.2 An√°lisis de Estacionariedad

La serie de precios del QQQ exhibe visualmente una tendencia alcista pronunciada con fluctuaciones amplias alrededor de una trayectoria creciente durante el per√≠odo de entrenamiento (octubre 2022 - septiembre 2025). El gr√°fico de autocorrelaci√≥n de la serie en niveles revela el s√≠ntoma cl√°sico de no-estacionariedad:

```{r acf-original, echo=TRUE, fig.height=5.5}
acf_data <- acf(Entrenamiento, lag.max = 30, plot = FALSE)

df_acf <- data.frame(
  Lag = acf_data$lag[-1], 
  ACF = acf_data$acf[-1]
)

n <- length(Entrenamiento)
limite_sup <- qnorm(0.975) / sqrt(n)
limite_inf <- -limite_sup

ggplot(df_acf, aes(x = Lag, y = ACF)) +
  geom_segment(aes(xend = Lag, yend = 0), 
               color = qqq_pal$primary, linewidth = 0.8) +
  geom_point(color = qqq_pal$primary, size = 2) +
  geom_hline(yintercept = limite_sup, linetype = "dashed", 
             color = qqq_pal$secondary, linewidth = 0.7) +
  geom_hline(yintercept = limite_inf, linetype = "dashed", 
             color = qqq_pal$secondary, linewidth = 0.7) +
  geom_hline(yintercept = 0, color = qqq_pal$text_gray, linewidth = 0.5) +
  annotate("rect", xmin = -Inf, xmax = Inf, 
           ymin = limite_inf, ymax = limite_sup,
           fill = qqq_pal$secondary, alpha = 0.1) +
  annotate("label", x = 20, y = 0.5,
           label = "Decaimiento lento\n‚Üí Serie NO estacionaria",
           fill = qqq_pal$negative, color = "white",
           fontface = "bold", size = 3.5, label.padding = unit(0.5, "lines")) +
  scale_x_continuous(breaks = seq(0, 30, 5)) +
  scale_y_continuous(limits = c(-0.1, 1.05), breaks = seq(0, 1, 0.25)) +
  labs(
    title = "Funci√≥n de Autocorrelaci√≥n (ACF) - Serie en Niveles",
    subtitle = "QQQ: Precio de cierre | Datos de entrenamiento",
    x = "Rezago (Lag)",
    y = "Autocorrelaci√≥n",
    caption = "Bandas azules: L√≠mites de significancia al 95%"
  ) +
  theme_QQQ()
```

La autocorrelaci√≥n muestral permanece elevada (>0.85) incluso en rezagos distantes (lag 30). Este decaimiento lento es indicador cl√°sico de que la serie contiene ra√≠z unitaria y requiere diferenciaci√≥n. Adicionalmente, casi todos los rezagos caen fuera de las bandas de confianza, confirmando correlaci√≥n sistem√°tica estructural.

### 4.2.2 Contraste Estad√≠stico: Test de Dickey-Fuller Aumentado (ADF)

```{r adf-original, echo=TRUE}
adf_resultado <- adf.test(Entrenamiento)

tabla_adf <- data.frame(
  M√©trica = c("Estad√≠stico Dickey-Fuller", 
              "Orden de Rezagos (Lag)", 
              "P-valor",
              "Nivel de Significancia (Œ±)",
              "Conclusi√≥n"),
  Valor = c(round(adf_resultado$statistic, 4),
            adf_resultado$parameter,
            round(adf_resultado$p.value, 4),
            "0.05",
            ifelse(adf_resultado$p.value > 0.05, 
                   "Serie NO estacionaria", "Serie estacionaria ‚úì"))
)

kable(tabla_adf, 
      caption = "Prueba de Dickey-Fuller Aumentada (ADF) - Serie en Niveles",
      align = c("l", "c")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  row_spec(3, bold = TRUE, color = qqq_pal$negative, background = "#ffe8e0") %>% 
  row_spec(5, bold = TRUE, background = "#fef3f2", color = qqq_pal$text_dark)
```

Con p-valor de 0.1352 > 0.05, no se rechaza la hip√≥tesis nula: la serie de precios del QQQ en niveles es no-estacionaria. Esta evidencia estad√≠stica justifica la aplicaci√≥n de diferenciaci√≥n.

### 4.2.3 Aplicaci√≥n de Diferenciaci√≥n de Primer Orden

```{r diferenciacion, echo=TRUE}
dif_Entrenamiento <- diff(Entrenamiento) %>% na.omit()
```

```{r grafico-diferenciada, echo=TRUE, fig.height=6}
df_diff <- data.frame(
  Fecha = index(dif_Entrenamiento),
  Valor = as.numeric(dif_Entrenamiento)
)

ggplot(df_diff, aes(x = Fecha, y = Valor)) +
  geom_line(color = qqq_pal$secondary, linewidth = 0.6) +
  geom_hline(yintercept = 0, linetype = "dashed", 
             color = qqq_pal$primary, linewidth = 0.7) +
  annotate("label", 
           x = as.Date("2023-06-01"), 
           y = max(df_diff$Valor) * 0.85,
           label = paste0("Media ‚âà ", round(mean(df_diff$Valor), 3)),
           fill = qqq_pal$primary, color = "white",
           fontface = "bold", size = 3.5, label.padding = unit(0.4, "lines")) +
  scale_x_date(date_breaks = "4 months", date_labels = "%b %Y",
               expand = expansion(mult = c(0.02, 0.03))) +
  scale_y_continuous(labels = scales::dollar_format(prefix = "$"),
                     expand = expansion(mult = c(0.05, 0.08))) +
  labs(
    title = "Serie Diferenciada de Primer Orden (d = 1)",
    subtitle = "QQQ: Cambios diarios en precio de cierre | Datos de entrenamiento",
    x = NULL,
    y = "Cambio Diario (USD)",
    caption = paste0("Observaciones: ", nrow(df_diff), 
                     " | Per√≠odo: ", min(df_diff$Fecha), " a ", max(df_diff$Fecha))
  ) +
  theme_QQQ() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

La serie diferenciada del QQQ oscila alrededor de media aproximadamente cero (0.444), sin tendencia visual evidente. La media permanece relativamente constante a lo largo del per√≠odo, caracter√≠stica fundamental de estacionariedad.

### 4.2.4 Verificaci√≥n Post-Diferenciaci√≥n

```{r acf-diferenciada, echo=TRUE, fig.height=5.5}
acf_diff_data <- acf(dif_Entrenamiento, lag.max = 30, plot = FALSE)

df_acf_diff <- data.frame(
  Lag = acf_diff_data$lag[-1],
  ACF = acf_diff_data$acf[-1]
)

n_diff <- length(dif_Entrenamiento)
limite_sup_diff <- qnorm(0.975) / sqrt(n_diff)
limite_inf_diff <- -limite_sup_diff

ggplot(df_acf_diff, aes(x = Lag, y = ACF)) +
  geom_segment(aes(xend = Lag, yend = 0), 
               color = qqq_pal$secondary, linewidth = 0.8) +
  geom_point(color = qqq_pal$secondary, size = 2) +
  geom_hline(yintercept = limite_sup_diff, linetype = "dashed", 
             color = qqq_pal$primary, linewidth = 0.7) +
  geom_hline(yintercept = limite_inf_diff, linetype = "dashed", 
             color = qqq_pal$primary, linewidth = 0.7) +
  geom_hline(yintercept = 0, color = qqq_pal$text_gray, linewidth = 0.5) +
  annotate("rect", xmin = -Inf, xmax = Inf, 
           ymin = limite_inf_diff, ymax = limite_sup_diff,
           fill = qqq_pal$primary, alpha = 0.1) +
  annotate("label", x = 22, y = 0.12,
           label = "Autocorrelaciones dentro\nde bandas ‚Üí Estacionaria ‚úì",
           fill = qqq_pal$positive, color = "white",
           fontface = "bold", size = 3.5, label.padding = unit(0.5, "lines")) +
  scale_x_continuous(breaks = seq(0, 30, 5)) +
  scale_y_continuous(limits = c(-0.15, 0.2), breaks = seq(-0.1, 0.2, 0.05)) +
  labs(
    title = "Funci√≥n de Autocorrelaci√≥n (ACF) - Serie Diferenciada",
    subtitle = "QQQ: Cambios diarios | Verificaci√≥n de estacionariedad post-diferenciaci√≥n",
    x = "Rezago (Lag)",
    y = "Autocorrelaci√≥n",
    caption = "Bandas verdes: L√≠mites de significancia al 95%"
  ) +
  theme_QQQ()
```

La mayor√≠a de autocorrelaciones caen dentro de las bandas de confianza. Este contraste dram√°tico con el $ACF$ de la serie original en niveles valida la diferenciaci√≥n.

```{r adf-diferenciada, echo=TRUE}
adf_diff_resultado <- adf.test(dif_Entrenamiento)

tabla_adf_diff <- data.frame(
  M√©trica = c("Estad√≠stico Dickey-Fuller", 
              "Orden de Rezagos (Lag)", 
              "P-valor",
              "Conclusi√≥n"),
  Valor = c(round(adf_diff_resultado$statistic, 4),
            adf_diff_resultado$parameter,
            round(adf_diff_resultado$p.value, 4),
            ifelse(adf_diff_resultado$p.value < 0.05,
                   "Serie ES estacionaria ‚úì",
                   "Serie NO estacionaria"))
)

kable(tabla_adf_diff, 
      caption = "Prueba de Dickey-Fuller Aumentada (ADF) - Serie Diferenciada (d=1)",
      align = c("l", "c")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  row_spec(3, bold = TRUE, color = qqq_pal$positive, background = "#e8f5e9") %>%
  row_spec(4, bold = TRUE, background = "#d4edda", color = qqq_pal$text_dark)
```

El estad√≠stico ADF de -8.6831 es altamente negativo, muy inferior al valor cr√≠tico de -3.43. Con p-valor de 0.01 < 0.05, se rechaza $H_0$. La serie diferenciada del QQQ es estacionaria. Por tanto, el par√°metro de integraci√≥n es $d=1$: una √∫nica diferenciaci√≥n convierte la serie de precios en una serie estacionaria de cambios diarios.

---

## 4.3 Identificaci√≥n del Modelo

El an√°lisis visual del $ACF$ y $PACF$ de la serie diferenciada del QQQ revela patrones caracter√≠sticos de mercados financieros eficientes:

```{r acf-pacf-dual, echo=TRUE, fig.height=6}
acf_data <- acf(dif_Entrenamiento, lag.max = 28, plot = FALSE)
pacf_data <- pacf(dif_Entrenamiento, lag.max = 28, plot = FALSE)

df_acf <- data.frame(
  Lag = as.numeric(acf_data$lag[-1]),
  Valor = as.numeric(acf_data$acf[-1])
)

df_pacf <- data.frame(
  Lag = as.numeric(pacf_data$lag),
  Valor = as.numeric(pacf_data$acf)
)

n <- length(dif_Entrenamiento)
limite <- qnorm(0.975) / sqrt(n)

p_acf <- ggplot(df_acf, aes(x = Lag, y = Valor)) +
  geom_hline(yintercept = 0, color = qqq_pal$text_gray, linewidth = 0.5) +
  geom_hline(yintercept = c(-limite, limite), linetype = "dashed", 
             color = qqq_pal$secondary, linewidth = 0.6) +
  annotate("rect", xmin = -Inf, xmax = Inf, ymin = -limite, ymax = limite,
           fill = qqq_pal$secondary, alpha = 0.08) +
  geom_segment(aes(xend = Lag, yend = 0), color = qqq_pal$primary, linewidth = 0.7) +
  geom_point(color = qqq_pal$primary, size = 1.5) +
  scale_x_continuous(breaks = seq(0, 28, 5)) +
  scale_y_continuous(limits = c(-0.15, 0.12)) +
  labs(title = "ACF - Serie Diferenciada",
       subtitle = "Identificaci√≥n del orden q (MA)",
       x = "Rezago (Lag)",
       y = "ACF") +
  theme_QQQ() +
  theme(plot.title = element_text(size = 12))

p_pacf <- ggplot(df_pacf, aes(x = Lag, y = Valor)) +
  geom_hline(yintercept = 0, color = qqq_pal$text_gray, linewidth = 0.5) +
  geom_hline(yintercept = c(-limite, limite), linetype = "dashed", 
             color = qqq_pal$secondary, linewidth = 0.6) +
  annotate("rect", xmin = -Inf, xmax = Inf, ymin = -limite, ymax = limite,
           fill = qqq_pal$secondary, alpha = 0.08) +
  geom_segment(aes(xend = Lag, yend = 0), color = qqq_pal$primary, linewidth = 0.7) +
  geom_point(color = qqq_pal$primary, size = 1.5) +
  scale_x_continuous(breaks = seq(0, 28, 5)) +
  scale_y_continuous(limits = c(-0.15, 0.12)) +
  labs(title = "PACF - Serie Diferenciada",
       subtitle = "Identificaci√≥n del orden p (AR)",
       x = "Rezago (Lag)",
       y = "PACF") +
  theme_QQQ() +
  theme(plot.title = element_text(size = 12))

grid.arrange(p_acf, p_pacf, ncol = 2)
```

En el $ACF$, la mayor√≠a de autocorrelaciones caen dentro de las bandas de confianza para todos los rezagos hasta lag 28. Esta ausencia sistem√°tica es consistente con la hip√≥tesis de mercado eficiente: los precios incorporan informaci√≥n disponible p√∫blicamente, dejando en los cambios diarios estructura pr√°cticamente aleatoria sin dependencias predecibles (Fama, 1970; Malkiel, 1973).

El $PACF$ exhibe un patr√≥n complementario: nuevamente, la mayor√≠a de autocorrelaciones parciales se ubican dentro de bandas de confianza. En conjunto, el an√°lisis $ACF/PACF$ sugiere que la serie diferenciada es cercana a ruido blanco, implicando que cualquier modelo $ARIMA$ que intente capturar estructura estar√° fundamentalmente limitado en capacidad predictiva, capturando quiz√°s peque√±os componentes de ineficiencia de mercado de corto plazo (Tsay, 2010; Hamilton, 1994).

### 4.3.2 Modelos ARIMA Candidatos

```{r modelos-candidatos-tabla, echo=TRUE}
tabla_candidatos <- data.frame(
  Modelo = c("ARIMA(0,1,0)", 
             "ARIMA(1,1,1)",
             "ARIMA(2,1,1)", 
             "ARIMA(1,1,2)",
             "ARIMA(2,1,2)",
             "ARIMA(3,1,3)"),
  Tipo = c("Random Walk",
           "auto.arima()",
           "Manual",
           "Manual",
           "Manual",
           "Exploratorio"),
  Justificaci√≥n = c(
    "Benchmark: hip√≥tesis de mercado eficiente",
    "Referencia algor√≠tmica para validar selecci√≥n manual",
    "Extensi√≥n AR(2) para capturar persistencia de corto plazo",
    "Extensi√≥n MA(2) para capturar estructura de media m√≥vil",
    "Modelo sim√©trico que combina din√°micas AR y MA",
    "Evaluar si rezagos marginales aportan capacidad predictiva"
  )
)

kable(tabla_candidatos,
      caption = "Modelos ARIMA Candidatos para Evaluaci√≥n",
      align = c("l", "c", "l"),
      col.names = c("Modelo", "Tipo", "Justificaci√≥n")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(2, color = qqq_pal$secondary) %>%
  column_spec(3, width = "30em") %>%
  row_spec(2, background = "#e8f5e9", color = qqq_pal$text_dark, bold = TRUE)
```

La selecci√≥n de estos seis modelos candidatos obedece a una l√≥gica progresiva de complejidad. El $ARIMA(0,1,0)$ (random walk) representa la hip√≥tesis nula de mercado eficiente: no existe estructura explorable. El $ARIMA(1,1,1)$ fue seleccionado autom√°ticamente por `auto.arima()` y es el m√°s parsimonioso que a√±ade estructura genuina. Los dem√°s representan extensiones que exploran si estructura adicional existe en la serie del QQQ.

---

## 4.4 Estimaci√≥n y Comparaci√≥n de Modelos

### 4.4.1 Criterios de Informaci√≥n

```{r ajuste-modelos, echo=TRUE}
ModeloQA <- auto.arima(Entrenamiento)
modeloQ1 <- Arima(Entrenamiento, order = c(3,1,3))
modeloQ2 <- Arima(Entrenamiento, order = c(0,1,0))
modeloQ3 <- Arima(Entrenamiento, order = c(2,1,1))
modeloQ4 <- Arima(Entrenamiento, order = c(1,1,2))
modeloQ5 <- Arima(Entrenamiento, order = c(2,1,2))
```

```{r criterios-informacion, echo=TRUE}
comparacion_IC <- data.frame(
  Modelo = c("ARIMA(0,1,0)", 
             "ARIMA(1,1,1) + drift", 
             "ARIMA(2,1,1)", 
             "ARIMA(1,1,2)",
             "ARIMA(2,1,2)",
             "ARIMA(3,1,3)"),
  Parametros = c(length(coef(modeloQ2)) + 1,
                 length(coef(ModeloQA)) + 1,
                 length(coef(modeloQ3)) + 1,
                 length(coef(modeloQ4)) + 1,
                 length(coef(modeloQ5)) + 1,
                 length(coef(modeloQ1)) + 1),
  AIC = round(c(AIC(modeloQ2), 
                AIC(ModeloQA), 
                AIC(modeloQ3), 
                AIC(modeloQ4),
                AIC(modeloQ5),
                AIC(modeloQ1)), 2),
  AICc = round(c(modeloQ2$aicc, 
                 ModeloQA$aicc, 
                 modeloQ3$aicc, 
                 modeloQ4$aicc,
                 modeloQ5$aicc,
                 modeloQ1$aicc), 2),
  BIC = round(c(BIC(modeloQ2), 
                BIC(ModeloQA), 
                BIC(modeloQ3), 
                BIC(modeloQ4),
                BIC(modeloQ5),
                BIC(modeloQ1)), 2)
)

comparacion_IC <- comparacion_IC %>%
  arrange(AICc) %>%
  mutate(Ranking = row_number()) %>%
  select(Ranking, Modelo, Parametros, AIC, AICc, BIC)

kable(comparacion_IC,
      caption = "Comparaci√≥n de Modelos por Criterios de Informaci√≥n",
      align = c("c", "l", "c", "c", "c", "c"),
      col.names = c("Ranking", "Modelo", "# Par√°metros", "AIC", "AICc", "BIC")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(2, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(5, bold = TRUE, color = qqq_pal$positive) %>%
  row_spec(1, bold = TRUE, background = "#e8f5e9", color = qqq_pal$text_dark) %>%
  footnote(general = "Ordenado por AICc (menor es mejor). AICc es el criterio preferido para muestras finitas.",
           general_title = "Nota: ")
```

El $ARIMA(1,1,1)$ + drift del QQQ emerge como ganador indiscutible con $AICc$ = 4663.94, significativamente menor que $ARIMA(2,1,2)$ (4668.14, ranking 2). La diferencia de 4.2 puntos en $AICc$ es clara, validando $ARIMA(1,1,1)$ como notablemente superior. Seg√∫n Burnham & Anderson (2002), diferencias entre 4-7 indican soporte moderado para modelo superior. El t√©rmino "drift" representa una constante en la ecuaci√≥n de diferencias que captura la tendencia lineal impl√≠cita: durante el per√≠odo de an√°lisis (2022-2025), el $QQQ$ exhibi√≥ movimiento alcista promedio, reflejando optimismo en tecnolog√≠a pese a volatilidad (Brockwell & Davis, 2016).

La evaluaci√≥n de modelos m√°s complejos revela el problema de sobreparametrizaci√≥n: aunque $ARIMA(3,1,3)$ tiene $AIC$ m√°s bajo (4669.04), su $AICc$ es 4669.19 (ranking 6) porque la penalizaci√≥n por 7 par√°metros domina cualquier mejora marginal. El $ARIMA(0,1,0)$ (random walk puro) produce $AICc =$ 4668.39 (ranking 3), confirmando que estructura existe aunque sea peque√±a.

### 4.4.2 M√©tricas de Precisi√≥n en Entrenamiento

```{r metricas-precision, echo=TRUE}
acc_QA <- accuracy(ModeloQA)
acc_Q1 <- accuracy(modeloQ1)
acc_Q2 <- accuracy(modeloQ2)
acc_Q3 <- accuracy(modeloQ3)
acc_Q4 <- accuracy(modeloQ4)
acc_Q5 <- accuracy(modeloQ5)

comparacion_accuracy <- data.frame(
  Modelo = c("ARIMA(0,1,0)", 
             "ARIMA(1,1,1) + drift", 
             "ARIMA(2,1,1)", 
             "ARIMA(1,1,2)",
             "ARIMA(2,1,2)",
             "ARIMA(3,1,3)"),
  ME = round(c(acc_Q2["Training set", "ME"], 
               acc_QA["Training set", "ME"], 
               acc_Q3["Training set", "ME"], 
               acc_Q4["Training set", "ME"],
               acc_Q5["Training set", "ME"],
               acc_Q1["Training set", "ME"]), 4),
  RMSE = round(c(acc_Q2["Training set", "RMSE"], 
                 acc_QA["Training set", "RMSE"], 
                 acc_Q3["Training set", "RMSE"], 
                 acc_Q4["Training set", "RMSE"],
                 acc_Q5["Training set", "RMSE"],
                 acc_Q1["Training set", "RMSE"]), 4),
  MAE = round(c(acc_Q2["Training set", "MAE"], 
                acc_QA["Training set", "MAE"], 
                acc_Q3["Training set", "MAE"], 
                acc_Q4["Training set", "MAE"],
                acc_Q5["Training set", "MAE"],
                acc_Q1["Training set", "MAE"]), 4),
  MAPE = round(c(acc_Q2["Training set", "MAPE"], 
                 acc_QA["Training set", "MAPE"], 
                 acc_Q3["Training set", "MAPE"], 
                 acc_Q4["Training set", "MAPE"],
                 acc_Q5["Training set", "MAPE"],
                 acc_Q1["Training set", "MAPE"]), 4),
  MASE = round(c(acc_Q2["Training set", "MASE"], 
                 acc_QA["Training set", "MASE"], 
                 acc_Q3["Training set", "MASE"], 
                 acc_Q4["Training set", "MASE"],
                 acc_Q5["Training set", "MASE"],
                 acc_Q1["Training set", "MASE"]), 4)
)

comparacion_accuracy <- comparacion_accuracy %>%
  arrange(RMSE) %>%
  mutate(Ranking = row_number()) %>%
  select(Ranking, Modelo, ME, RMSE, MAE, MAPE, MASE)

kable(comparacion_accuracy,
      caption = "M√©tricas de Precisi√≥n sobre Datos de Entrenamiento",
      align = c("c", "l", rep("c", 5))) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(2, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(4, bold = TRUE, color = qqq_pal$positive) %>%
  row_spec(1, background = "#e8f5e9", color = qqq_pal$text_dark, bold = TRUE) %>%
  footnote(general = "ME: Error Medio | RMSE: Ra√≠z del Error Cuadr√°tico Medio | MAE: Error Absoluto Medio | MAPE: Error Porcentual (%) | MASE: Error Escalado",
           general_title = "M√©tricas: ")
```

El Error Medio (ME) de todos los modelos es cercano a cero (rango: -0.0001 a 0.4939), confirmando que son aproximadamente insesgados. El $ARIMA(1,1,1)$ + drift tiene $ME =$ -0.0001, virtualmente perfecto. El $RMSE$ del $ARIMA(3,1,3)$ lidera con 5.4759, marginalmente inferior al $ARIMA(1,1,1)$ + drift (5.4792), una diferencia de 0.0033 negligible en t√©rminos pr√°cticos (0.06% mejora) mientras requiere 75% incremento en par√°metros.

El Error Absoluto Medio (MAE) del $ARIMA(1,1,1)$ + drift es 3.8704: en promedio, predicciones desviaron ¬±3.87 puntos del valor real. El MAPE es 0.9445%, indicando error promedio menos de 1% del valor real. El MASE de todos los modelos es < 1, mejorando al random walk puro. El $ARIMA(1,1,1)$ + drift obtiene $MASE =$ 0.9943, mejorando al random walk en ~0.6%‚Äîen contexto de series financieras eficientes, una mejora significativa (Hyndman & Koehler, 2006).

---

## 4.5 Diagn√≥stico de Residuos

El proceso de diagn√≥stico valida que el modelo $ARIMA(1,1,1)$ + drift seleccionado produce residuos que se comportan como ruido blanco: secuencia aleatoria con media cero, varianza constante, y ausencia de autocorrelaci√≥n.

### 4.5.1 An√°lisis Gr√°fico de Residuos

```{r residuos-grafico, echo=TRUE}
residuos <- residuals(ModeloQA)

df_residuos <- data.frame(
  Fecha = index(residuos),
  Residuo = as.numeric(residuos)
)

p1 <- ggplot(df_residuos, aes(x = Fecha, y = Residuo)) +
  geom_line(color = qqq_pal$secondary, linewidth = 0.5) +
  geom_hline(yintercept = 0, linetype = "dashed", 
             color = qqq_pal$primary, linewidth = 0.7) +
  geom_hline(yintercept = c(-2*sd(df_residuos$Residuo), 2*sd(df_residuos$Residuo)), 
             linetype = "dotted", color = qqq_pal$negative, linewidth = 0.5) +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %Y") +
  labs(title = "Residuos del Modelo en el Tiempo",
       subtitle = "Verificaci√≥n de media cero y varianza constante",
       x = NULL,
       y = "Residuo") +
  theme_QQQ() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

p1
acf_resid <- acf(residuos, lag.max = 25, plot = FALSE)
df_acf_resid <- data.frame(
  Lag = as.numeric(acf_resid$lag[-1]),
  ACF = as.numeric(acf_resid$acf[-1])
)

n_resid <- length(residuos)
limite_resid <- qnorm(0.975) / sqrt(n_resid)

p2 <- ggplot(df_acf_resid, aes(x = Lag, y = ACF)) +
  geom_hline(yintercept = 0, color = qqq_pal$text_gray, linewidth = 0.5) +
  geom_hline(yintercept = c(-limite_resid, limite_resid), linetype = "dashed", 
             color = qqq_pal$primary, linewidth = 0.6) +
  annotate("rect", xmin = -Inf, xmax = Inf, ymin = -limite_resid, ymax = limite_resid,
           fill = qqq_pal$primary, alpha = 0.1) +
  geom_segment(aes(xend = Lag, yend = 0), color = qqq_pal$secondary, linewidth = 0.7) +
  geom_point(color = qqq_pal$secondary, size = 1.5) +
  scale_x_continuous(breaks = seq(0, 25, 5)) +
  scale_y_continuous(limits = c(-0.15, 0.15)) +
  labs(title = "ACF de Residuos",
       subtitle = "Verificaci√≥n de independencia",
       x = "Rezago (Lag)",
       y = "ACF") +
  theme_QQQ()
p2
p3 <- ggplot(df_residuos, aes(x = Residuo)) +
  geom_histogram(aes(y = after_stat(density)), 
                 bins = 35, fill = qqq_pal$primary, 
                 color = "white", alpha = 0.7) +
  geom_density(color = qqq_pal$secondary, linewidth = 1) +
  stat_function(fun = dnorm, 
                args = list(mean = mean(df_residuos$Residuo), 
                            sd = sd(df_residuos$Residuo)),
                color = qqq_pal$negative, linewidth = 1, linetype = "dashed") +
  labs(title = "Distribuci√≥n de Residuos",
       subtitle = "Verificaci√≥n de normalidad",
       x = "Residuo",
       y = "Densidad",
       caption = "L√≠nea roja punteada: distribuci√≥n normal te√≥rica") +
  theme_QQQ()
p3
```

El gr√°fico temporal de residuos exhibe oscilaci√≥n alrededor de media pr√≥xima a cero (0.0001), validando ausencia de sesgo sistem√°tico. La varianza aparece aproximadamente constante, sugiriendo homocedasticidad. El $ACF$ de residuos muestra ausencia de autocorrelaci√≥n significativa: la mayor√≠a caen dentro de bandas de confianza.

El histograma de densidad muestra forma aproximadamente sim√©trica y unimodal, consistente con distribuci√≥n normal. Se observa presencia de "fat tails" (colas pesadas): residuos extremos ocurren con probabilidad ligeramente mayor que lo predicho por normalidad exacta, caracter√≠stica t√≠pica de datos financieros reales (Tsay, 2010).

### 4.5.2 Q-Q Plot de Normalidad

```{r residuos-qq, echo=TRUE}

residuos_std <- scale(residuals(ModeloQA))
df_qq <- data.frame(residuos = residuos_std)

n <- length(residuos_std)
cuantiles_teoricos <- qnorm(ppoints(n))
cuantiles_observados <- sort(residuos_std)
df_qq_line <- data.frame(x = cuantiles_teoricos, y = cuantiles_observados)

fit <- lm(y ~ x, data = df_qq_line)
df_qq_line$fitted <- predict(fit, df_qq_line)

df_qq_puntos <- data.frame(
  x = cuantiles_teoricos,
  y = cuantiles_observados,
  label = paste0(
    "Cuantil te√≥rico: ", round(cuantiles_teoricos, 3), "<br>",
    "Residuo observado: ", round(cuantiles_observados, 3)
  )
)

p_qq <- ggplot() +
  geom_line(data = df_qq_line, aes(x = x, y = fitted), 
            color = qqq_pal$negative, linewidth = 1.1) +
  geom_point(data = df_qq_puntos, aes(x = x, y = y, text = label),
             color = qqq_pal$primary, size = 2.5, alpha = 0.75) +
  labs(
    title = "Q-Q Plot de Residuos Estandarizados",
    subtitle = "Verificaci√≥n de normalidad del modelo | L√≠nea roja = distribuci√≥n normal te√≥rica",
    x = "Cuantiles Te√≥ricos (Distribuci√≥n Normal Est√°ndar)",
    y = "Cuantiles Observados (Residuos Estandarizados)",
    caption = "‚úì Puntos alineados con la l√≠nea roja indican buenos residuos normales"
  ) +
  theme_QQQ() +
  theme(
    plot.title = element_text(size = 13, face = "bold", color = qqq_pal$primary),
    plot.subtitle = element_text(size = 11, color = qqq_pal$text_gray, margin = margin(b = 8)),
    plot.caption = element_text(size = 9, color = qqq_pal$secondary, face = "italic"),
    panel.background = element_rect(fill = "#f8f9fa", color = NA),
    plot.background = element_rect(fill = "white", color = NA),
    axis.line = element_line(color = qqq_pal$text_gray, linewidth = 0.5),
    panel.grid.major = element_line(color = "#e8eef5", linewidth = 0.3),
    panel.grid.minor = element_blank()
  )

plotly::ggplotly(p_qq, tooltip = "text") %>%
  plotly::layout(
    font = list(family = "Arial, sans-serif", size = 11, color = qqq_pal$text_dark),
    plot_bgcolor = "#f8f9fa",
    paper_bgcolor = "white",
    xaxis = list(
      showgrid = TRUE,
      gridwidth = 1,
      gridcolor = "#e8eef5",
      zeroline = FALSE,
      showline = TRUE,
      linewidth = 1,
      linecolor = qqq_pal$text_gray,
      mirror = TRUE
    ),
    yaxis = list(
      showgrid = TRUE,
      gridwidth = 1,
      gridcolor = "#e8eef5",
      zeroline = FALSE,
      showline = TRUE,
      linewidth = 1,
      linecolor = qqq_pal$text_gray,
      mirror = TRUE
    ),
    hovermode = "closest",
    margin = list(l = 60, r = 30, t = 80, b = 60)
  ) %>%
  plotly::config(
    displayModeBar = TRUE,
    displaylogo = FALSE,
    collaborate = FALSE,
    modeBarButtonsToRemove = c("lasso2d", "select2d"),
    toImageButtonOptions = list(
      format = "png",
      filename = "qq_plot_residuos",
      height = 600,
      width = 900,
      scale = 2
    )
  )
```

Se observa alineaci√≥n muy cercana de puntos con la l√≠nea te√≥rica en la regi√≥n central. En las colas (cuantiles extremos), hay desviaci√≥n sistem√°tica indicando presencia de "fat tails". Esta caracter√≠stica no invalida el modelo pero tiene implicaciones para intervalos de confianza: pueden ser ligeramente conservadores en t√©rminos de probabilidades de eventos extremos (Tsay, 2010).

### 4.5.3 Test de Independencia (Ljung-Box)

```{r residuos-tabla, echo=TRUE}
lb_test <- Box.test(residuals(ModeloQA), lag = 10, type = "Ljung-Box")

tabla_ljung <- data.frame(
  M√©trica = c("Estad√≠stico Ljung-Box", 
              "Grados de Libertad", 
              "P-valor",
              "Conclusi√≥n"),
  Valor = c(
    round(lb_test$statistic, 4),
    lb_test$parameter,
    round(lb_test$p.value, 4),
    ifelse(lb_test$p.value > 0.05, 
           "Residuos son ruido blanco ‚úì", 
           "Posible autocorrelaci√≥n residual")
  )
)

kable(tabla_ljung, 
      caption = "Test de Ljung-Box: Independencia de Residuos",
      align = c("l", "c")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  row_spec(4, bold = TRUE, 
           background = ifelse(lb_test$p.value > 0.05, "#e8f5e9", "#ffe8e0"),
           color = qqq_pal$text_dark)
```

El estad√≠stico Ljung-Box de $Q^*$ = 10.1399 con 10 grados de libertad produce p-valor = 0.4283 > 0.05. No se rechaza la hip√≥tesis nula: los residuos no exhiben autocorrelaci√≥n significativa en los primeros 10 rezagos. El $p-valor$ de 0.43 indica que si verdaderamente los residuos fuesen ruido blanco independiente, observar√≠amos una estad√≠stica de prueba tan extrema o m√°s extrema con probabilidad del 43%‚Äîresultado completamente consistente con independencia (Ljung & Box, 1978).

---

## 4.6 Pron√≥stico y Evaluaci√≥n

Una vez validado que el modelo $ARIMA(1,1,1)$ + drift produce residuos que se comportan como ruido blanco, procede la etapa de pron√≥stico: generaci√≥n de predicciones puntuales para el QQQ junto con intervalos de confianza que cuantifican incertidumbre.

```{r pronostico-generacion, echo=TRUE}
pronostico <- forecast(ModeloQA, h = 10, level = 95)

ultima_fecha <- as.Date(index(Entrenamiento)[length(Entrenamiento)])

fechas_pronostico <- c()
fecha_actual <- ultima_fecha
dias_agregados <- 0

while(dias_agregados < 10) {
  fecha_actual <- fecha_actual + 1
  if (!(weekdays(fecha_actual) %in% c("s√°bado", "domingo", "Saturday", "Sunday"))) {
    fechas_pronostico <- c(fechas_pronostico, fecha_actual)
    dias_agregados <- dias_agregados + 1
  }
}

fechas_pronostico <- as.Date(fechas_pronostico, origin = "1970-01-01")
```

### 4.6.1 Tabla de Pron√≥sticos

```{r tabla-pronosticos, echo=TRUE}
tabla_pronostico <- data.frame(
  D√≠a = 1:10,
  Fecha = as.character(fechas_pronostico),
  Pron√≥stico = round(as.numeric(pronostico$mean), 2),
  `L√≠mite Inferior` = round(as.numeric(pronostico$lower), 2),
  `L√≠mite Superior` = round(as.numeric(pronostico$upper), 2),
  `Amplitud IC` = round(as.numeric(pronostico$upper) - as.numeric(pronostico$lower), 2)
)

kable(tabla_pronostico,
      caption = "Pron√≥sticos del Modelo ARIMA(1,1,1) con Drift - Intervalo de Confianza al 95%",
      align = c("c", "c", "c", "c", "c", "c"),
      col.names = c("D√≠a", "Fecha", "Pron√≥stico (USD)", "L√≠m. Inferior", "L√≠m. Superior", "Amplitud IC")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(3, bold = TRUE, color = qqq_pal$primary, background = "#f0f9ff") %>%
  column_spec(4, color = qqq_pal$negative) %>%
  column_spec(5, color = qqq_pal$positive) %>%
  column_spec(6, color = "#666666") %>%
  footnote(general = "IC = Intervalo de Confianza. La amplitud del intervalo aumenta con el horizonte de pron√≥stico.",
           general_title = "Nota: ")
```

Los pron√≥sticos del $ARIMA(1,1,1)$ + drift para los pr√≥ximos 10 d√≠as h√°biles (01-octubre a 14-octubre 2025) se ubican en el rango 600.71 a 604.76 USD. El incremento inicial refleja el drift estimado: una tendencia alcista promedio de Œº ‚âà 0.4-0.5 d√≥lares por d√≠a. La amplitud expansiva de los intervalos de confianza es caracter√≠stica: el IC 95% en el d√≠a 1 tiene amplitud apenas 21.54, pero se expande a 66.01 en el d√≠a 10. Esta expansi√≥n refleja que bajo un $ARIMA(1,1,1)$ con $d=1$, la varianza del pron√≥stico crece aproximadamente como $œÉ¬≤¬∑h$, donde $œÉ¬≤$ es varianza de innovaciones (Hamilton, 1994).

### 4.6.2 Gr√°fico: Pron√≥stico con Intervalo de Confianza

```{r grafico-pronostico, echo=TRUE, fig.height=6.5}
n_historico <- 100
datos_hist <- tail(Entrenamiento, n_historico)

df_historico <- data.frame(
  Fecha = as.Date(index(datos_hist)),
  Precio = as.numeric(datos_hist),
  Tipo = "Hist√≥rico"
)

ultima_fecha <- as.Date(index(Entrenamiento)[length(Entrenamiento)])
fechas_forecast <- ultima_fecha + 1:10

df_pronostico <- data.frame(
  Fecha = fechas_forecast,
  Precio = as.numeric(pronostico$mean),
  Lower = as.numeric(pronostico$lower),
  Upper = as.numeric(pronostico$upper)
)

punto_conexion <- data.frame(
  Fecha = ultima_fecha,
  Precio = as.numeric(tail(datos_hist, 1)),
  Lower = as.numeric(tail(datos_hist, 1)),
  Upper = as.numeric(tail(datos_hist, 1))
)

df_pronostico_completo <- bind_rows(punto_conexion, df_pronostico)

ggplot() +
  geom_ribbon(data = df_pronostico_completo,
              aes(x = Fecha, ymin = Lower, ymax = Upper),
              fill = qqq_pal$secondary, alpha = 0.2) +
  geom_line(data = df_historico,
            aes(x = Fecha, y = Precio),
            color = qqq_pal$primary, linewidth = 0.7) +
  geom_line(data = df_pronostico_completo,
            aes(x = Fecha, y = Precio),
            color = qqq_pal$secondary, linewidth = 0.8) +
  geom_point(data = df_pronostico %>% filter(Fecha == max(Fecha)),
             aes(x = Fecha, y = Precio),
             color = qqq_pal$secondary, size = 2.5) +
  geom_point(data = punto_conexion,
             aes(x = Fecha, y = Precio),
             color = qqq_pal$primary, size = 2.5) +
  geom_vline(xintercept = ultima_fecha, 
             linetype = "dashed", color = qqq_pal$negative, linewidth = 0.5) +
  annotate("label",
           x = min(df_historico$Fecha) + 15,
           y = max(df_historico$Precio, df_pronostico$Upper) * 0.99,
           label = "Entrenamiento",
           fill = qqq_pal$primary, color = "white",
           fontface = "bold", size = 3, label.padding = unit(0.3, "lines")) +
  annotate("label",
           x = max(df_pronostico$Fecha) - 3,
           y = max(df_pronostico$Upper) * 1.01,
           label = "Pron√≥stico",
           fill = qqq_pal$secondary, color = "white",
           fontface = "bold", size = 3, label.padding = unit(0.3, "lines")) +
  scale_x_date(date_breaks = "3 weeks", date_labels = "%d %b",
               expand = expansion(mult = c(0.02, 0.08))) +
  scale_y_continuous(labels = scales::dollar_format(),
                     expand = expansion(mult = c(0.02, 0.05))) +
  labs(title = "Pron√≥stico ARIMA(1,1,1) con Drift",
       subtitle = "QQQ (Nasdaq-100 ETF) | √öltimos 100 d√≠as + 10 d√≠as de pron√≥stico | IC 95%",
       x = NULL,
       y = "Precio de Cierre (USD)",
       caption = "L√≠nea verde: Datos hist√≥ricos | L√≠nea cian: Pron√≥stico | √Årea sombreada: Intervalo de confianza 95%") +
  theme_QQQ() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### 4.6.3 Evaluaci√≥n Comparativa: Predicho vs Real

```{r predicho-vs-real, echo=TRUE, fig.height=6}
reales <- head(as.numeric(Prueba), 10)
predichos <- as.numeric(pronostico$mean)
fechas_prueba <- head(as.Date(index(Prueba)), 10)

df_evaluacion <- data.frame(
  Dia = 1:10,
  Fecha = fechas_prueba,
  Real = reales,
  Predicho = round(predichos, 2),
  Error = round(reales - predichos, 2),
  Error_Abs = round(abs(reales - predichos), 2),
  Error_Pct = round((reales - predichos) / reales * 100, 2)
)

df_largo <- df_evaluacion %>%
  select(Dia, Fecha, Real, Predicho) %>%
  pivot_longer(cols = c(Real, Predicho),
               names_to = "Tipo",
               values_to = "Precio")

ggplot(df_largo, aes(x = Dia, y = Precio, color = Tipo, shape = Tipo)) +
  geom_line(linewidth = 0.8) +
  geom_point(size = 3) +
  geom_ribbon(data = df_evaluacion,
              aes(x = Dia, y = Predicho,
                  ymin = as.numeric(pronostico$lower),
                  ymax = as.numeric(pronostico$upper)),
              fill = qqq_pal$secondary, alpha = 0.15,
              inherit.aes = FALSE) +
  scale_color_manual(values = c("Real" = qqq_pal$primary, 
                                "Predicho" = qqq_pal$secondary),
                     labels = c("Predicho" = "Pron√≥stico", "Real" = "Valor Real")) +
  scale_shape_manual(values = c("Real" = 16, "Predicho" = 17),
                     labels = c("Predicho" = "Pron√≥stico", "Real" = "Valor Real")) +
  scale_x_continuous(breaks = 1:10, labels = paste0("t+", 1:10)) +
  scale_y_continuous(labels = scales::dollar_format()) +
  labs(title = "Evaluaci√≥n del Pron√≥stico: Valores Reales vs Predichos",
       subtitle = "QQQ (Nasdaq-100 ETF) | Primeros 10 d√≠as del conjunto de prueba",
       x = "Horizonte de Pron√≥stico",
       y = "Precio de Cierre (USD)",
       color = NULL,
       shape = NULL,
       caption = "√Årea sombreada: Intervalo de confianza 95%") +
  theme_QQQ() +
  theme(legend.position = "top")
```

Los primeros 10 d√≠as observados de octubre 2025 revelan que valores reales exhiben volatilidad que oscila alrededor de la l√≠nea de pron√≥stico, sin divergencia sistem√°tica consistente. Los valores reales caen todos dentro del intervalo de confianza 95%, validando calibraci√≥n correcta de la incertidumbre.

### 4.6.4 Tabla de Errores por Observaci√≥n

```{r tabla-errores, echo=TRUE}
tabla_errores <- df_evaluacion %>%
  select(Dia, Fecha, Real, Predicho, Error, Error_Pct) %>%
  mutate(
    Fecha = as.character(Fecha),
    Real = paste0("$", round(Real, 2)),
    Predicho = paste0("$", round(Predicho, 2)),
    Error = round(Error, 2),
    Error_Pct = paste0(round(Error_Pct, 2), "%")
  )

kable(tabla_errores,
      caption = "Evaluaci√≥n del Pron√≥stico: Errores por Observaci√≥n",
      align = c("c", "c", "c", "c", "c", "c"),
      col.names = c("D√≠a", "Fecha", "Valor Real", "Pron√≥stico", "Error (USD)", "Error (%)")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(3, color = qqq_pal$primary, bold = TRUE) %>%
  column_spec(4, color = qqq_pal$secondary, bold = TRUE) %>%
  column_spec(5, bold = TRUE) %>%
  column_spec(6, bold = TRUE) %>%
  footnote(general = "Error positivo: el modelo subestim√≥ (valor real > pron√≥stico). Error negativo: el modelo sobreestim√≥.",
           general_title = "Nota: ")
```

Los errores exhiben distribuci√≥n asim√©trica pero no-sistem√°tica. Los primeros tres d√≠as exhiben errores positivos peque√±os, indicando subestimaci√≥n leve. Lo notable es la simetr√≠a aproximada de errores: errores positivos en d√≠as iniciales son balanceados aproximadamente por errores negativos posteriormente, indicando que el modelo no tiene sesgo direccional sistem√°tico.

### 4.6.5 M√©tricas Finales de Evaluaci√≥n

```{r metricas-finales, echo=TRUE}
MAE <- mean(abs(df_evaluacion$Error))
RMSE <- sqrt(mean(df_evaluacion$Error^2))
MAPE <- mean(abs(df_evaluacion$Error_Pct))
ME <- mean(df_evaluacion$Error)

dentro_IC <- sum(reales >= as.numeric(pronostico$lower) & 
                   reales <= as.numeric(pronostico$upper))
pct_dentro_IC <- dentro_IC / 10 * 100

tabla_metricas <- data.frame(
  M√©trica = c("Error Medio (ME)",
              "Error Absoluto Medio (MAE)",
              "Ra√≠z del Error Cuadr√°tico Medio (RMSE)",
              "Error Porcentual Absoluto Medio (MAPE)",
              "Observaciones dentro del IC 95%"),
  Valor = c(paste0("$", round(ME, 2)),
            paste0("$", round(MAE, 2)),
            paste0("$", round(RMSE, 2)),
            paste0(round(MAPE, 2), "%"),
            paste0(dentro_IC, " de 10 (", pct_dentro_IC, "%)")),
  Interpretaci√≥n = c(
    ifelse(abs(ME) < 1, "Sin sesgo sistem√°tico ‚úì", 
           ifelse(ME > 0, "Modelo subestima", "Modelo sobreestima")),
    "Error promedio en USD",
    "Penaliza errores grandes",
    "Error relativo al precio",
    ifelse(pct_dentro_IC >= 80, "Intervalos bien calibrados ‚úì", 
           "Intervalos pueden estar mal calibrados")
  )
)

kable(tabla_metricas,
      caption = "M√©tricas de Evaluaci√≥n del Pron√≥stico - Datos de Prueba",
      align = c("l", "c", "l")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"),
                full_width = FALSE,
                position = "center") %>%
  row_spec(0, background = qqq_pal$primary, color = "white", bold = TRUE) %>%
  column_spec(1, bold = TRUE, color = qqq_pal$primary) %>%
  column_spec(2, bold = TRUE) %>%
  row_spec(5, background = "#e8f5e9", color = qqq_pal$text_dark, bold = TRUE)
```

El Error Medio (ME) = 0.85 es notablemente peque√±o, validando ausencia de sesgo direccional sistem√°tico. El Error Absoluto Medio (MAE) = 5.54 cuantifica desviaci√≥n promedio de ¬±5.54 o 0.92% del precio. La Ra√≠z del Error Cuadr√°tico Medio (RMSE) = 6.68 es ligeramente superior porque penaliza desviaciones grandes. El Error Porcentual Absoluto Medio (MAPE) = 0.92% es excelente para pron√≥stico de precios de activos financieros.

La m√©trica m√°s reveladora es "Observaciones dentro del IC 95%" = 10 de 10 (100%). Esta perfecta cobertura indica que el intervalo de confianza fue exactamente bien calibrado: todos los valores reales cayeron dentro de las bandas predichas, validando calibraci√≥n correcta de la incertidumbre (Hyndman & Koehler, 2006).


---

# 4. Conclusiones

La serie del QQQ es no-estacionaria en precios pero se estabiliza con una diferencia de primer orden. Esto se comprob√≥ mediante la prueba Aumentada de Dickey-Fuller: el estad√≠stico ADF de la serie original fue -1.8913 (p-valor = 0.1352), y despu√©s de diferenciar cay√≥ a -8.6831 (p-valor = 0.01). Por lo tanto, d=1 es el par√°metro diferenciaci√≥n.

El modelo seleccionado fue ARIMA(1,1,1) con drift. Entre seis especificaciones probadas, este tuvo el mejor AICc (4663.94). Modelos m√°s complejos no mejoraron el ajuste, solo agregaron par√°metros que fueron penalizados. El t√©rmino drift (0.44 USD/d√≠a) captura que durante 2022-2025 el QQQ creci√≥ en promedio, reflejando las expectativas de mercado sobre el sector tecnol√≥gico.

Los residuos del modelo se comportan como ruido blanco. La prueba de Ljung-Box produjo un p-valor de 0.4283, lo que significa que no hay autocorrelaci√≥n significativa en los residuos. El error medio es cero y la varianza es constante. En conclusi√≥n, el modelo captur√≥ la estructura temporal que exist√≠a en los datos.

El modelo genera pron√≥sticos con error promedio del 0.94%, lo cual es bajo. Pero en el per√≠odo de prueba, el intervalo de confianza al 95% solo cubri√≥ el 84.44% de los valores reales. Esto significa que el modelo 
predijo con demasiada confianza, la volatilidad real fue mayor a la que el modelo estim√≥.

Los intervalos de pron√≥stico crecen conforme aumenta el horizonte, desde ¬±10.77 USD en el d√≠a 1 hasta ¬±33 USD en el d√≠a 10. Por eso el modelo es √∫til solo para pron√≥sticos de muy corto plazo. Despu√©s de 2-3 semanas, los intervalos son tan amplios que no aportan informaci√≥n pr√°ctica.

Para decisiones operativas (trading, gesti√≥n de cartera), el modelo tiene limitaciones. El error es bajo en n√∫meros relativos, pero suficientemente alto despu√©s de costos de transacci√≥n. Y la subestimaci√≥n de volatilidad ser√≠a peligrosa para alguien que use estos intervalos para fijar l√≠mites de riesgo.

El modelo ARIMA es univariado, debido a que solo usa el hist√≥rico de precios del QQQ. No incorpora variables que sabemos que importan, como tasas de inter√©s o cambios en volatilidad de mercado. Un modelo ARIMAX que incluya estas variables podr√≠a mejorar los pron√≥sticos, especialmente en horizontes de 2-4 semanas.

Otra limitaci√≥n es que ARIMA asume que la volatilidad es constante. En la realidad de los mercados, hay per√≠odos calmados y per√≠odos turbulentos. Un modelo GARCH que expl√≠citamente modele volatilidad condicional podr√≠a producir intervalos de confianza m√°s realistas, particularmente cuando el mercado est√° bajo estr√©s.

El an√°lisis tambi√©n asume que las reglas del pasado siguen siendo v√°lidas en el futuro. Pero el QQQ vivi√≥ ciclos distintos durante 2022-2025 (correcci√≥n, rally, consolidaci√≥n). Modelos de cambio de r√©gimen podr√≠an detectar cu√°ndo estas reglas cambian y adaptarse.

Finalmente, el conjunto de prueba es peque√±o (45 observaciones, ~9 semanas). Para estar m√°s seguro de que el modelo funciona, convendr√≠a testearlo sobre per√≠odos m√°s largos o usar validaci√≥n cruzada con ventanas m√≥viles.

En conclusi√≥n, el modelo ARIMA(1,1,1) con drift es la especificaci√≥n correcta para el QQQ. 
Estad√≠sticamente funciona, los residuos son ruido blanco, la diferenciaci√≥n es la apropiada, el modelo supera a alternativas simples. El problema es que esto no se traduce autom√°ticamente en predicciones pr√°cticas √∫tiles. La raz√≥n es que el QQQ opera en un mercado eficiente, donde miles de instituciones procesan informaci√≥n constantemente. Cualquier patr√≥n que sea predecible es arbitrajado antes de que pueda explotarse. El modelo lo identifica correctamente, la estructura existe pero es d√©bil.

Si se construye un modelo m√°s sofisticado y no supera notablemente a ARIMA simple, se est√° probablemente sobreajustando. Tambi√©n permite cuantificar lo que 
el mercado espera, 25% de retorno anualizado durante este per√≠odo. Y permite monitorear cu√°ndo la estructura cambia, si los residuos comienzan a mostrar autocorrelaci√≥n nuevamente, es se√±al de que algo cambi√≥ en el mercado. Para investigaci√≥n futura, agregar variables ex√≥genas (tasas, volatilidad), modelar volatilidad condicional con GARCH, y detectar cambios de r√©gimen son los caminos claros.


```{=html}

<div style="
  margin-top: 80px;
  padding: 40px;
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.15), rgba(6, 182, 212, 0.08));
  border: 2px solid rgba(124, 58, 237, 0.4);
  border-radius: 15px;
  border-top: 3px solid rgba(132, 204, 22, 0.8);
  text-align: center;
  color: #e0e6ed;
  font-size: 0.95em;
  line-height: 1.8;
  box-shadow: 0 8px 30px rgba(124, 58, 237, 0.2);
">
  <div style="margin-bottom: 20px; background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; font-size: 1.1em;">
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  </div>
  
  <strong style="background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ASIGNATURA:</strong> Gesti√≥n de Datos<br>
  <strong style="background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">PROFESOR:</strong> Orlando Joaqui-Barandica<br>
  <strong style="background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">UNIVERSIDAD:</strong> Universidad del Valle<br>
  <strong style="background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">FACULTAD:</strong> Facultad de Ingenier√≠a<br>
  <strong style="background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">PROGRAMA:</strong> Ingenier√≠a Industrial<br>
  
  <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(124, 58, 237, 0.3);">
    <strong style="background: linear-gradient(135deg, #06b6d4, #84cc16); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ESTUDIANTE:</strong> Portilla Aguirre Johan Camilo (2422468), Barros Rayo Alejandro (2415837), Mu√±oz Portela Diego Fernando (2415620)<br>
    <strong style="background: linear-gradient(135deg, #06b6d4, #84cc16); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">FECHA ENTREGA:</strong> <span id="fecha-entrega"></span><br>
    <strong style="background: linear-gradient(135deg, #06b6d4, #84cc16); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">VERSI√ìN:</strong> 1.0<br>
  </div>
  
  <div style="margin-top: 20px; color: #94a3b8; font-size: 0.9em;">
    <em>Documento generado con R Markdown | Tema: Series de Tiempo y Pron√≥sticos ARIMA</em>
  </div>
  
  <div style="margin-top: 15px; background: linear-gradient(135deg, #7c3aed, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700;">
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  </div>
</div>
```



